if(window.location.href.indexOf('?utm_')!=-1){window.location.replace(window.location.href.replace(/\?.*/,''));}
$(function(){var Library=(function(){var PRODUCTION_MODE=false;var ANIMATION_MILLIS=200;var PAGE_MY_ACCOUNT=false;var PAGE_LIBRARY=false;var baseUrl='/library/';var preHistoryUrl=window.location.href;var contentMinHeight;var Classes=function(){return{collapsed:'tmb-collapsed',externalLink:'external',runModeActive:'run-mode-active',runModeRunning:'run-mode-running'};}();var AnalyticsController=function(){var initialized=false;var trackPageview=function(uri){uri=0===uri.indexOf(baseUrl)?uri:baseUrl+uri;Temboo.trackPageview(uri);}
return{init:function(){if(!initialized){initialized=true;if(PAGE_LIBRARY){$(ItemsView).bind('itemsrendered',function(event,uri){uri&&trackPageview(uri);});window.location.pathname===baseUrl&&trackPageview(baseUrl);}}}}}();var ChoreoController=function(){var runMode=false,running=false,snippetTimer,validator,validationTimer;return{init:function(runModeEnabled){var runModeInputs=ItemController.getInputs();runMode=runModeEnabled;$('.details-view').off('click','.run-mode-trigger').on('click','.run-mode-trigger',function(){$('.details-view .run-mode-form').submit();});$('.details-view').off('submit','.run-mode-form').on('submit','.run-mode-form',function(event){event.preventDefault();var item=ItemController.getCurrentItem();e=typeof item.execution!=='undefined'?item.execution:new ChoreoExecution(item);if(e.isRunning()){e.stop();Temboo.trackEvent("Library","Stop Choreo",item.uri);ItemsView.updateRunning(false,'stop');}
else{if(e.getStatus()=='idle'){item.execution=e;$(e).bind('result',function(event,status,data){ItemsView.updateRunning(false,status,data);});}
ItemsView.updateRunning(true,'start');e.start();Temboo.trackEvent("Library","Run Choreo",item.uri);}});$(ItemController).bind('itemloaded',function(){runModeInputs=ItemController.getInputs();runModeInputs.anychange(function(event){if(event.type=='mouseup'){return;}
var dataName=$(this).data('name');window.clearTimeout(snippetTimer);snippetTimer=window.setTimeout(function(){if(CredentialsController.activeCredential()){var activeCredential=CredentialsModel.get(CredentialsController.activeCredential());if(activeCredential.inputs.hasOwnProperty(dataName)||(activeCredential.credential&&CredentialsModel.get(activeCredential.credential).inputs.hasOwnProperty(dataName))){CredentialsController.flush();}}
SnippetController.loadUserSnippet();},600);ProfilesView.updateButtons($(this));if(IoTModeController.getGateway()){GatewayController.setSelectedInput(dataName,$(this).val());}});runModeInputs.off('keypress').on('keypress',function(event){if(event.keyCode==13&&!$(this).is('textarea')){$('.details-view .run-mode-form').submit();}});});$('.details-view .item-view').off('cut keyup paste','.trigger input').on('cut keyup paste','.trigger input',function(event){window.clearTimeout(snippetTimer);snippetTimer=window.setTimeout(function(){SnippetController.loadUserSnippet();},600);});$(ItemsView).bind('itemsrendered',function(){if(ItemController.getCurrentItem()){ItemsView.updateRunMode();ValidationController.own('.details-view .run-mode-form');}});},runModeIsActive:function(){return runMode==true;},updateRunMode:function(value){runMode=value==true;}};}();var ChoreoExecution=function(item){if(typeof item!=='object'||typeof item.model!=='object'||typeof item.model.type!=='string'||item.model.type!=='choreo')
throw'Exception: Illegal item type: '+item;var execution,inputs,pollTimer,result,choreo=item.uri,pollInterval=1500,runs=0,states={error:'error',idle:'idle',running:'running',success:'success',stopped:'stopped'},state=states.idle;var checkResult=function(e){var url=$('.run-mode-form').attr('action').replace(/\/run\//,'/status/');$.post(url,{choreo:choreo},function(response){if(response.status=='success'){if(response.data=='running'){pollTimer=window.setTimeout(function(){checkResult(e)},pollInterval);}
else{updateStatus(e,states.success,response.data);}}
else{updateStatus(execution,states.error,response.data);}},'json');};var saveInputs=function(){var val;inputs={};ItemController.getInputs().each(function(){val=$(this).val();if(val!=='')
inputs[$(this).attr('name')]=val;});};var updateStatus=function(execution,newState,data){state=newState;result=data;if(!execution.isRunning())
$(execution).trigger('result',[newState,data]);}
var execution={isRunning:function(){return state===states.running;},getInputs:function(){return inputs;},getResult:function(){return result;},getStatus:function(){return state;},start:function(){state=states.running;result=false;runs+=1;saveInputs();var params={choreo:choreo,inputs:encodeURIComponent($.param(inputs))};$.post($('.run-mode-form').attr('action'),params,function(response){if(execution.isRunning()){if(response.status=='success'){updateStatus(execution,states.running);checkResult(execution);}
else{updateStatus(execution,states.error,response.data);}}},'json');},stop:function(){window.clearTimeout(pollTimer);state=states.stopped;}};return execution;};var CredentialEditorView=function(){var op,description,formAction,inputs,buttons,dialog='.credential-editor',formBaseUrl='/credentials/',submitButton='save';var buildInputView=function(name,input){var inputType=input.type&&input.type==='password'?'password':'text',itemType=input.type?'typed type-'+input.type:'',view=[];view.push('<li class="meta-item '+itemType+' credential" title="'+input.type+'">');view.push('<div class="type-icon"></div>');view.push('<span class="name">'+name+'</span>');view.push('<span class="description">'+input.description+'</span>');view.push('<input class="'+name+' '+itemType+'" type="'+inputType+'" name="'+name+'" autocomplete="off">');view.push('</li>');return view.join('');}
var buildInputsView=function(type,inputs){var input,inputType=type==='optional'?'Optional Input':'Input',view='<li class="meta-class inputs"><span class="meta-class-name subtitle">'+inputType+'</span><ul class="meta-items">';for(var name in inputs){view+=buildInputView(name,inputs[name]);}
return view+'</ul></li>';}
var initInputs=function(template){var input,requiredness;for(var name in template.inputs){input=template.inputs[name];requiredness=input.requiredness==='optional'?'optional':'required';inputs[requiredness][name]={description:input.description,type:input.type}}}
var reset=function(){$(dialog+' input.name').removeAttr('disabled').removeAttr('placeholder');$(dialog+' form').clearInputs();$(dialog+' .buttons').empty();$(dialog+' .error').remove();$(dialog+' .oauth-cancel-helper').click();$(dialog+' .oauth-launch-helper').remove();$(dialog+' .device-network-form-reminder').hide();$(dialog).removeClass('run-mode-oauth-helper');$(dialog).removeClass('credential-template-oauth-helper');$(dialog).removeClass('device-network-credential-component');$(dialog).find('select').filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});buttons=[submitButton];inputs={optional:{},required:{}}}
var showError=function(field,message){if(field=='save'){$(dialog).find('.callout .callout-content').html(message);$(dialog).find('.callout').fadeIn(400);}else{$(dialog).find('[name="'+field+'"]').after('<p class="error">'+message+'</p>');}}
var update=function(operation,template,credential,device,selectedOption){var inputsView='';reset();op=operation==='add'?'Create New Credential':'Edit Credential';description=template.description;formAction=formBaseUrl+operation;initInputs(template);$.temboo.sizeOf(inputs.required)&&(inputsView+=buildInputsView('required',inputs.required));$.temboo.sizeOf(inputs.optional)&&(inputsView+=buildInputsView('optional',inputs.optional));operation=='edit'&&buttons.unshift('delete');$(dialog+' .operation').html(op);$(dialog+' .credential-editor-name').html('Name');$(dialog+' .template-name').html('for '+template.name+' Choreos');$(dialog+' .template-description').html(description);$(dialog+' form').attr('action',formAction);$(dialog+' .credential-inputs').html(inputsView);if(oauthHelpers[template.name]){$('<span class="body oauth-launch-helper"><button class="icon left">Get OAuth Tokens</button></span>').insertBefore(dialog+' .credential-inputs').click(function(e){e.preventDefault();$(dialog).addClass('credential-template-oauth-helper');$(dialog+' .credential-inputs').oauthHelper(oauthHelpers[template.name]);$(dialog+' .credential-inputs input.oauth-able').each(function(){var inputName=$(this).attr('name');$(dialog+' .oauth-input input[name='+inputName+']').val($(this).val());});});for(var step in oauthHelpers[template.name]){if(oauthHelpers[template.name][step].inputs){for(var input in oauthHelpers[template.name][step].inputs){var inputName=oauthHelpers[template.name][step].inputs[input];if(typeof inputName=='string'){$(dialog+' .credential-inputs input[name='+inputName+']').addClass('oauth-able icon icon-right');}}}
if(oauthHelpers[template.name][step].outputs){for(var output in oauthHelpers[template.name][step].outputs){var outputName=oauthHelpers[template.name][step].outputs[output];$(dialog+' .credential-inputs input[name='+outputName+']').addClass('oauth-able icon icon-right');}}}}
if(credential){$(dialog+' input.name').val(credential.name).removeAttr('placeholder');operation==='edit'&&$(dialog+' input.name').attr('disabled','disabled');for(var name in credential.inputs){$(dialog+' input.'+name).val(credential.inputs[name]);}}
$(dialog+' input.name').detach().prependTo($(dialog+' form.edit-credential-form'));$(dialog+' label.credential-editor-name').detach().prependTo($(dialog+' form.edit-credential-form'));if(template.name=='DeviceNetwork'){$(dialog+' input.name').removeAttr('placeholder');if(IoTModeController.isArduinoClassicDevice(device)||device=='ArduinoOthers'||device=='ArduinoMKR1000'){$('.device-network-form-shield-label').html('Shield Type');}else if(device=='TI'||device=='ti_cc3100'||device=='ti_cc3200'||device=='Qualcomm'||device=='Samsung.Artik.Ten'){$('.device-network-form-shield-label').html('Device');}
$(dialog+' .operation').html('Tell us about your connection');$(dialog).addClass('device-network-credential-component');if(operation=='edit'){$(dialog+' .device-network-form-reminder').show();}
$(dialog+' .template-name').html('');var $deviceNetworkForm=$(dialog+' .device-network-form'),$deviceNetworkShieldSelector=$deviceNetworkForm.find('select.device-network-form-shield'),$deviceNetworkSecuritySelector=$deviceNetworkForm.find('select.device-network-form-security'),$fakeInputs=$deviceNetworkForm.find('input:not(.name), select.device-network-form-cipher'),$realInputs=$(dialog+' .credential-inputs input'),shield=$realInputs.filter('[name=Shield]').val(),security=$realInputs.filter('[name=Security]').val();$(dialog+' label.credential-editor-name').detach().appendTo($(dialog+' .device-network-form-name'));$(dialog+' input.name').detach().appendTo($(dialog+' .device-network-form-name'));$fakeInputs.each(function(){var forInput=$(this).data('for-input'),$realInput=$realInputs.filter('[name='+forInput+']');if(forInput=='MACAddress'){$(this).val($realInput.val().replace(/0x|, /g,''));}else{$(this).val($realInput.val());}
$(this).anychange(function(){var userVal=$(this).val();var originalLength;if(forInput=='MACAddress'){originalLength=userVal.length;userVal=userVal.toUpperCase().replace(/O/g,'0').replace(/[^0-9A-F ,:-]/g,'');var start=this.selectionStart,end=this.selectionEnd;$(this).val(userVal);var formattedVal=userVal.replace(/[^0-9A-F]/g,'');if(formattedVal){formattedVal=formattedVal.match(/(.{1,2})/g);while(formattedVal.length<6){formattedVal.push('00');}
formattedVal=formattedVal.slice(0,6);for(var i in formattedVal){if(formattedVal[i].length<2){formattedVal[i]='0'+formattedVal[i];}}
formattedVal='0x'+formattedVal.join(', 0x');$realInput.val(formattedVal);}else{$realInput.val('');}
if(originalLength==userVal.length){this.setSelectionRange(start,end);}else{var difference=originalLength-userVal.length;this.setSelectionRange(start-difference,end-difference);}}else{$realInput.val(userVal);}});});if(IoTModeController.isArduinoClassicDevice(device)||device=='ArduinoOthers'){$deviceNetworkShieldSelector.html('<option value="Arduino Yún Shield">Arduino Yún Shield</option>');if(device!='ArduinoUno'){$deviceNetworkShieldSelector.append('<option value="arduinowifi101">Arduino WiFi 101 Shield</option>');}
if(!IoTModeController.gatewayEnabled()&&device!='ArduinoZero'&&device!='Arduino101'){$deviceNetworkShieldSelector.append('<option value="redbearlabble">RedBearLab Bluetooth LE Shield</option>');}
if(FEATURE_ORIGINAL_ARDUINOS){$deviceNetworkShieldSelector.append('<option value="arduinowifir3">Arduino WiFi Shield</option>\
							                                  <option value="arduinoethernetr3">Arduino Ethernet Shield</option>');if(!IoTModeController.gatewayEnabled()||IoTModeController.getProtocol()=='http'){$deviceNetworkShieldSelector.append('<option value="adafruitwificc3000">Adafruit CC3000 WiFi Shield</option>');}
if(!IoTModeController.gatewayEnabled()&&device!='ArduinoUno'&&device!='ArduinoZero'&&device!='Arduino101'){$deviceNetworkShieldSelector.append('<option value="arduinogsm">Arduino GSM Shield</option>');}}}else if(device=='ArduinoMKR1000'){$deviceNetworkShieldSelector.html('<option value="mkr1000">Arduino MKR1000 (WiFi)</option>');}else if(device=='ti_cc3100'){$deviceNetworkShieldSelector.html('');$deviceNetworkShieldSelector.append('<option value="ti_cc3100">TI CC3100 BoosterPack (WiFi)</option>');}else if(device=='ti_cc3200'){$deviceNetworkShieldSelector.html('');if(FEATURE_RTOS){$deviceNetworkShieldSelector.append('<option value="Shield type" class="device-network-credential-component device-network-category">TI-RTOS</option>\
								<option value="ti_cc3200_rtos">TI CC3200 (WiFi) + RTOS</option>\
								<option value="Shield type" class="device-network-credential-component device-network-spacer"></option>\
								<option value="Shield type" class="device-network-credential-component device-network-category">Other</option>');}
$deviceNetworkShieldSelector.append('<option value="ti_cc3200">TI CC3200 (WiFi)</option>');}else if(device=='Qualcomm'){$deviceNetworkShieldSelector.html('<option value="qcom_qca4002">QCA4002 Dev Kit (WiFi)</option>');}
if($('option',$deviceNetworkShieldSelector).length>1){$deviceNetworkShieldSelector.prepend('<option class="option-label-only">How is it connected?</option>');}
if(selectedOption){shield=selectedOption;}
$deviceNetworkShieldSelector.off('change').val(shield).selectBox().on('change',function(e){var $this=$(this);$deviceNetworkSecuritySelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});shield=$this.val();$(dialog+' button.save').text('Save');if($(dialog+' .callout.shadow').hasClass('shown')){$(dialog+' .callout.shadow.shown').fadeIn(400);$(dialog+' button.save').attr('disabled','disabled');}else{$(dialog+' button.save').removeAttr('disabled');}
if(shield=='arduinowifir3'||shield=='adafruitwificc3000'||shield=='ti_cc3100'||shield=='ti_cc3200'||shield=='ti_cc3200_rtos'||shield=='qcom_qca4002'||shield=='mkr1000'||shield=='arduinowifi101'){$('.device-network-form-cipher').hide().removeClass('active');$deviceNetworkForm.find('.device-network-input').hide().removeClass('active');$deviceNetworkForm.find('.advice').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-name').show();$(dialog+' .device-network-form-security').hide().show();$deviceNetworkSecuritySelector.html('\
								<option value="wpa">WPA</option>\
								<option value="wep">WEP</option>\
								<option value="unsecure">UNSECURED</option>');if(shield=='adafruitwificc3000'){$deviceNetworkForm.find('.advice.memory').show().addClass('active');$deviceNetworkSecuritySelector.prepend('<option value="wpa2">WPA2</option>');}
else if(shield=='qcom_qca4002'){$deviceNetworkSecuritySelector.html('\
									<option value="wpa2">WPA2</option>');}else if(shield=='ti_cc3200_rtos'){$deviceNetworkSecuritySelector.html('\
									<option value="wpa">WPA</option>\
									<option value="unsecure">UNSECURED</option>');}
$deviceNetworkSecuritySelector.off('change').val(security).selectBox().on('change',function(e){var $this=$(this);security=$this.val();$deviceNetworkForm.find('.device-network-input').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-ssid').show().addClass('active');if(security=='wpa'||security=='wpa2'){$deviceNetworkForm.find('.device-network-form-wpapassword').show().addClass('active');if(shield=='qcom_qca4002'){$('.device-network-form-cipher').show().addClass('active');$('select.device-network-form-cipher').selectBox('destroy');$('select.device-network-form-cipher').selectBox();if($('select.device-network-form-cipher').selectBox('value')==null){$('select.device-network-form-cipher').selectBox('value','TKIP');}
$('select.device-network-form-cipher').trigger('change');}}else if(security=='wep'){$('.device-network-form-cipher').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-wepkey').show().addClass('active');if(shield!='adafruitwificc3000'){$deviceNetworkForm.find('.device-network-form-wepkeyindex').show().addClass('active');}}
$deviceNetworkForm.find('.device-network-input:not(.active) input').val('').change();$realInputs.filter('[name='+$this.data('for-input')+']').val(security);}).trigger('change');}else if(shield=='arduinoethernetr3'){$('.device-network-form-cipher').hide().removeClass('active');$(dialog+' .device-network-form-security').hide();$deviceNetworkForm.find('.device-network-input').hide().removeClass('active');$deviceNetworkForm.find('.advice').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-macaddress').show().addClass('active');$deviceNetworkForm.find('.advice.ethernet').show().addClass('active');$deviceNetworkForm.find('.device-network-form-name').show();$deviceNetworkForm.find('.device-network-input:not(.active) input').val('').change();}else if(shield=='redbearlabble'){$('.device-network-form-cipher').hide().removeClass('active');$(dialog+' .device-network-form-security').hide();$deviceNetworkForm.find('.device-network-input').hide().removeClass('active');$deviceNetworkForm.find('.advice').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-shortname').show().addClass('active');$deviceNetworkForm.find('.advice.ble').show().addClass('active');$deviceNetworkForm.find('.device-network-form-name').show();$deviceNetworkForm.find('.device-network-input:not(.active) input').val('').change();}else if(shield=='arduinogsm'){$('.device-network-form-cipher').hide().removeClass('active');shield='arduinogsm';$(dialog+' .device-network-form-security').hide();$deviceNetworkForm.find('.device-network-input').hide().removeClass('active');$deviceNetworkForm.find('.advice').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-gsmaccess').show().addClass('active');$deviceNetworkForm.find('.device-network-form-gsmlogin').show().addClass('active');$deviceNetworkForm.find('.device-network-form-gsmpass').show().addClass('active');$deviceNetworkForm.find('.device-network-form-gsmpin').show().addClass('active');$deviceNetworkForm.find('.device-network-form-name').show();$deviceNetworkForm.find('.device-network-input:not(.active) input').val('').change();}else if(shield=='Arduino Yún Shield'){$('.device-network-form-cipher').hide().removeClass('active');$(dialog+' .device-network-form-security').hide();$deviceNetworkForm.find('.device-network-input').hide().removeClass('active');$deviceNetworkForm.find('.advice').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-name').hide();$deviceNetworkForm.find('.device-network-input:not(.active) input').val('').change();$(dialog+' button.save').text('Use');if($(dialog+' .callout.shadow').hasClass('shown')){$(dialog+' .callout.shadow.shown').hide();$(dialog+' button.save').removeAttr('disabled');}}else{$('.device-network-form-cipher').hide().removeClass('active');$(dialog+' .device-network-form-security').hide();$deviceNetworkForm.find('.device-network-input').hide().removeClass('active');$deviceNetworkForm.find('.advice').hide().removeClass('active');$deviceNetworkForm.find('.device-network-form-name').hide();$deviceNetworkForm.find('.device-network-input:not(.active) input').val('').change();if($(dialog+' .callout.shadow').hasClass('shown')){$(dialog+' .callout.shadow.shown').hide();$(dialog+' button.save').removeAttr('disabled');}}
$realInputs.filter('[name='+$this.data('for-input')+']').val(shield);}).trigger('change');if($('option',$deviceNetworkShieldSelector).length==1){$('a.selectBox.device-network-form-shield').addClass('disabled');}else{$('a.selectBox.device-network-form-shield').removeClass('disabled');}}else if(template.name=='Gateway'){$(dialog+' .operation').html('Gateway device settings');$(dialog+' .credential-editor-name').html('Name');$(dialog).addClass('gateway-credential-component');$(dialog+' .template-name').html('');var $gatewayForm=$(dialog+' .gateway-form'),$gatewayProtocolSelector=$gatewayForm.find('select.gateway-form-protocol'),$fakeInputs=$gatewayForm.find('input'),$realInputs=$(dialog+' .credential-inputs input'),protocol=$realInputs.filter('[name=Protocol]').val();$fakeInputs.each(function(){var forInput=$(this).data('for-input'),$realInput=$realInputs.filter('[name='+forInput+']');$(this).val($realInput.val());$(this).anychange(function(){var userVal=$(this).val();$realInput.val(userVal);});});$gatewayProtocolSelector.html('<option value="mqtt">MQTT</option>\
						                            <option value="http">HTTP</option>\
						                            <option value="coap">CoAP</option>');if(selectedOption){protocol=selectedOption;}
$gatewayProtocolSelector.off('change').val(protocol).selectBox().on('change',function(e){$this=$(this);protocol=$this.val();$realInputs.filter('[name='+$this.data('for-input')+']').val(protocol);}).trigger('change');}
$.each(buttons,function(i,name){var type=name===submitButton?'submit':'button';var buttonType=name==='delete'?'icon':'button';$(dialog+' .buttons').append('<button class="'+buttonType+' '+name+'" name="'+name+'" type="'+type+'">'+$.temboo.ucfirst(name)+'</button>');if(template.name=='DeviceNetwork'&&$deviceNetworkShieldSelector.val()=='How is it connected?'){$(dialog+' button.save').attr('disabled','disabled');}});};return{add:function(template,device,selectedOption){update('add',template,null,device,selectedOption);},edit:function(template,credential,device){update('edit',template,credential,device);},save:function(template){var input;update('add',template);for(var name in template.inputs){input=template.inputs[name];$(dialog+' .credential-inputs input.'+name).val(ItemController.getInputs().filter('[name="'+name+'"]').val());}},showErrors:function(errors){for(var field in errors)
showError(field,errors[field]);$(dialog).lightbox('unmask');}}}();var CredentialSelectorController=function(){return{init:function(template,credentials){CredentialSelectorView.update(template,credentials);CredentialSelectorView.resetLabel();if(template&&oauthHelpers[template.name]){var oauthLauncher=$('<div class="run-mode-oauth-launch-helper run-mode-component"></div>').insertBefore('.meta-class.inputs .meta-class-content:first');$('<span class="body oauth-launch-helper"><button class="icon left">Get OAuth Tokens</button></span>').appendTo(oauthLauncher);for(var step in oauthHelpers[template.name]){if(oauthHelpers[template.name][step].inputs){for(var input in oauthHelpers[template.name][step].inputs){var inputName=oauthHelpers[template.name][step].inputs[input];if(typeof inputName=='string'){$('.meta-class.inputs input[name='+inputName+']').addClass('oauth-able icon icon-right');}}}
if(oauthHelpers[template.name][step].outputs){for(var output in oauthHelpers[template.name][step].outputs){var outputName=oauthHelpers[template.name][step].outputs[output];$('.meta-class.inputs input[name='+outputName+']').addClass('oauth-able icon icon-right');}}}}
$(document).off('mouseup').on('mouseup','.credential-selector-selectBox-dropdown-menu li',function(event){var credentials=CredentialsModel.credentials();CredentialSelectorView.resetLabel();$('.credential-selector-selectBox-dropdown-menu li.selectBox-selected').removeClass('selectBox-selected');if($.temboo.sizeOf(credentials)){var credentialSelection=$('select.credential-selector').val();var c=credentials[credentialSelection];ItemsView.applyCredential(c);SnippetController.loadUserSnippet();}});$(ItemController).unbind('unload.credentials').bind('unload.credentials',function(e,item){$('select.credential-selector').hide().filter('.selectBox').each(function(){Temboo.log('CredentialsSelectorController.init','Destroying selectBox...');$(this).selectBox('destroy').hide();});$('.credentials-template-block ul.clickfish').each(function(){Temboo.log('CredentialsSelectorController.init','Destroying multipath menus...');$(this).clickfish('destroy');});});}}}();var CredentialSelectorView=function(){var noOptions,defaultLabel='Insert Credential',dropdown='.credential-selector-selectBox-dropdown-menu',select='select.credential-selector',view='.credential-selector.selectBox-dropdown';var buildOptions=function(credentials){var opts=[defaultLabel];for(var name in credentials)
opts.push(name);noOptions=(opts.length===1);opts.length===1&&opts.push('None yet');var elideBy=$(select).data('max-chars');if(!elideBy||elideBy.length<1){elideBy=17;}
for(var i in opts){$(select).append($('<option />').val(opts[i]).html($.temboo.elide(opts[i],elideBy,'middle')));}
$(select+' option:first').addClass('default');}
return{resetLabel:function(newLabel){if(newLabel){$(view+' .selectBox-label').html(newLabel);return true;}
var currentItem=ItemController.getCurrentItem();var label=$(select).data('label');if(!label||label.length<1){label=defaultLabel;}
$(view+' .selectBox-label').html(label);},update:function(template,credentials){var disabled=$(select).hasClass('disabled');if(template===undefined&&!disabled){$(select).filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});$(select).fadeOut(ANIMATION_MILLIS,function(){$(this).addClass('disabled');});}
else{$(select).empty();buildOptions(credentials);$(dropdown).length&&$(select).filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});$(select).selectBox().bind('open',function(){Temboo.trackEvent("Library","Insert credentials clicked");});$('.selectBox-label').css('margin-right','5px');noOptions&&$(dropdown).addClass('none');noOptions||$(dropdown).removeClass('none');if(disabled){$(view).fadeIn(ANIMATION_MILLIS,function(){$(this).removeClass('disabled');});}}}}}();var CredentialsController=function(){var activeCredential;var cache=function(name){activeCredential=name;Temboo.log('CredentialsController.cache','Set active credential to: '+activeCredential);}
var flush=function(){activeCredential=undefined;Temboo.log('CredentialsController.flush','Removed active credential');}
return{activeCredential:function(){return activeCredential;},init:function(){$(FilterController).bind('itemloaded',function(){flush();});$(CredentialsModel).bind('ondelete',function(result,credentialName){result.status==='success'&&credentialName===activeCredential&&flush();});$(ItemsView).bind('credentialapplied',function(event,credentialName){cache(credentialName);if(IoTModeController.gatewayEnabled()){GatewayController.setSelectedProperty('credential',credentialName);GatewayController.removeSelectedProperty('inputs');}});},flush:function(){flush();GatewayController.removeSelectedProperty('credential');}}}();var CredentialsModel=function(){var action,credentials,template,actionBase='/credentials/';var save=function(op,credentialName,inputs){action='save/';var args={inputs:encodeURIComponent($.param(inputs)),name:credentialName,operation:op,template:template.name};$.post(actionBase+action,args,function(result){result=$.parseJSON(result);Temboo.log('CredentialsModel.save',result.status);if(result.status==='success'){var credential={name:credentialName,inputs:inputs}
credentials[credentialName]=credential;var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.model&&currentItem.model.type){if(currentItem.model.type=='choreo'){if(template.name=='DeviceNetwork'){if(!currentItem.deviceNetworkCredentials.data){currentItem.deviceNetworkCredentials.data={};}
currentItem.deviceNetworkCredentials.data[credentialName]=credential;if(IoTModeController.gatewayEnabled()){GatewayController.setSelectedEdgeNetwork(credentialName);GatewayView.updateEdgeNetworkSelector(currentItem);IoTModeView.updateChoreoDetails(currentItem);IoTModeView.updateSnippets(currentItem);if(!GatewayController.getSelectedProperty('device')){GatewayController.setSelectedEdgeDevice(IoTModeController.getShieldDevice(credential.inputs.Shield));GatewayView.updateEdgeDeviceSelector(currentItem);IoTModeView.updateSnippets(currentItem);}}else{IoTModeController.setNetwork(credentialName);IoTModeView.updateNetworkSelector(currentItem);IoTModeView.updateChoreoDetails(currentItem);IoTModeView.updateSnippets(currentItem);if(!IoTModeController.getDevice()){IoTModeController.setDevice(IoTModeController.getShieldDevice(credential.inputs.Shield));IoTModeView.updateDeviceSelector(currentItem);IoTModeView.updateSnippets(currentItem);}}}else if(template.name=='Gateway'){if(!currentItem.gatewayCredentials.data){currentItem.gatewayCredentials.data={};}
currentItem.gatewayCredentials.data[credentialName]=credential;IoTModeController.setGateway(credentialName);IoTModeView.updateGatewaySelector(currentItem);IoTModeView.updateSensorSelector();IoTModeView.updateActuatorSelector();IoTModeView.updateChoreoDetails(currentItem);IoTModeView.updateSnippets(currentItem);}}}
ItemController.flushAllItems();}
$(CredentialsModel).trigger('onsave',[result,credentialName]);})}
return{create:function(credentialName,inputs){save('create',credentialName,inputs);},credentials:function(){return credentials;},destroy:function(credentialName,cascaded,references){action='delete/';$.post(actionBase+action,{name:credentialName,references:references},function(result){result=$.parseJSON(result);Temboo.log('CredentialsModel.destroy',result.status);if(result.status==='success'){delete credentials[credentialName];var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.model&&currentItem.model.type){if(currentItem.model.type=='choreo'){if(template.name=='DeviceNetwork'){if(currentItem.deviceNetworkCredentials.data&&currentItem.deviceNetworkCredentials.data[credentialName]){delete currentItem.deviceNetworkCredentials.data[credentialName];}
if(IoTModeController.getNetwork()==credentialName){IoTModeController.setNetwork(null);IoTModeView.updateSnippets(currentItem);}
IoTModeView.updateNetworkSelector(currentItem);if(IoTModeController.gatewayEnabled()){GatewayView.updateEdgeNetworkSelector(currentItem);}}else if(template.name=='Gateway'){if(currentItem.gatewayCredentials.data&&currentItem.gatewayCredentials.data[credentialName]){delete currentItem.gatewayCredentials.data[credentialName];}
if(IoTModeController.getGateway()==credentialName){IoTModeController.setGateway(null);IoTModeView.updateSnippets(currentItem);}
IoTModeView.updateGatewaySelector(currentItem);}}}
ItemController.flushCurrentItem();}
if(cascaded){if(result.status==='success'){$(CredentialsModel).trigger('ondeletecascade',credentialName);}}else{$(CredentialsModel).trigger('ondelete',result,credentialName);}});},edit:function(credentialName,inputs){save('edit',credentialName,inputs);},get:function(name){if(credentials==undefined||credentials[name]==undefined){var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.profiles&&currentItem.profiles[name]){return currentItem.profiles[name];}else{throw'No such credential found: '+name;}}
return credentials[name];},init:function(t,c){credentials=c?$(c).deepCopy():{};template=t;for(var name in credentials){credentials[name].name=name;}},template:function(){return template;}}}();var CredentialsTemplateController=function(){return{init:function(allCredentials){CredentialsTemplateView.init();$('.credential-editor').bind('beforelightboxopen',function(){$('.edit-credential-form .buttons .delete').addClass('icon').text('');});$('.credential-editor .callout').off('click','button.close').on('click','button.close',function(event){event.preventDefault();$('.credential-editor .callout').hide();});this.addCredential=function(e,device,selectedOption){e.preventDefault();e.stopPropagation();$.post('/credentials/checkCredentialAvailability',function(result){var resultObject=JSON.parse(result);if(resultObject&&resultObject['status']==0){$('.credential-editor .callout .callout-content').html(resultObject['data']);$('.credential-editor .callout').addClass('shown');}});if(e.delegateTarget&&($(e.delegateTarget).hasClass('device-network-credential-component')||$(e.delegateTarget).hasClass('iot-mode-device-selector'))){$('.credential-editor').addClass('device-network-credential-component');var currentItem=ItemController.getCurrentItem();if(currentItem.model&&currentItem.model.type&&currentItem.model.type=='choreo'){CredentialsModel.init(currentItem.deviceNetworkCredentials.template,currentItem.deviceNetworkCredentials.data);}
CredentialEditorView.add(CredentialsModel.template(),device,selectedOption);}else if(e.delegateTarget&&$(e.delegateTarget).hasClass('gateway-credential-component')){var currentItem=ItemController.getCurrentItem();if(currentItem.model&&currentItem.model.type&&currentItem.model.type=='choreo'){CredentialsModel.init(currentItem.gatewayCredentials.template,currentItem.gatewayCredentials.data);}
$('.credential-editor').addClass('gateway-credential-component');CredentialEditorView.add(CredentialsModel.template(),device,selectedOption);}else{CredentialEditorView.add(CredentialsModel.template());}
$('.credential-editor').lightbox({buttons:{'save':{async:true,callback:function(event){if($('.credential-editor select.device-network-form-shield').val()=='Arduino Yún Shield'){IoTModeController.setNetwork('Arduino Yún Shield');IoTModeView.updateNetworkSelector(currentItem);$('.credential-editor').lightbox('close');}else{var inputs={};for(var name in CredentialsModel.template().inputs)
inputs[name]=$('.credential-editor input.'+name).val();$('.credential-editor .error').remove();CredentialsModel.create($('.credential-editor input.name').val(),inputs);}}}}}).off('lightboxclose.credentialtemplate').on('lightboxclose.credentialtemplate',function(){$(this).find('select').filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});$('.credential-editor .callout').hide();if($(this).hasClass('device-network-credential-component')){$(this).removeClass('device-network-credential-component');if(PAGE_LIBRARY){var currentItem=ItemController.getCurrentItem();if(currentItem.credentials&&currentItem.credentials.template){CredentialsModel.init(currentItem.credentials.template,currentItem.credentials.data);}else{CredentialsModel.init();}}}else if($(this).hasClass('gateway-credential-component')){$(this).removeClass('gateway-credential-component');if(PAGE_LIBRARY){var currentItem=ItemController.getCurrentItem();if(currentItem.credentials&&currentItem.credentials.template){CredentialsModel.init(currentItem.credentials.template,currentItem.credentials.data);}else{CredentialsModel.init();}}}});ValidationController.own('.credential-editor form');if($(this).parent().hasClass('oauth-launch-helper')){$('.credential-editor').addClass('run-mode-oauth-helper');$('.credential-editor .credential-inputs').oauthHelper(oauthHelpers[CredentialsModel.template().name]);$('.credential-editor .operation').html("Obtain OAuth Inputs");$('.meta-class.inputs input.oauth-able.run-mode-active').each(function(){var inputName=$(this).attr('name');$('.credential-editor .oauth-input input[name='+inputName+']').val($(this).val());});}else{Temboo.trackEvent("Library","Add new credentials",CredentialsModel.template().name);}};$(document).off('click','.credentials-template-block button.add,\
						.run-mode-oauth-launch-helper .oauth-launch-helper button,\
						#device-network-credential-container button.add,\
						#iot-mode-container button.add').on('click','.credentials-template-block button.add,\
						.run-mode-oauth-launch-helper .oauth-launch-helper button,\
						#device-network-credential-container button.add,\
						#iot-mode-container button.add',this.addCredential);$(document).off('click','.credentials-template-block button.edit,\
						table.credentials button.edit,\
						.iot-mode-component-selectBox-dropdown-menu button.edit-credential,\
						.gateway-network-selector-selectBox-dropdown-menu button.edit-credential').on('click','.credentials-template-block button.edit,\
						table.credentials button.edit,\
						.iot-mode-component-selectBox-dropdown-menu button.edit-credential,\
						.gateway-network-selector-selectBox-dropdown-menu button.edit-credential',function(){var credentialName=$(this).val();var references=[];$('.credential-editor .callout').hide();if(PAGE_MY_ACCOUNT){var templateName=$(this).attr('data-template');CredentialsModel.init(allCredentials.templates[templateName],allCredentials.credentials[templateName]);}else if($(this).hasClass('device-network-credential-component')){$('.credential-editor').addClass('device-network-credential-component');var currentItem=ItemController.getCurrentItem();if(currentItem.model&&currentItem.model.type&&currentItem.model.type=='choreo'){CredentialsModel.init(currentItem.deviceNetworkCredentials.template,currentItem.deviceNetworkCredentials.data);}}else if($(this).hasClass('gateway-credential-component')){$('.credential-editor').addClass('gateway-credential-component');var currentItem=ItemController.getCurrentItem();if(currentItem.model&&currentItem.model.type&&currentItem.model.type=='choreo'){CredentialsModel.init(currentItem.gatewayCredentials.template,currentItem.gatewayCredentials.data);}}
if(templateName=='DeviceNetwork'){if($(this).hasClass('gateway-network-credential-component')){GatewayController.setSelectedEdgeDevice(IoTModeController.getShieldDevice(CredentialsModel.get(credentialName).inputs.Shield));}else{IoTModeController.setDevice(IoTModeController.getShieldDevice(CredentialsModel.get(credentialName).inputs.Shield));}}
if($(this).hasClass('gateway-network-credential-component')){CredentialEditorView.edit(CredentialsModel.template(),CredentialsModel.get(credentialName),GatewayController.getSelectedEdgeDevice());}else{CredentialEditorView.edit(CredentialsModel.template(),CredentialsModel.get(credentialName),IoTModeController.getDevice());}
var setDeleteWarning=function(credentialName){var warning='Delete Credential?';$.ajax({url:'/credentials/associations/'+credentialName+'/',async:false,success:function(data){references=JSON.parse(data);if(references.length>0){warning+='<p class="related-input-text">Note – this is used by the following Profiles:</p><ul class="related-input-list">';for(var index=0;index<references.length;index++){warning+='<li>'+references[index]+'</li>';}
warning+='</ul>'}}});return warning;}
$('.credential-editor').lightbox({buttons:{'delete':{async:true,callback:function(){CredentialsModel.destroy(credentialName,null,references);if(PAGE_MY_ACCOUNT){delete allCredentials.credentials[templateName][credentialName];var counter=$('.account-credentials #counter .count');counter.html(parseInt(counter.html())-1);var deleteRow=$('table.credentials button.edit[value='+credentialName+']').parents('tr').get(0);$('table.credentials').dataTable().fnDeleteRow(deleteRow);}},confirm:{text:setDeleteWarning(credentialName),positive:'Yes, Delete',negative:'No, Cancel'}},'save':{async:true,callback:function(event){var inputs={};for(var name in CredentialsModel.template().inputs)
inputs[name]=$('.credential-editor input.'+name).val();CredentialsModel.edit($('.credential-editor input.name').val(),inputs);if(PAGE_MY_ACCOUNT){allCredentials.credentials[templateName][credentialName].inputs=inputs;}},confirm:{text:'Save your changes?',positive:'Yes, save',negative:'Not yet'}}}}).off('lightboxclose.credentialtemplate').on('lightboxclose.credentialtemplate',function(){$(this).find('select').filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});if($(this).hasClass('device-network-credential-component')){$(this).removeClass('device-network-credential-component');if(PAGE_LIBRARY){var currentItem=ItemController.getCurrentItem();if(currentItem.credentials&&currentItem.credentials.template){CredentialsModel.init(currentItem.credentials.template,currentItem.credentials.data);}else{CredentialsModel.init();}}}else if($(this).hasClass('gateway-credential-component')){$(this).removeClass('gateway-credential-component');if(PAGE_LIBRARY){var currentItem=ItemController.getCurrentItem();if(currentItem.credentials&&currentItem.credentials.template){CredentialsModel.init(currentItem.credentials.template,currentItem.credentials.data);}else{CredentialsModel.init();}}}});});$(document).off('click','.credentials-template-block button.save').on('click','.credentials-template-block button.save',function(){CredentialEditorView.save(CredentialsModel.template());$('.credential-editor').lightbox({buttons:{'save':{async:true,callback:function(event){var inputs={};for(var name in CredentialsModel.template().inputs)
inputs[name]=$('.credential-editor input.'+name).val();$('.credential-editor .error').remove();CredentialsModel.create($('.credential-editor input.name').val(),inputs);}}}});Temboo.trackEvent("Library","Save credential",CredentialsModel.template().name);});$(document).off('click','.credentials-template-block button.insert').on('click','.credentials-template-block button.insert',function(){var credential=$(this).val();ItemsView.applyCredential(CredentialsModel.get(credential));SnippetController.loadUserSnippet();});$(CredentialsModel).bind('ondelete',function(event,result){$('.credential-editor').lightbox('close');if(result.status==='success'){$('.credential-editor').lightbox(result.status,'<div class="status-alert success"><p>The credential was successfully deleted</p></div>');if(CredentialsModel.template().name!='DeviceNetwork'&&CredentialsModel.template().name!='Gateway'){CredentialsTemplateView.update(CredentialsModel.template(),CredentialsModel.credentials());if(PAGE_LIBRARY){CredentialSelectorView.update(CredentialsModel.template(),CredentialsModel.credentials());}}}
else{$('.credential-editor').lightbox(result.status,'<div class="status-alert error"><p>An error occurred while deleting the credential, please try again later</p></div>');}});$(CredentialsModel).bind('onsave',function(event,result,credentialName){var dialog=$('.credential-editor');if(result.status==='success'){var successMessage='Your settings have been saved!';dialog.lightbox('close').lightbox(result.status,'<div class="status-alert success"><p>'+successMessage+'</p></div>');if(CredentialsModel.template().name!='DeviceNetwork'&&CredentialsModel.template().name!='Gateway'){CredentialsTemplateView.update(CredentialsModel.template(),CredentialsModel.credentials());PAGE_LIBRARY&&CredentialSelectorView.update(CredentialsModel.template(),CredentialsModel.credentials());}else if(PAGE_MY_ACCOUNT&&CredentialsModel.template().name=='Gateway'){var savedCredential=CredentialsModel.get(credentialName);if(savedCredential&&savedCredential.inputs&&savedCredential.inputs.Protocol){if(savedCredential.inputs.Protocol=='mqtt'){$('table.credentials td.works-col.'+credentialName).text('MQTT');}else if(savedCredential.inputs.Protocol=='http'){$('table.credentials td.works-col.'+credentialName).text('HTTP');}else if(savedCredential.inputs.Protocol=='coap'){$('table.credentials td.works-col.'+credentialName).text('CoAP');}}}}
else{if(result.data){CredentialEditorView.showErrors(result.data);}
else{dialog.lightbox('close').lightbox(result.status,'<div class="status-alert error"><p>An error occurred while saving the credential, please try again later</p></div>');}}});$(FilterController).bind('itemloaded',function(event,item,previousItem){var credentials,template;if(item.credentials!==undefined){credentials=item.credentials.data;template=item.credentials.template;}
if(item.model)CredentialsTemplateView.setItemType(item.model.type);var oldTemplate=CredentialsModel.template();if((oldTemplate===undefined&&template===undefined)||(oldTemplate&&template&&oldTemplate.name===template.name&&previousItem&&previousItem.model&&previousItem.model.type&&previousItem.model.type==item.model.type)){}
else{CredentialsModel.init(template,credentials);CredentialsTemplateView.update(CredentialsModel.template(),CredentialsModel.credentials());}});$(HistoryController).bind('indexloaded',function(){CredentialsModel.init();CredentialsTemplateView.update(CredentialsModel.template(),CredentialsModel.credentials());LibraryLandingController.init();$(window.Temboo).trigger('layoutchange');$(window).trigger('libraryloaded');});$(ItemsView).bind('itemsrendered',function(event){var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.model){CredentialSelectorController.init(CredentialsModel.template(),CredentialsModel.credentials());}});}}}();var CredentialsTemplateView=function(){var initialized,defaultContent,view='.credentials-template-block';var buildCredentialView=function(name){var abbrev=$.temboo.elide(name,15,'middle'),elem=$('<div />').append($('<div />').addClass('credential').append($('<button />').addClass('body insert run-mode-component').attr('value',name)).append($('<button />').addClass('body edit').attr('title',name).attr('value',name).html(abbrev)));ChoreoController.runModeIsActive()&&elem.find('.run-mode-component').addClass('run-mode-active');return elem.html();}
return{init:function(){if(!initialized){defaultContent=$(view+' .content').html();}},setItemType:function(type){$(view).removeClass('bundle choreo folder').addClass(type);},update:function(template,credentials){var disabled=$(view).hasClass('disabled');var currentItem=ItemController.getCurrentItem();if(template===undefined){var millis=disabled?0:ANIMATION_MILLIS;$(view).fadeOut(millis,function(){$(this).addClass('disabled');});}
else{var content='';if($.temboo.sizeOf(credentials)){for(var name in credentials){content+=buildCredentialView(name);}}
else{content=defaultContent;}
$(view+' .template-name').html('for '+template.name);$(view+' .content').html(content);var bundleLinks=[];var bundleListItems=[];for(var bundleName in template.bundles){bundleLinks.push(template.bundles[bundleName]);bundleListItems.push('<li><a href="/library/'+template.bundles[bundleName]+'/">'+bundleName+'</a></li>');}
if(bundleLinks.length>1){$(view+' span.single-bundle').hide();$(view+' span.multi-bundle ul').replaceWith('<ul class="clickfish inline"><li><a href="" class="template-name multipath">'+template.name+' &#187;</a><ul>'+bundleListItems.join('')+'</ul></li></ul>');$(view+' span.multi-bundle').show();$(view+' ul.clickfish').clickfish();}else{$(view+' span.multi-bundle').hide();$(view+' span.single-bundle a.template-name.multipath').attr('href','/library/'+bundleLinks[0]+'/');$(view+' span.single-bundle').show();}
if(disabled){$(view).fadeIn(ANIMATION_MILLIS,function(){$(this).removeClass('disabled');});}}}}}();var DeviceController=function(){var cloudControlsDevices=['ArduinoYun'];var transducerDevices=['ArduinoYun','ArduinoMKR1000','ArduinoMega','ArduinoUno','Arduino101','ArduinoZero'];return{getPinJSON:function(){var pinJSON=[];var pins=PinController.getPins();var device=IoTModeController.getDevice();for(var pinId in pins){var pin=pins[pinId];if(pin.isTransducer()){var pinFields={name:pin.getPinName(),pin:pin.getPinId(),label:pin.getLabel(),direction:pin.getDirection(),signal:pin.getSignal(),safe:pin.getSafe(),medium:pin.getMedium(),model:pin.getModel(),manufacturer:pin.getManufacturer(),analogUnit:pin.getAnalogUnit(),scaleLow:pin.getScaleLow(),scaleHigh:pin.getScaleHigh(),calibration:pin.getCalibration()}
if(DeviceController.deviceHasTransducers()&&pin.getLibrary()){pinFields.type=pin.getLibrary();}
pinJSON.push(pinFields);}}
return pinJSON.slice();},deviceHasActuatorsOnly:function(){var pins=PinController.getPins();for(var pinId in pins){var pin=pins[pinId];if(pin.isSensor()){return false;}}
return true;},deviceHasCloudControls:function(){var device=IoTModeController.getDevice();if(!device){return false;}
return $.inArray(device,cloudControlsDevices)>-1;},deviceHasTransducers:function(){var device=IoTModeController.getDevice();if(!device){return false;}
return $.inArray(device,transducerDevices)>-1;}}}();var DeviceView=function(){var dialog='.device-registration-popup';var showError=function(field,message){if(field=='submit'){$(dialog).find('.buttons').after('<p class="error">'+message+'</p>');}else{$(dialog).find('[name="'+field+'"]').after('<p class="error">'+message+'</p>');}}
return{checkInputs:function(){$(dialog).find('p.error').hide();$(dialog).find('button.save').removeAttr('disabled');if($('input[name="name"]',$(dialog)).val()==''){$(dialog).find('button.save').attr('disabled','disabled');return false;}
if($('.device-id').text()==''){$(dialog).find('button.save').attr('disabled','disabled');return false;}
if($('input#autocomplete',$(dialog)).is(':visible')){if($('input#autocomplete').attr('data-state')!='validated'){$(dialog).find('button.save').attr('disabled','disabled');return false;}}
if($('input#latitude',$(dialog)).val()==''||isNaN($('input#latitude').val())||$('input#longitude',$(dialog)).val()==''||isNaN($('input#longitude').val())){$(dialog).find('button.save').attr('disabled','disabled');return false;}
if($('select.device-registration-sensor-interval',$(dialog)).val()=='custom'){var customInterval=$('input#custom-interval',$(dialog)).val();var pattern=/^\d+$/;if(!(pattern.test(customInterval))){return false;}}},showErrors:function(errors){for(var field in errors)
showError(field,errors[field]);}}}();var FilterController=function(){var unfiltered=function(){var data;return{get:function(){return $(data).deepCopy();},set:function(newData){data=$(newData).deepCopy();}}}();return{clearFilters:function(){$('.library-view .filters input[type=checkbox]:checked').click();},init:function(){var event,filterType,self=this;$(ItemController).bind('itemloaded',function(event,item,previousItem){unfiltered.set(item);$(self).trigger('itemloaded',[item,previousItem]);});$('.library-view .filters .filter-type').each(function(){filterType=$(this).attr('class').replace(/.*\bfilter\-type\-(.+?)\b.*/,"$1");$(this).find('input[type=checkbox]').change(function(){var filterVal=$(this).val(),func=$(this).is(':checked')?'addFilter':'removeFilter',raw;FilterModel[func].call(FilterModel,filterType,filterVal);});});$(FilterModel).bind('filterschanged',function(){var raw=unfiltered.get();if(raw){switch(MasterController.getCurrentView()){case ItemView:$(Temboo).trigger('layoutchange');break;}}});}}}();var FilterModel=function(){var filters={};return{addFilter:function(filterType,filterVal){Temboo.log('FilterModel.addFilter',filterType+' += '+filterVal);if(typeof filters[filterType]==='undefined')
filters[filterType]=new Array();filters[filterType].push(filterVal);$(this).trigger('filterschanged');},filterItems:function(itemUris){var filterVal,didFilter=false,filtered=new Array(),item,uri;for(var filterType in filters){for(var i in filters[filterType]){didFilter=true;filterVal=filters[filterType][i];Temboo.log('FilterController.filterItems','Filtering on '+filterType+' = '+filterVal);for(var n in itemUris){uri=itemUris[n];item=LibraryModel.get(uri);if(item[filterType]!=null){for(var x in item[filterType]){if(item[filterType][x]==filterVal){filtered.push(uri);}}}}}}
return didFilter?filtered:itemUris;},filterSearchResults:function(result){if(result.docs.length){var filtered,uri,results={},uris=new Array();for(var i in result.docs){uri=result.docs[i].uri;results[uri]=result.docs[i];uris.push(uri);}
filtered=this.filterItems(uris);if(filtered.length<result.docs.length){result.docs=new Array();for(i in filtered)
result.docs.push(results[filtered[i]]);result.numFound=result.docs.length;}}
return result;},getKeywords:function(){return(typeof filters.keywords!='undefined')?filters.keywords:[];},removeFilter:function(filterType,filterVal){if(typeof filters[filterType]!=='undefined'){for(var i in filters[filterType]){if(filters[filterType][i]==filterVal){filters[filterType].splice(i,1);Temboo.log('FilterModel.removeFilter',filterType+' -= '+filterVal);$(this).trigger('filterschanged');break;}}}}}}();var IoTModeController=function(){var iotMode;var brand;var device;var network;var service;var gateway;var protocol;var shield;var deviceBrandMap={'ArduinoYun':'Arduino','ArduinoMKR1000':'Arduino','ArduinoMega':'Arduino','ArduinoZero':'Arduino','Arduino101':'Arduino','ArduinoUno':'Arduino','Qualcomm':'Qualcomm','Samsung.Artik.Ten':'Samsung','ti_cc3200':'TI','ti_cc3100':'TI'};var shieldDeviceMap={'ti_cc3100':'ti_cc3100','ti_cc3200':'ti_cc3200','ti_cc3200_rtos':'ti_cc3200','arduinowifir3':'ArduinoOthers','arduinoethernetr3':'ArduinoOthers','arduinogsm':'ArduinoOthers','adafruitwificc3000':'ArduinoOthers','redbearlabble':'ArduinoOthers','arduinowifi101':'ArduinoOthers','Arduino Yún Shield':'ArduinoOthers','mkr1000':'ArduinoMKR1000','qcom_qca4002':'Qualcomm'};var arduinoClassicDevices=['ArduinoMega','ArduinoZero','Arduino101','ArduinoUno'];var originalArduinos=['arduinowifir3','arduinoethernetr3','arduinogsm','adafruitwificc3000'];var deviceShortNameMap={'ArduinoMega':'mega','ArduinoUno':'uno','ArduinoZero':'zero','Arduino101':'a101','ArduinoMKR1000':'mkr1000'};var shieldShortNameMap={'Arduino Yún Shield':'yun','arduinoethernetr3':'eth','arduinowifir3':'wifi','adafruitwificc3000':'cc3000','arduinowifi101':'w101','arduinogsm':'gsm'};var devices=['ArduinoYun','ArduinoMKR1000','ArduinoMega','ArduinoZero','Arduino101','ArduinoUno','ArduinoOthers','Qualcomm','Samsung.Artik.Ten','ti_cc3200','ti_cc3100'];var invalidShieldDevicePairs={'arduinowifi101':['ArduinoUno'],'arduinogsm':['ArduinoUno','ArduinoZero','Arduino101'],'redbearlabble':['ArduinoZero','Arduino101']};return{init:function(){iotMode=$.cookie('library_iot_mode')==='false'?false:true;IoTModeController.setBrand('Arduino');if(!FEATURE_QUALCOMM&&$.cookie('library_iot_device')=='Qualcomm'){IoTModeController.setDevice(null);}else{IoTModeController.setDevice($.cookie('library_iot_device'));}
IoTModeController.setNetwork($.cookie('library_iot_network'));if($.inArray($.cookie('library_iot_device'),GatewayController.getGatewayDevices())>-1){IoTModeController.setGateway($.cookie('library_iot_gateway'));}
$(ItemController).bind('itemloaded',function(event){var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.isChoreo()){if(!currentItem.deviceNetworkCredentials.data){currentItem.deviceNetworkCredentials.data={};}
if(!currentItem.gatewayCredentials.data){currentItem.gatewayCredentials.data={};}
IoTModeView.updateDeviceSelector(currentItem);IoTModeView.updateNetworkSelector(currentItem);if(device=='ArduinoYun'||device=='Samsung.Artik.Ten'){IoTModeView.hideConnectivity();}else{IoTModeView.showConnectivity();}
IoTModeView.updateGatewaySelector(currentItem);IoTModeView.updateSensorSelector();IoTModeView.updateActuatorSelector();IoTModeView.updateChoreoDetails(currentItem);IoTModeView.updateSnippets(currentItem);IoTModeView.updateTriggers();IoTModeView.showIoTModeControls();if((device&&device=='Qualcomm')||(shield&&shield=='redbearlabble')){IoTModeView.hidePinSelector();}
if(device&&device=='Qualcomm'){IoTModeView.showSDKLearnLink();}
SensorInputController.addSensorButton();IoTModeView.setCompilable();}
else{IoTModeView.hideIoTModeControls();}});IoTModeView.toggle(iotMode);TriggerController.init();PinboardController.init();$(Temboo).trigger('initialized.IoTModeController');},getBrand:function(){return brand;},setBrand:function(brandName){if(brandName!='Arduino'&&brandName!='TI'&&brandName!='Samsung'&&brandName!='Qualcomm'){return false;}
brand=brandName;var currentItem=ItemController.getCurrentItem();if(IoTModeController.enabled()&&currentItem&&currentItem.isChoreo){IoTModeView.updateDeviceSelector(currentItem);IoTModeView.updateSnippets(currentItem);}
$(IoTModeController).trigger('brandchanged',brand);},getDevice:function(){return device;},getDeviceType:function(){if(device=='ArduinoYun'){return'Arduino Yun';}else if(device=='ArduinoMKR1000'){return'Arduino MKR1000';}else if(device=='ArduinoUno'){return'Arduino Uno';}else if(device=='ArduinoMega'){return'Arduino Mega';}else if(device=='ArduinoZero'){return'Arduino Zero';}else if(device=='Arduino101'){return'Arduino 101';}else if(device=='Samsung.Artik.Ten'){return'Samsung ARTIK 10';}else if(device=='ti_cc3100'){return'TI CC3100 WiFi BoosterPack';}else if(device=='ti_cc3200'){if(shield=='ti_cc3200'){return'TI CC3200 LaunchPad (WiFi)';}else if(shield=='ti_cc3200_rtos'){return'TI CC3200 LaunchPad (WiFi) + RTOS';}}
return null;},getDeviceShortName:function(){if(deviceShortNameMap[device]){return deviceShortNameMap[device];}
return null;},getShieldShortName:function(){if(shieldShortNameMap[shield]){return shieldShortNameMap[shield];}},setDevice:function(deviceName){if(device&&device===deviceName){return false;}
device=deviceName;if($.inArray(device,devices)==-1){device=null;}
$.cookie('library_iot_device',device,{expires:180,path:'/'});if(!device){$('.connectivity').addClass('disabled');}else{$('.connectivity').removeClass('disabled');}
var currentItem=ItemController.getCurrentItem();if(IoTModeController.enabled()&&currentItem&&currentItem.isChoreo){if(device=='ArduinoYun'||device=='Samsung.Artik.Ten'){IoTModeController.setNetwork(null);IoTModeView.hideConnectivity();}else{if(device=='Qualcomm'||(shield&&shield=='redbearlabble')){if(device=='Qualcomm'){IoTModeView.showSDKLearnLink();}else{IoTModeView.showIoTLearnLink();}
IoTModeView.hidePinSelector();$('.trigger').hide();}else{IoTModeView.showPinSelector();IoTModeView.showIoTLearnLink();$('.trigger').show();}
if(!currentItem.deviceNetworkCredentials.data){currentItem.deviceNetworkCredentials.data={};}
IoTModeView.updateChoreoDetails(currentItem);IoTModeView.updateSnippets(currentItem);IoTModeView.showConnectivity();}
IoTModeView.updateNetworkSelector(currentItem);IoTModeView.updateGatewaySelector(currentItem);IoTModeView.updateSensorSelector();IoTModeView.updateActuatorSelector();DocPanelController.setPlatform();}
IoTModeView.setCompilable();$(IoTModeController).trigger('devicechanged',device);},getNetwork:function(){return network;},getService:function(){return service;},getShield:function(){return shield;},getGateway:function(){return gateway;},getProtocol:function(){return protocol;},gatewayEnabled:function(){return gateway&&$.inArray(device,GatewayController.getGatewayDevices())>-1;},getGatewayJSON:function(){var currentItem=ItemController.getCurrentItem();if(!gateway||!IoTModeController.enabled()||!IoTModeController.gatewayEnabled()||!currentItem||!currentItem.isChoreo()||!currentItem.gatewayCredentials||!currentItem.gatewayCredentials.data||!currentItem.gatewayCredentials.data[gateway]||GatewayController.getSelectedTab()=='Gateway'){return null;}
var gatewayCredential=currentItem.gatewayCredentials.data[gateway];var IPAddress;if(gatewayCredential.inputs.IPAddress){IPAddress=gatewayCredential.inputs.IPAddress.split('.');if(protocol=='http'&&GatewayController.getEdgeShield()=='adafruitwificc3000'){IPAddress=IPAddress.reverse();}}else{IPAddress='';}
var json={IPAddress:IPAddress,protocol:protocol}
if(protocol=='mqtt'||protocol=='coap'){json.cpp=true;}
return JSON.stringify(json);},setNetwork:function(deviceNetworkCredentialName){var currentItem=ItemController.getCurrentItem();network=deviceNetworkCredentialName;$.cookie('library_iot_network',network,{expires:180,path:'/'});if(currentItem&&currentItem.isChoreo()){if(!currentItem.deviceNetworkCredentials.data){currentItem.deviceNetworkCredentials.data={};}else if(network=='Arduino Yún Shield'){shield='Arduino Yún Shield';}else{shield=network?currentItem.deviceNetworkCredentials.data[network].inputs.Shield:null;}
IoTModeView.updateChoreoDetails(currentItem);}
if(IoTModeController.enabled()){if(shield=='redbearlabble'||(device&&device=='Qualcomm')){if(device=='Qualcomm'){IoTModeView.showSDKLearnLink();}else{IoTModeView.showIoTLearnLink();}
IoTModeView.hidePinSelector();$('.trigger').hide();}else{IoTModeView.showPinSelector();IoTModeView.showIoTLearnLink();$('.trigger').show();}
if(currentItem&&currentItem.isChoreo()){IoTModeView.updateGatewaySelector(currentItem);IoTModeView.updateSensorSelector();IoTModeView.updateActuatorSelector();}}
$(IoTModeController).trigger('networkchanged',network);},setGateway:function(gatewayCredentialName){var currentItem=ItemController.getCurrentItem();gateway=gatewayCredentialName;$.cookie('library_iot_gateway',gateway,{expires:180,path:'/'});if(currentItem&&currentItem.isChoreo()){if(!currentItem.gatewayCredentials.data){currentItem.gatewayCredentials.data={};}else{protocol=gateway?currentItem.gatewayCredentials.data[gateway].inputs.Protocol:null;}
IoTModeView.updateDeviceSelector(currentItem);if(gateway){var pins=PinController.getPins();$.each(pins,function(i,pin){if(pin.isTransducer()){var pinView=$('.pin[data-uid="'+pin.getId()+'"]');var transducer=pin.getDirection();pin.removeTransducer();pinView.removeClass('transducer');if(pinView.hasClass('selected')){pin.select(false);if(transducer=='sensor'&&TriggerView.isOpen('input')){TriggerView.hide('input');TriggerController.removeInputTrigger(pin.getLabel());}else if(transducer=='actuator'&&TriggerView.isOpen('output')){TriggerView.hide('output');TriggerController.removeOutput(pin.getLabel());}}
if(transducer=='sensor'){IoTModeView.updateSensorSelector();}else if(transducer=='actuator'){IoTModeView.updateActuatorSelector();}}});}
IoTModeView.updateChoreoDetails(currentItem);IoTModeView.setCompilable();}
$(IoTModeController).trigger('gatewaysettingschanged',gateway);},enable:function(){iotMode=true;$.cookie('library_iot_mode','true',{expires:180,path:'/'});$(IoTModeController).trigger('iotmodeenabled');DocPanelController.setPlatform();DocPanelController.toggleIoTMode(true);var item=ItemController.getCurrentItem();IoTModeView.toggle(true,item);},disable:function(){iotMode=false;$.cookie('library_iot_mode','false',{expires:180,path:'/'});$(IoTModeController).trigger('iotmodedisabled');DocPanelController.setPlatform();DocPanelController.toggleIoTMode(false);var item=ItemController.getCurrentItem();IoTModeView.toggle(false,item);},toggle:function(setEnabled){setEnabled=arguments.length==1?setEnabled:iotMode==false;if(setEnabled)
IoTModeController.enable();else
IoTModeController.disable();},enabled:function(){return iotMode;},sensorInputsEnabled:function(){return iotMode&&DeviceController.deviceHasTransducers()&&(!IoTModeController.gatewayEnabled());},BLEEnabled:function(){var currentItem=ItemController.getCurrentItem();return(ItemController.getLoggedIn()&&iotMode&&IoTModeController.isArduinoClassicDevice(device)&&network&&currentItem&&currentItem.deviceNetworkCredentials&&currentItem.deviceNetworkCredentials.data&&currentItem.deviceNetworkCredentials.data[network]&&currentItem.deviceNetworkCredentials.data[network].inputs.Shield&&currentItem.deviceNetworkCredentials.data[network].inputs.Shield=='redbearlabble');},getShieldDevice:function(shield){return shieldDeviceMap[shield];},getDeviceBrand:function(device){return deviceBrandMap[device];},isValidShieldDevicePair:function(shield,device){return $.inArray(device,invalidShieldDevicePairs[shield])==-1;},getOriginalArduinos:function(){return originalArduinos;},isArduinoClassicDevice:function(){return $.inArray(device,arduinoClassicDevices)>-1;},pruneInputs:function(inputs){if(IoTModeController.sensorInputsEnabled()&&inputs){for(var key in ItemController.getSensorInputNames()){if(inputs[key])delete inputs[key];}}},addCloudKeys:function(params,binary){if(!params.board)params.board={};params.board.binary=binary;var deviceId=$('.device-registration-form .device-id').text();if(binary&&deviceId){params.board.deviceName=deviceId;delete params.board.deviceType;}else{params.board.deviceType=IoTModeController.getDeviceType();var deviceShortName=IoTModeController.getDeviceShortName();var shieldShortName=IoTModeController.getShieldShortName();if(deviceShortName){if(shieldShortName){params.board.deviceType=deviceShortName+'+'+shieldShortName;}else{params.board.deviceType=deviceShortName;}}
delete params.board.deviceName;}}};}();$(Temboo).trigger('ready.IoTModeController');var IoTModeView=function(){var $iotControls=$('.details-view .iot-mode-controls');var $pinSelector=$('.details-view #pin-selector');var $iotSdkDownload=$('.details-view .iot-sdk-download');var noGatewayOption='Want to use it as a gateway?';return{hideIoTModeControls:function(){$iotControls.hide();},showIoTModeControls:function(){$iotControls.show();},hideConnectivity:function(){$('#iot-mode-container .connectivity').hide();$('#iot-mode-container .connectivity-not-needed').show();$('.details-view .item-view .metadata .meta-class.snippet').find('.selectBox-dropdown').hide();var view=$('.details-view .item-view .meta-class.snippet.main');$('.iot-ble-task .select-container').detach().prependTo(view);},showConnectivity:function(){$('#iot-mode-container .connectivity-not-needed').hide();$('#iot-mode-container .connectivity').show();},hidePinSelector:function(){$pinSelector.hide();},showPinSelector:function(){$pinSelector.show();},showSDKLearnLink:function(){$iotSdkDownload.hide();$('.sdk-download').show();},showIoTLearnLink:function(){$iotSdkDownload.show();$('.sdk-download').hide();},toggle:function(enable,item){var $iotModeContainer=$('#iot-mode-container');var currentItem=ItemController.getCurrentItem();if(enable&&currentItem&&currentItem.isChoreo()){$iotModeContainer.show();if(!IoTModeController.BLEEnabled()&&IoTModeController.getDevice()!='Qualcomm'){$pinSelector.show();IoTModeView.showIoTLearnLink();}else if(IoTModeController.BLEEnabled()){$pinSelector.hide();IoTModeView.showIoTLearnLink();}else{$pinSelector.hide();IoTModeView.showSDKLearnLink();}}
else{$iotModeContainer.hide();$pinSelector.hide();IoTModeView.showSDKLearnLink();}
if(item){IoTModeView.updateChoreoDetails(item);IoTModeView.updateSnippets(item);IoTModeView.updateTriggers();}},updateDeviceSelector:function(item){var $deviceSelector=$('#iot-mode-device-selector');$(ItemController).unbind('unload.selectiotmodedevice');$deviceSelector.off('change').off('close');$deviceSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();})
$deviceSelector.empty();if(IoTModeController.getBrand()){var brand=IoTModeController.getBrand();if(brand=='Arduino'){$deviceSelector.append('<option value="ArduinoYun">Arduino Yún</option>').append('<option value="ArduinoMKR1000">Arduino MKR1000</option>').append('<option value="ArduinoMega">Arduino Mega</option>').append('<option value="ArduinoZero">Arduino Zero</option>').append('<option value="Arduino101">Arduino 101</option>').append('<option value="ArduinoUno">Arduino Uno</option>');}else if(brand=='TI'){$deviceSelector.append('<option value="ti_cc3200">TI CC3200</option>\
										<option value="ti_cc3100">TI CC3100 BoosterPack</option>');}else if(brand=='Samsung'){$deviceSelector.append('<option value="Samsung.Artik.Ten">'+BoardModel.Samsung.Artik.Ten.marketingName+'</option>');}else if(brand=='Qualcomm'){$deviceSelector.append('<option value="Qualcomm">Qualcomm</option>');}}
if(IoTModeController.getGateway()){$('option',$deviceSelector).each(function(){if($.inArray($(this).val(),GatewayController.getGatewayDevices())>-1){$(this).text($(this).text()+' Gateway');}});}
var firstNetwork;if(!IoTModeController.getBrand()){firstNetwork=item.deviceNetworkCredentials.data[Object.keys(item.deviceNetworkCredentials.data)[0]];}
if(IoTModeController.getDevice()){if(IoTModeController.getDeviceBrand(IoTModeController.getDevice())==IoTModeController.getBrand()){$deviceSelector.val(IoTModeController.getDevice());}else{IoTModeController.setDevice(null);if($('option',$deviceSelector).length==1){IoTModeController.setDevice($deviceSelector.val());}else{$deviceSelector.prepend('<option class="option-label-only">What\'s your device?</option>').val('Select');}}}else if(IoTModeController.getNetwork()&&item.deviceNetworkCredentials.data&&item.deviceNetworkCredentials.data[IoTModeController.getNetwork()]&&IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield)!='ArduinoOthers'){if(IoTModeController.getDeviceBrand(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield))==IoTModeController.getBrand()){IoTModeController.setDevice(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield));if(IoTModeController.getDevice()){$deviceSelector.val(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield));}}else{IoTModeController.setNetwork(null);$deviceSelector.prepend('<option class="option-label-only">What\'s your device?</option>').val('Select');}}else if(ItemController.getLoggedIn()&&firstNetwork){var shieldDevice=IoTModeController.getShieldDevice(firstNetwork.inputs.Shield);if(shieldDevice=='ArduinoOthers'){shieldDevice='ArduinoMega';}
IoTModeController.setDevice(shieldDevice);$deviceSelector.val(shieldDevice);}else if($('option',$deviceSelector).length==1){IoTModeController.setDevice($deviceSelector.val());}else{$deviceSelector.prepend('<option class="option-label-only">What\'s your device?</option>').val('Select');}
var elideBy=$deviceSelector.data('max-chars');if(!elideBy||elideBy.length<1){elideBy=17;}
$deviceSelector.selectBox().on('change',function(event){var selectedDevice=$(this).val();if(selectedDevice!='Select'){IoTModeController.setDevice(selectedDevice);IoTModeView.updateSnippets(item);if(IoTModeController.gatewayEnabled()){GatewayController.sendGatewayAnalytics();}
if(!$.cookie('initial_pin_callout')){$('#pin-selector .board .pin.default-input').trigger('mouseenter').click();$.cookie('initial_pin_callout',true,{expires:180,path:'/'});}
if(selectedDevice!='ArduinoYun'){var shieldDevice=selectedDevice;var hasDevice=false;if(IoTModeController.isArduinoClassicDevice()){shieldDevice='ArduinoOthers';}
for(var optionName in item.deviceNetworkCredentials.data){if(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[optionName].inputs.Shield)==shieldDevice&&IoTModeController.isValidShieldDevicePair(item.deviceNetworkCredentials.data[optionName].inputs.Shield,selectedDevice)){hasDevice=true;break;}}
if(!hasDevice){CredentialsTemplateController.addCredential(event,selectedDevice);}}}});if($('option',$deviceSelector).length==1){$('a.selectBox.iot-mode-device-selector').addClass('single-option');}
$(ItemController).unbind('unload.selectiotmodedevice').bind('unload.selectiotmodedevice',function(e,item){$deviceSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});},updateNetworkSelector:function(item){var $networkSelector=$('#iot-mode-network-credential-selector')
$(ItemController).unbind('unload.selectiotmodenetworkcredential');$networkSelector.off('change').off('close');$networkSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();})
$networkSelector.html('');var device=IoTModeController.getDevice();var options=[];var elideBy=$networkSelector.data('max-chars');if(!elideBy||elideBy.length<1){elideBy=17;}
var originalArduinos=IoTModeController.getOriginalArduinos();if(device=='ti_cc3100'){for(var optionName in item.deviceNetworkCredentials.data){if(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[optionName].inputs.Shield)=='ti_cc3100'){options.push('<option value="'+optionName+'">'+$.temboo.elide(optionName,elideBy,'middle')+'</option>');}}}else if(device=='ti_cc3200'){for(var optionName in item.deviceNetworkCredentials.data){if(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[optionName].inputs.Shield)=='ti_cc3200'){options.push('<option value="'+optionName+'">'+$.temboo.elide(optionName,elideBy,'middle')+'</option>');}}}else if(IoTModeController.isArduinoClassicDevice()){for(var optionName in item.deviceNetworkCredentials.data){if(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[optionName].inputs.Shield)=='ArduinoOthers'){if((FEATURE_ORIGINAL_ARDUINOS||$.inArray(item.deviceNetworkCredentials.data[optionName].inputs.Shield,originalArduinos)==-1)&&IoTModeController.isValidShieldDevicePair(item.deviceNetworkCredentials.data[optionName].inputs.Shield,device)){options.push('<option value="'+optionName+'">'+$.temboo.elide(optionName,elideBy,'middle')+'</option>');}}}}else if(device=='ArduinoMKR1000'){for(var optionName in item.deviceNetworkCredentials.data){if(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[optionName].inputs.Shield)=='ArduinoMKR1000'){options.push('<option value="'+optionName+'">'+$.temboo.elide(optionName,elideBy,'middle')+'</option>');}}}else if(device=='Qualcomm'){for(var optionName in item.deviceNetworkCredentials.data){if(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[optionName].inputs.Shield)=='Qualcomm')
options.push('<option value="'+optionName+'">'+$.temboo.elide(optionName,elideBy,'middle')+'</option>');}}
if(options.length>0){if(IoTModeController.isArduinoClassicDevice()){options.push('<option value="Shield type" class="new-device-network-credential device-network-credential-component choose-device-network-credential">Add a new shield:</option>');if(device!='ArduinoUno'){options.push('<option value="new-arduinowifi101" class="new-device-network-credential device-network-credential-component">Arduino WiFi 101 Shield</option>');}
options.push('<option value="Arduino Yún Shield" class="arduino-yun-shield device-network-credential-component">Arduino Yún Shield</option>');if(device!='ArduinoZero'&&device!='Arduino101'){options.push('<option value="new-redbearlabble" class="new-device-network-credential device-network-credential-component">RedBearLab Bluetooth LE Shield</option>');}
if(FEATURE_ORIGINAL_ARDUINOS){options.push('<option value="new-arduinowifir3" class="new-device-network-credential device-network-credential-component">Arduino WiFi Shield</option>\
			    					<option value="new-arduinoethernetr3" class="new-device-network-credential device-network-credential-component">Arduino Ethernet Shield</option>');if(device!='ArduinoUno'&&device!='ArduinoZero'&&device!='Arduino101'){options.push('<option value="new-arduinogsm" class="new-device-network-credential device-network-credential-component">Arduino GSM Shield</option>');}
options.push('<option value="new-adafruitwificc3000" class="new-device-network-credential device-network-credential-component">Adafruit CC3000 WiFi Shield</option>');}}else if(device=='ArduinoMKR1000'){options.push('<option value="Shield type" class="new-device-network-credential device-network-credential-component choose-device-network-credential">Add a new shield:</option>\
			    					<option value="new-mkr1000" class="new-device-network-credential device-network-credential-component">Arduino MKR1000 (WiFi)</option>');}else if(device=='ti_cc3100'){options.push('<option value="Shield type" class="new-device-network-credential device-network-credential-component choose-device-network-credential">Add a new connection:</option>');options.push('<option value="new-ti_cc3100" class="new-device-network-credential device-network-credential-component">TI CC3100 BoosterPack (WiFi)</option>');}else if(device=='ti_cc3200'){options.push('<option value="Shield type" class="new-device-network-credential device-network-credential-component choose-device-network-credential">Add a new connection:</option>');if(FEATURE_RTOS){options.push('<option value="Shield type" class="device-network-credential-component device-network-category">TI-RTOS</option>\
				    					<option value="new-ti_cc3200_rtos" class="new-device-network-credential device-network-credential-component">TI CC3200 (WiFi) + RTOS</option>\
										<option value="Shield type" class="device-network-credential-component device-network-spacer"></option>\
				    					<option value="Shield type" class="device-network-credential-component device-network-category">Other</option>');}
options.push('<option value="new-ti_cc3200" class="new-device-network-credential device-network-credential-component">TI CC3200 (WiFi)</option>');}else if(device=='Qualcomm'){options.push('<option value="Shield type" class="new-device-network-credential device-network-credential-component choose-device-network-credential">Add a new connection:</option>\
				    					<option value="new-qcom_qca4002" class="new-device-network-credential device-network-credential-component">QCA4002 Dev Kit (WiFi)</option>');}
$networkSelector.html(options.join());if(IoTModeController.getNetwork()&&((IoTModeController.getNetwork()=='Arduino Yún Shield'&&IoTModeController.isArduinoClassicDevice(device))||item.deviceNetworkCredentials.data[IoTModeController.getNetwork()]&&(device==IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield)||(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield)=='ArduinoOthers'&&IoTModeController.isArduinoClassicDevice()))&&item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield!='ti_tm4c1294xl'&&IoTModeController.isValidShieldDevicePair(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield,device)&&(!$.inArray(item.deviceNetworkCredentials.data[IoTModeController.getNetwork()].inputs.Shield,originalArduinos)||FEATURE_ORIGINAL_ARDUINOS))){IoTModeController.setNetwork(IoTModeController.getNetwork());$networkSelector.val(IoTModeController.getNetwork());}else{var firstNetwork=$networkSelector.find('option:first').val();if(firstNetwork&&item.deviceNetworkCredentials.data[firstNetwork]){IoTModeController.setNetwork(firstNetwork);$networkSelector.val(firstNetwork);IoTModeView.updateSnippets(item);}}
$networkSelector.selectBox().on('change',function(){var selectedDeviceNetworkCredential=$(this).val();if(selectedDeviceNetworkCredential=='Select'){return false;}else if(selectedDeviceNetworkCredential=='Arduino Yún Shield'){IoTModeController.setNetwork(selectedDeviceNetworkCredential);IoTModeView.updateSnippets(item);return false;}
if(item.deviceNetworkCredentials.data[selectedDeviceNetworkCredential]){IoTModeController.setNetwork(selectedDeviceNetworkCredential);IoTModeView.updateSnippets(item);}else{$(this).val(IoTModeController.getNetwork());}}).on('close',function(){var selectedDeviceNetworkCredential=IoTModeController.getNetwork();if(selectedDeviceNetworkCredential&&selectedDeviceNetworkCredential.length>0){$('.device-network-credential-selector.selectBox-dropdown .selectBox-label').html($.temboo.elide(selectedDeviceNetworkCredential,elideBy,'middle'));}});$('.device-network-credential-selector-selectBox-dropdown-menu li.new-device-network-credential').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();if(!$(this).hasClass('choose-device-network-credential')){var networkName=$(this).find('a').attr('rel');IoTModeView.updateNetworkSelector(item);if(networkName!==''&&networkName!=='Arduino Yún Shield'){CredentialsTemplateController.addCredential(event,device,networkName.substring(4));}}});$('.selectBox-options.device-network-credential-selector-selectBox-dropdown-menu.iot-mode-component-selectBox-dropdown-menu li:not(.new-device-network-credential):not(.arduino-yun-shield)').each(function(){$('<button class="button xsmall edit-credential device-network-credential-component" value="'+$(this).find('a').attr('rel')+'">edit</button>').appendTo(this).click(function(e){IoTModeView.updateNetworkSelector(item);});});}else if(ItemController.getLoggedIn()){IoTModeView.updateSnippets(item);if(IoTModeController.isArduinoClassicDevice(device)){$networkSelector.html('<option class="option-label-only">How is it connected?</option>');if(device!='ArduinoUno'){$networkSelector.append('<option value="new-arduinowifi101">Arduino WiFi 101 Shield</option>');}
$networkSelector.append('<option value="Arduino Yún Shield" class="arduino-yun-shield">Arduino Yún Shield</option>');if(device!='ArduinoZero'&&device!='Arduino101'){$networkSelector.append('<option value="new-redbearlabble">RedBearLab Bluetooth LE Shield</option>');}
if(FEATURE_ORIGINAL_ARDUINOS){$networkSelector.append('<option value="new-arduinowifir3">Arduino WiFi Shield</option>\
						                           <option value="new-arduinoethernetr3">Arduino Ethernet Shield</option>');if(device!='ArduinoUno'&&device!='ArduinoZero'&&device!='Arduino101'){$networkSelector.append('<option value="new-arduinogsm">Arduino GSM Shield</option>');}
$networkSelector.append('<option value="new-adafruitwificc3000">Adafruit CC3000 WiFi Shield</option>');}}else if(device=='ArduinoMKR1000'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>\
				    			<option value="new-mkr1000">Arduino MKR1000 (WiFi)</option>');}else if(device=='ti_cc3100'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>');$networkSelector.append('<option value="new-ti_cc3100">TI CC3100 BoosterPack (WiFi)</option>');}else if(device=='ti_cc3200'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>');if(FEATURE_RTOS){$networkSelector.append('<option value="Shield type" class="device-network-credential-component device-network-category">TI-RTOS</option>\
			                           <option value="new-ti_cc3200_rtos">TI CC3200 (WiFi) + RTOS</option>\
			                           <option value="Shield type" class="device-network-credential-component device-network-spacer"></option>\
			                           <option value="Shield type" class="device-network-credential-component device-network-category">Other</option>');}
$networkSelector.append('<option value="new-ti_cc3200">TI CC3200 (WiFi)</option>');}else if(device=='Qualcomm'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>\
													<option value="new-qcom_qca4002">QCA4002 Dev Kit (WiFi)</option>');}else{$networkSelector.html('<option class="option-label-only">How is it connected?</option>');}
$networkSelector.selectBox().on('change',function(){}).on('close',function(){});$('.device-network-credential-selector-selectBox-dropdown-menu li').addClass('device-network-credential-component').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();var credentialName=$(this).find('a').attr('rel');if(credentialName!=''&&credentialName!='Arduino Yún Shield'){IoTModeView.updateNetworkSelector(item);if(device){CredentialsTemplateController.addCredential(event,IoTModeController.getDevice(),credentialName.substring(4));}else{CredentialsTemplateController.addCredential(event,IoTModeController.getShieldDevice(credentialName.substring(4)),credentialName.substring(4));}}else if(credentialName=='Arduino Yún Shield'){IoTModeController.setNetwork('Arduino Yún Shield');IoTModeView.updateNetworkSelector(item);}});if(IoTModeController.getNetwork()&&IoTModeController.getNetwork()=='Arduino Yún Shield'){IoTModeController.setNetwork(IoTModeController.getNetwork());$networkSelector.val(IoTModeController.getNetwork());$networkSelector.selectBox('value',IoTModeController.getNetwork());}else{IoTModeController.setNetwork(null);}}else{IoTModeController.setNetwork(null);IoTModeView.updateSnippets(item);if(IoTModeController.isArduinoClassicDevice(device)){$networkSelector.html('<option class="option-label-only">How is it connected?</option>');if(device!='ArduinoUno'){$networkSelector.append('<option class="disabled" value="arduinowifi101" disabled="disabled">Arduino WiFi 101 Shield</option>');}
$networkSelector.append('<option class="disabled" value="Arduino Yún Shield" disabled="disabled">Arduino Yún Shield</option>');if(device!='ArduinoZero'&&device!='Arduino101'){$networkSelector.append('<option class="disabled" value="redbearlabble" disabled="disabled">RedBearLab Bluetooth LE Shield</option>');}
if(FEATURE_ORIGINAL_ARDUINOS){$networkSelector.append('<option class="disabled" value="arduinowifir3" disabled="disabled">Arduino WiFi Shield</option>\
						                           <option class="disabled" value="arduinoethernetr3" disabled="disabled">Arduino Ethernet Shield</option>');if(device!='ArduinoUno'&&device!='ArduinoZero'&&device!='Arduino101'){$networkSelector.append('<option class="disabled" value="arduinogsm" disabled="disabled">Arduino GSM Shield</option>');}
$networkSelector.append('<option class="disabled" value="adafruitwificc3000" disabled="disabled">Adafruit CC3000 WiFi Shield</option>');}
$networkSelector.append('<option value="Shield type" class="new-device-network-credential device-network-credential-component logged-out">Log in to add shield</option>');}else if(device=='ArduinoMKR1000'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>\
					       							<option class="disabled" value="mkr1000" disabled="disabled">Arduino MKR1000 (WiFi)</option>');$networkSelector.append('<option value="Shield type" class="new-device-network-credential device-network-credential-component logged-out">Log in to add shield</option>');}else if(device=='ti_cc3100'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>');$networkSelector.append('<option class="disabled" value="ti_cc3100" disabled="disabled">TI CC3100 BoosterPack (WiFi)</option>\
						                           <option value="Shield type" class="new-device-network-credential device-network-credential-component logged-out">Log in to add connection</option>');}else if(device=='ti_cc3200'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>');if(FEATURE_RTOS){$networkSelector.append('<option value="Shield type" class="device-network-credential-component device-network-category">TI-RTOS</option>\
						                           <option class="disabled" value="ti_cc3200_rtos" disabled="disabled">TI CC3200 (WiFi) + RTOS</option>\
						                           <option value="Shield type" class="device-network-credential-component device-network-spacer"></option>\
						                           <option value="Shield type" class="device-network-credential-component device-network-category">Other</option>');}
$networkSelector.append('<option class="disabled" value="ti_cc3200" disabled="disabled">TI CC3200 (WiFi)</option>\
						                           <option value="Shield type" class="new-device-network-credential device-network-credential-component logged-out">Log in to add connection</option>');}else{$networkSelector.html('<option class="option-label-only">How is it connected?</option>');}
$networkSelector.selectBox().on('change',function(){}).on('close',function(){});$('.device-network-credential-selector-selectBox-dropdown-menu li.new-device-network-credential').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();return false;});}
$(ItemController).unbind('unload.selectiotmodenetworkcredential').bind('unload.selectiotmodenetworkcredential',function(e,item){$networkSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});},updateGatewaySelector:function(item){var $gatewaySelector=$('#iot-mode-gateway-credential-selector');$(ItemController).unbind('unload.selectiotmodegatewaycredential');$gatewaySelector.off('change').off('close');$gatewaySelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();})
$gatewaySelector.html('');var device=IoTModeController.getDevice();if($.inArray(device,GatewayController.getGatewayDevices())==-1){return false;}
var options=[];var elideBy=$gatewaySelector.data('max-chars');if(!elideBy||elideBy.length<1){elideBy=17;}
for(var optionName in item.gatewayCredentials.data){options.push('<option value="'+optionName+'">'+$.temboo.elide(optionName,elideBy,'middle')+'</option>');}
if(options.length>0){options.push('<option value="" class="no-gateway">Do not use gateway</option>\
				    					<option value="Gateway type" class="new-gateway-credential choose-gateway-credential gateway-credential-component">Add a new gateway device:</option>\
				    					<option value="new-mqtt" class="new-gateway-credential gateway-credential-component">MQTT</option>\
				    					<option value="new-http" class="new-gateway-credential gateway-credential-component">HTTP</option>\
				    					<option value="new-coap" class="new-gateway-credential gateway-credential-component">CoAP</option>');$gatewaySelector.html(options.join());if(IoTModeController.getGateway()&&item.gatewayCredentials.data[IoTModeController.getGateway()]){IoTModeController.setGateway(IoTModeController.getGateway());$gatewaySelector.val(IoTModeController.getGateway());}else{IoTModeController.setGateway(null);$gatewaySelector.val('');IoTModeView.updateSnippets(item);}
$gatewaySelector.selectBox().on('change',function(){var selectedGatewayCredential=$(this).val();if(selectedGatewayCredential=='Select'){return false;}else if(selectedGatewayCredential===''){IoTModeController.setGateway(null);GatewayController.sendGatewayAnalytics();}
if(item.gatewayCredentials.data[selectedGatewayCredential]){IoTModeController.setGateway(selectedGatewayCredential);IoTModeView.updateSnippets(item);GatewayController.sendGatewayAnalytics();}else{$(this).val(IoTModeController.getGateway()?IoTModeController.getGateway():'');}}).on('close',function(){var selectedGatewayCredential=IoTModeController.getGateway();if(selectedGatewayCredential&&selectedGatewayCredential.length>0){$('.gateway-credential-selector.selectBox-dropdown .selectBox-label').html($.temboo.elide(selectedGatewayCredential,elideBy,'middle'));}});$('.gateway-credential-selector-selectBox-dropdown-menu li.new-gateway-credential').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();if(!$(this).hasClass('choose-gateway-credential')){var protocolName=$(this).find('a').attr('rel');IoTModeView.updateGatewaySelector(item);CredentialsTemplateController.addCredential(event,IoTModeController.getDevice(),protocolName.substring(4));}});$('.selectBox-options.gateway-credential-selector-selectBox-dropdown-menu.iot-mode-component-selectBox-dropdown-menu li:not(.new-gateway-credential)').each(function(){var credentialName=$(this).find('a').attr('rel');if(credentialName!==''){$('<button class="button xsmall edit-credential gateway-credential-component" value="'+credentialName+'">edit</button>').appendTo(this).click(function(e){IoTModeView.updateGatewaySelector(item);});}});}else if(ItemController.getLoggedIn()){IoTModeController.setGateway(null);IoTModeView.updateSnippets(item);$gatewaySelector.html('<option class="option-label-only">'+noGatewayOption+'</option>\
									       		<option value="new-mqtt">MQTT</option>\
					                           <option value="new-http">HTTP</option>\
					                           <option value="new-coap">CoAP</option>\
					                           <option value="" class="no-gateway">Do not use gateway</option>');$gatewaySelector.selectBox().on('change',function(){if($(this).val()==''){noGatewayOption='Do not use gateway';}}).on('close',function(){});$('.gateway-credential-selector-selectBox-dropdown-menu li').addClass('gateway-credential-component').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();var protocolName=$(this).find('a').attr('rel');IoTModeView.updateGatewaySelector(item);CredentialsTemplateController.addCredential(event,IoTModeController.getDevice(),protocolName.substring(4));});}else{IoTModeController.setGateway(null);IoTModeView.updateSnippets(item);$gatewaySelector.html('<option class="option-label-only">Want to use it as a gateway?</option>\
									       		<option class="disabled" value="mqtt">MQTT</option>\
					                           <option class="disabled" value="http">HTTP</option>\
					                           <option class="disabled" value="coap">CoAP</option>\
					                           <option class="disabled no-gateway" value="">Do not use gateway</option>\
					                           <option value="Gateway type" class="new-gateway-credential logged-out gateway-credential-component">Log in to add a gateway</option>');$gatewaySelector.selectBox().on('change',function(){}).on('close',function(){});$('.gateway-credential-selector-selectBox-dropdown-menu li.new-gateway-credential').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();return false;});}
$(ItemController).unbind('unload.selectiotmodegatewaycredential').bind('unload.selectiotmodegatewaycredential',function(e,item){$gatewaySelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});},updateSensorSelector:function(){var $sensorSelector=$('#sensor-selector');var selectedSensor=$sensorSelector.val();$(ItemController).unbind('unload.selectsensor');$sensorSelector.off('change').off('close');$sensorSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();})
$('.input-trigger > .selectBox-container').remove();$sensorSelector.html('');var $inputTrigger=$('.trigger.input-trigger'),$inputPin=$('.trigger.input-trigger .pin'),$inputOp=$('.trigger.input-trigger select.operator.input'),$inputAnalogValue=$('.trigger.input-trigger .analog input.value'),$inputDigitalValue=$('.trigger.input-trigger .switch.digital-value .slider'),$inputSignal=$('.trigger.input-trigger .switch.signal .slider');var options=[];options.push('<option class="option-label-only">Which sensor should we use?</option>');var elideBy=$sensorSelector.data('max-chars');if(!elideBy||elideBy.length<1){elideBy=17;}
var pins=PinController.getPins();for(var pinId in pins){var pin=pins[pinId];if(pin.isSensor()){options.push('<option value="'+pin.getLabel()+'">'+$.temboo.elide(pin.getPinName(),elideBy,'middle')+'</option>')}}
if(options.length>1){options.push('<option value="" class="no-trigger">Do not use sensor to trigger</option>');$sensorSelector.html(options.join());if(selectedSensor&&selectedSensor!=''){$sensorSelector.val(selectedSensor);var pin=PinController.getPinByLabel(selectedSensor);if(pin&&pin.getPinName()){$('span.sensor-name',$inputTrigger).text(pin.getPinName());}
if(pin&&pin.getAnalogUnit()){$('span.analog-unit',$inputTrigger).text(pin.getAnalogUnit());}
if(pin&&pin.getUnitHigh()&&pin.getUnitLow()){$('.switch.digital-value .slider .left',$inputTrigger).text(pin.getUnitHigh());$('.switch.digital-value .slider .right',$inputTrigger).text(pin.getUnitLow());}else{$('.switch.digital-value .slider .left',$inputTrigger).text('High');$('.switch.digital-value .slider .right',$inputTrigger).text('Low');}}
$sensorSelector.selectBox().on('change',function(){var sensorLabel=$(this).val();if(sensorLabel&&sensorLabel!=''){TriggerView.show('input');var pin=PinController.getPinByLabel(sensorLabel);var oldPin=PinController.getPinByType('input');oldPin.relocate(pin);oldPin.select(false);pin.select();$(PinboardController).trigger('pinselected',pin);if(pin.isDigital()){TriggerController.setInputTrigger($inputPin.text(),'eq',$inputDigitalValue.hasClass('high')?'HIGH':'LOW');}else{TriggerController.setInputTrigger($inputPin.text(),$inputOp.selectBox('value'),$inputAnalogValue.val());}
TriggerView.setTriggerSignal('input',pin.getSignal());if(pin&&pin.getPinName()){$('span.sensor-name',$inputTrigger).text(pin.getPinName());}
if(pin&&pin.getAnalogUnit()){$('span.analog-unit',$inputTrigger).text(pin.getAnalogUnit());}
if(pin&&pin.getUnitHigh()&&pin.getUnitLow()){$('.switch.digital-value .slider .left',$inputTrigger).text(pin.getUnitHigh());$('.switch.digital-value .slider .right',$inputTrigger).text(pin.getUnitLow());}else{$('.switch.digital-value .slider .left',$inputTrigger).text('High');$('.switch.digital-value .slider .right',$inputTrigger).text('Low');}}else{var oldPin=PinController.getPinByType('input');oldPin.select(false);TriggerView.hide('input');TriggerController.removeInputTrigger($inputPin.text());}
SnippetController.loadUserSnippet();}).on('close',function(){});$('.subtitle',$inputTrigger).show();$('.selectBox-container',$inputTrigger).show();}else{$('.subtitle',$inputTrigger).hide();$('.selectBox-container',$inputTrigger).hide();SnippetController.loadUserSnippet();}
$(ItemController).unbind('unload.selectsensor').bind('unload.selectsensor',function(e,item){$sensorSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});},updateActuatorSelector:function(){var $actuatorSelector=$('#actuator-selector')
var selectedActuator=$actuatorSelector.val();$(ItemController).unbind('unload.selectactuator');$actuatorSelector.off('change').off('close');$actuatorSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();})
$('.output-trigger > .selectBox-container').remove();$actuatorSelector.html('');var $outputTrigger=$('.details-view .item-view .trigger.output-trigger'),$outputPin=$('.trigger.output-trigger .pin'),$outputAnalogValue=$('.trigger.output-trigger .analog input.value'),$outputDigitalValue=$('.trigger.output-trigger .switch.digital-value .slider'),$outputSignal=$('.trigger.output-trigger .switch.signal .slider'),$outputName=$('.trigger.output-trigger select.output-name'),successOnly=$('span.success').length>0;var options=[];options.push('<option class="option-label-only">Which actuator should we use?</option>');var elideBy=$actuatorSelector.data('max-chars');if(!elideBy||elideBy.length<1){elideBy=17;}
var pins=PinController.getPins();for(var pinId in pins){var pin=pins[pinId];if(pin.isActuator()){options.push('<option value="'+pin.getLabel()+'">'+$.temboo.elide(pin.getPinName(),elideBy,'middle')+'</option>')}}
if(options.length>1){options.push('<option value="" class="no-trigger">Do not trigger a hardware event</option>');$actuatorSelector.html(options.join());if(selectedActuator&&selectedActuator!=''){$actuatorSelector.val(selectedActuator);var pin=PinController.getPinByLabel(selectedActuator);if(pin&&pin.getPinName()){$('span.actuator-name',$outputTrigger).text(pin.getPinName());}}
$actuatorSelector.selectBox().on('change',function(){var actuatorLabel=$(this).val();if(actuatorLabel&&actuatorLabel!=''){TriggerView.show('output');var pin=PinController.getPinByLabel(actuatorLabel);var oldPin=PinController.getPinByType('output');oldPin.relocate(pin);oldPin.select(false);pin.select();$(PinboardController).trigger('pinselected',pin);if(successOnly){TriggerController.setSuccess($('.trigger.output-trigger .switch.truth .slider').hasClass('true'));}else{if($('.output-operator').is(':empty')){$outputName.selectBox().trigger('change');}else{$outputTrigger.trigger('showOutputTrigger');}}
TriggerController.setOutputAction($outputPin.text(),pin.isDigital()?($outputDigitalValue.hasClass('high')?'HIGH':'LOW'):$outputAnalogValue.val());TriggerView.setTriggerSignal('output',pin.getSignal());if(pin&&pin.getPinName()){$('span.actuator-name',$outputTrigger).text(pin.getPinName());}}else{var oldPin=PinController.getPinByType('output');oldPin.select(false);TriggerView.hide('output');TriggerController.removeOutput($outputPin.text());}
SnippetController.loadUserSnippet();}).on('close',function(){});$('.subtitle',$outputTrigger).show();$('.selectBox-container',$outputTrigger).show();}else{$('.subtitle',$outputTrigger).hide();$('.selectBox-container',$outputTrigger).hide();}
$(ItemController).unbind('unload.selectactuator').bind('unload.selectactuator',function(e,item){$actuatorSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});},updateChoreoDetails:function(item){var $snippets=$('.details-view .item-view .metadata .meta-class.snippet');SnippetView.removeDownloadSavedForm();if(IoTModeController.enabled()){$('#iot-mode-container').show();if(!CLOUD_CONTROLS_ACCESS||!DeviceController.deviceHasCloudControls()||IoTModeController.gatewayEnabled()||$.isEmptyObject(DeviceController.getPinJSON())||$('.trigger.input-trigger .condition p.error').is(':visible')){$('.download-compiled-container button.download-compiled').addClass('disabled');$('.download-compiled-container li .check').hide();}else{$('.download-compiled-container button.download-compiled').removeClass('disabled');$('.download-compiled-container li .check').show();}
$('.select-container button.download-link').show();if(IoTModeController.getDevice()=='TI'||(IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'&&GatewayController.getSelectedProperty('device')=='TI')){$('.select-container .export-container button.ccs').show();}else{$('.select-container .export-container button.ccs').hide();}
if(IoTModeController.BLEEnabled()){var view=$('.details-view .item-view .meta-class.snippet.iot-ble-task');$('.details-view .item-view .meta-class.snippet.main .select-container').detach().prependTo(view);$('select.language',view).remove();$('a.selectBox.language').parent().remove();var langDropDown=$('<select />').addClass('language');langDropDown.append('<option name="language">Android</option>');langDropDown.append('<option name="language">iOS</option>');$('.select-container',view).append(langDropDown);langDropDown.selectBox().bind('change',function(){$(SnippetView).trigger('languageChanged');Temboo.trackEvent("Library","Sample code language selected",$(this).val());language=$(this).val();SnippetController.setLanguage(language);$.cookie('ble_language_snippet',language,{expires:180,path:'/'});$('.select-container button.download-link .download-text').html('Download '+language+' App');SnippetView.update(language,item.model.snippets);ChoreoController.runModeIsActive()&&SnippetController.loadUserSnippet();});if($.cookie('ble_language_snippet'))
$('.item-view .meta-class.snippet.iot-ble-task select.language.selectBox').selectBox('value',$.cookie('ble_language_snippet'));else
$('.item-view .meta-class.snippet.iot-ble-task select.language.selectBox').selectBox('value','iOS');$('.item-view .meta-class.snippet .select-container').show();$('.select-container button.download-link .download-text').html('Download '+$('.item-view .meta-class.snippet.iot-ble-task select.language.selectBox').selectBox('value')+' App');}else{$('.item-view .meta-class.snippet select.language').selectBox('destroy').hide();var view=$('.details-view .item-view .meta-class.snippet.main');$('.iot-ble-task .select-container').detach().prependTo(view);$('.select-container button.download-link .download-text').html('Download source code');}}else{$('.item-view .meta-class.snippet select.language').selectBox('destroy').hide();var view=$('.details-view .item-view .meta-class.snippet.main');$('.iot-ble-task .select-container').detach().prependTo(view);$('#iot-mode-container').hide();$('.select-container button.download-link').hide();$('.select-container .export-container button.ccs').hide();if($snippets.filter('.main').hasClass('tmb-collapsed')){$snippets.find('.selectBox-dropdown').hide();$snippets.find('.select-container').hide();}else{$snippets.find('.selectBox-dropdown').show();$snippets.find('.select-container').show();}
$snippets.filter('.main').find('.subtitle').html('Code');$('.language-selectBox-dropdown-menu').children().show();$('.language-selectBox-dropdown-menu').find('a[rel=Android]').parent().hide();$('.language-selectBox-dropdown-menu').css('min-height','260px');}
GatewayView.updateChoreoDetails(item);$(ItemsView).trigger('heightchanged');},updateSnippets:function(item){var language;var brand=IoTModeController.getBrand();var device=IoTModeController.getDevice();var network=IoTModeController.getNetwork();var shield=IoTModeController.getShield();var staticLanguage='IoT Default Sketch';if(IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'){device=GatewayController.getSelectedProperty('device');network=GatewayController.getSelectedProperty('network');shield=GatewayController.getEdgeShield();}
if((device=='ArduinoMKR1000'||IoTModeController.isArduinoClassicDevice(device))&&network){language='Arduino Classic';}else if(device=='ArduinoYun'){language='Arduino Yún';staticLanguage='Arduino Yún';}else if(device=='ti_cc3100'&&network){language='Texas Instruments LaunchPad';}else if(device=='ti_cc3200'&&network){if(shield=='ti_cc3200_rtos'){language='Texas Instruments CC3200 RTOS';}else{language='Texas Instruments LaunchPad';}}else if(device=='Samsung.Artik.Ten'){language=BoardModel.Samsung.Artik.Ten.marketingName;}else if(device=='Qualcomm'&&network){language='Qualcomm QCA4002';}else{language='IoT Default Sketch';}
if(IoTModeController.BLEEnabled()){if($.cookie('ble_language_snippet')){language=$.cookie('ble_language_snippet');}else{language='iOS';}}
if(item.model&&item.model.type&&item.model.type=='choreo'){if(IoTModeController.enabled()){if(IoTModeController.BLEEnabled()){$('.iot-mode-controls #iot-get-started').attr('href','/arduino/others').attr('target','').removeClass().addClass('iot-sdk-download arduino').find('.sdk-description').html('Get started with <strong>Arduino</strong>');$('.iot-mode-controls #ble-get-started').show();}else{$('.iot-mode-controls #ble-get-started').hide();if(brand=='Qualcomm'){$('.iot-mode-controls #iot-get-started').attr('href','/sdk/qualcomm').attr('target','').removeClass().addClass('iot-sdk-download qualcomm').find('.sdk-description').html('Download our <strong>Qualcomm<br/>QCA400x library</strong>');}else if(brand=='Samsung'){$('.iot-mode-controls #iot-get-started').attr('href','/hardware/samsung').attr('target','').removeClass().addClass('iot-sdk-download samsung').find('.sdk-description').html('Get started with <div id="samsung-get-started"></div>');}else if(brand=='TI'){$('.iot-mode-controls #iot-get-started').attr('href','/hardware/ti').attr('target','').removeClass().addClass('iot-sdk-download ti').find('.sdk-description').html('Get started with <strong>TI</strong>');}else if(device=='ArduinoYun'){$('.iot-mode-controls #iot-get-started').attr('href','/arduino/yun').attr('target','').removeClass().addClass('iot-sdk-download arduino').find('.sdk-description').html('Get started with <strong>Arduino</strong>');}else if(brand=='Arduino'){$('.iot-mode-controls #iot-get-started').attr('href','/arduino').attr('target','').removeClass().addClass('iot-sdk-download arduino').find('.sdk-description').html('Get started with <strong>Arduino</strong>');}else{$('.select-container .sdk-download').attr('href','/hardware').attr('target','').removeClass().addClass('sdk-download hardware').find('.sdk-description').html('Learn more about<br>Temboo & <strong>Hardware</strong>');}}
$('.iot-mode-controls #iot-get-started').attr('target','_blank');SnippetController.setLanguage(staticLanguage);SnippetView.update(staticLanguage,item.model.snippets);if(language!='IoT Default Sketch'){SnippetController.setLanguage(language);ChoreoController.runModeIsActive()&&SnippetController.loadUserSnippet();}}else{var previousLanguage=$.cookie('library_default_language');if(previousLanguage){SnippetController.setPlatformSelector(previousLanguage);}}}},updateTriggers:function(){var $trigger=$('.details-view .item-view .trigger'),$inputTrigger=$('.details-view .item-view .trigger.input-trigger'),$outputTrigger=$('.details-view .item-view .trigger.output-trigger'),$pin=$('.trigger .pin'),$inputPin=$('.trigger.input-trigger .pin'),$inputOp=$('.trigger.input-trigger select.operator.input'),$inputAnalogValue=$('.trigger.input-trigger .analog input.value'),$inputDigitalValue=$('.trigger.input-trigger .switch.digital-value .slider'),$inputSignal=$('.trigger.input-trigger .switch.signal .slider'),$inputFrequency=$('.trigger.input-trigger select.frequency.input'),$outputPin=$('.trigger.output-trigger .pin'),$outputAnalogValue=$('.trigger.output-trigger .analog input.value'),$outputDigitalValue=$('.trigger.output-trigger .switch.digital-value .slider'),$outputSignal=$('.trigger.output-trigger .switch.signal .slider'),$outputName=$('.trigger.output-trigger select.output-name'),successOnly=$('span.success').length>0,outputData=JSON.parse($('span.outputs-data').text());if(IoTModeController.enabled()&&!IoTModeController.BLEEnabled()&&IoTModeController.getDevice()!='Qualcomm'){$inputPin.off('click.input').on('click.input',function(){setTimeout(function(){$('.selected-input').click();},1);});$outputPin.off('click.output').on('click.output',function(){setTimeout(function(){$('html, body').animate({scrollTop:0},500);$('.selected-output').click();},1);});$trigger.show();if(TriggerController.triggers){if(!TriggerController.triggers.input&&$inputTrigger.is(':visible')){if($inputSignal.hasClass('analog')){TriggerController.setInputTrigger($inputPin.text(),$inputOp.selectBox('value'),$inputAnalogValue.val());}else{TriggerController.setInputTrigger($inputPin.text(),'eq',$inputDigitalValue.hasClass('high')?'HIGH':'LOW');}}
if(!TriggerController.triggers.output&&!TriggerController.triggers.success&&!TriggerController.triggers.error&&!$outputTrigger.is(':visible')){$outputTrigger.trigger('showOutputTrigger');TriggerController.setOutputAction($outputPin.text(),$outputSignal.hasClass('analog')?$outputAnalogValue.val():($outputDigitalValue.hasClass('high')?'HIGH':'LOW'));}}}else{$trigger.hide();if(TriggerController.triggers){if(TriggerController.triggers.input){TriggerController.removeInputTrigger($inputPin.text());}
if(TriggerController.triggers.output||TriggerController.triggers.success||TriggerController.triggers.error){TriggerController.removeOutput($outputPin.text());}}}
$pin.off('mouseover').on('mouseover',function(){$(this).addClass('hover');PinboardView.getPinView(PinController.getPinByLabel($(this).text())).addClass('hover');});$pin.off('mouseout').on('mouseout',function(){$(this).removeClass('hover');PinboardView.getPinView(PinController.getPinByLabel($(this).text())).removeClass('hover');});$inputOp.selectBox().off('change').on('change',function(){TriggerController.setTriggerValue($(this).val(),'input','op');SnippetController.loadUserSnippet();});$inputAnalogValue.off('cut keyup paste').on('cut keyup paste',function(){TriggerController.setTriggerValue($(this).val(),'input','rhs');});$inputFrequency.selectBox().off('change').on('change',function(){SnippetController.loadUserSnippet();});$outputTrigger.bind('showOutputTrigger',function(event){var name=successOnly?'Success':$outputName.selectBox('value'),type=outputData[name]['type'],op=null,value=null;if(type==''){type='untyped';}
switch(type){case'boolean':op='eq';value=$('.trigger.output-trigger .switch.truth .slider').hasClass('true')?'true':'false';break;case'json':case'xml':case'untyped':op='contains';}
if(!op){op=$('.trigger.output-trigger select.operator.output-op').selectBox('value');}
if(!value){value=$('.trigger.output-trigger .output-operator input.value').val();}
if(name=='Success'){TriggerController.setSuccess($('.trigger.output-trigger .switch.truth .slider').hasClass('true'));}else{TriggerController.setOutputTrigger(name,type,op,value);}});$outputName.selectBox().off('change').on('change',function(){var outputOperator;var name=$(this).val(),type=outputData[name]['type'],op=null,value=null;var conditions=GatewayController.getSelectedProperty('conditions');if(conditions){if(conditions['triggers']['output']){op=conditions['triggers']['output']['op'];value=conditions['triggers']['output']['value'];}else if(conditions['triggers']['success']){value='true';}else if(conditions['triggers']['error']){value='false';}}
if(type==''){type='untyped';}
switch(type){case'boolean':op='eq';outputOperator='<span>is</span>\
								<a class="switch truth">\
									<div class="slider true">\
										<span class="active left">True</span>\
										<span class="right">False</span>\
									</div>\
								</a>';break;case'integer':case'decimal':outputOperator='<select class="operator output-op">\
					                <option value="eq">=</option>\
					                <option value="ne">&ne;</option>\
					                <option value="lt">&lt;</option>\
					                <option value="gt">&gt;</option>\
					                <option value="lte">&le;</option>\
					                <option value="gte">&ge;</option>\
					            </select>\
					            <input class="value short" type="text" value="'+(value?value:'0')+'" />';break;case'date':outputOperator='<select class="operator output-op">\
					                <option value="eq">=</option>\
					                <option value="ne">&ne;</option>\
					            </select>\
					            <input class="value short" type="text" value="'+(value?value:'0')+'" />';break;case'string':case'multiline':outputOperator='<select class="operator output-op contains">\
					                <option value="eq">=</option>\
					                <option value="ne">&ne;</option>\
					                <option>contains</option>\
					            </select>\
					            <input class="value long" type="text" value="'+(value?value:'')+'" />';break;default:outputOperator='<span>contains</span>\
								<input class="value long" type="text" value="'+(value?value:'')+'" />';op='contains';}
$('.output-operator').html(outputOperator);if(type=='boolean'){if(value=='false'){$('.button.switch.truth').click();}else if(!value){value='true';}}
if(op&&$('select.operator.output-op').length>0){$('select.operator.output-op').val(op);}
$('.trigger.output-trigger select.operator.output-op').selectBox().off('change').on('change',function(){TriggerController.setTriggerValue($(this).val(),'output','op');SnippetController.loadUserSnippet();});if($('.condition',$outputTrigger).is(':visible')){$outputTrigger.trigger('showOutputTrigger');}
SnippetController.loadUserSnippet();});$outputAnalogValue.off('cut keyup paste').on('cut keyup paste',function(){TriggerController.setActionValue($(this).val());});$outputTrigger.off('cut keyup paste','.output-operator input.value').on('cut keyup paste','.output-operator input.value',function(){TriggerController.setTriggerValue($(this).val(),'output','value');});$trigger.off('click','.button.signal.analog-only').on('click','.button.signal.analog-only',function(){var clicked=$(this);clicked.siblings('.analog').css('display','inline-block');clicked.siblings('.digital').hide();if(clicked.parents(1).hasClass('input-trigger')){TriggerController.setInputTrigger($inputPin.text(),$inputOp.selectBox('value'),$inputAnalogValue.val());$inputPin.trigger('click.input');}else if(clicked.parents(1).hasClass('output-trigger')){TriggerController.setOutputAction($outputPin.text(),$outputAnalogValue.val());$outputPin.trigger('click.output');}
SnippetController.loadUserSnippet();});$trigger.off('click','.button.signal.digital-only').on('click','.button.signal.digital-only',function(){var clicked=$(this);clicked.siblings('.digital').css('display','inline-block');clicked.siblings('.analog').hide();if(clicked.parents(1).hasClass('input-trigger')){TriggerController.setInputTrigger($inputPin.text(),'eq',$inputDigitalValue.hasClass('high')?'HIGH':'LOW');$inputPin.trigger('click.input');}else if(clicked.parents(1).hasClass('output-trigger')){TriggerController.setOutputAction($outputPin.text(),$outputDigitalValue.hasClass('high')?'HIGH':'LOW');$outputPin.trigger('click.output');}
SnippetController.loadUserSnippet();});$trigger.off('click','.switch').on('click','.switch',function(e){var clicked=$(this);if(!clicked.hasClass('sliding')){clicked.addClass('sliding');var active=$('span.active',clicked);var width=active.outerWidth();var delta='-='+width;if(active.hasClass('right')){delta='+='+width;}
var $slider=$('.slider',clicked);$slider.animate({left:delta},200,'swing',function(){if(clicked.hasClass('digital-value')){TriggerView.toggleDigitalValueSwitch(clicked);}else if(clicked.hasClass('truth')){TriggerView.toggleTruthSwitch(clicked);}
SnippetController.loadUserSnippet();clicked.removeClass('sliding');});}});},setCompilable:function(){if(IoTModeController.enabled()&&CLOUD_CONTROLS_ACCESS&&!IoTModeController.gatewayEnabled()&&DeviceController.deviceHasCloudControls()){$('.details-view .item-view .meta-class.snippet.main').addClass('compilable');}else{$('.details-view .item-view .meta-class.snippet.main').removeClass('compilable');if($('.details-view .item-view .meta-class.snippet.main').hasClass('compiled')){$('.details-view .item-view .meta-class.snippet.main').removeClass('compiled');$('.details-view .item-view .meta-class.snippet.main .download-dropdown li.selected').removeClass('selected');$('.details-view .item-view .meta-class.snippet.main .download-dropdown li[rel="editable"]').addClass('selected');}}}};}();var TriggerController=function(){var pins,pinModels,triggers,actions,self,triggersEnabled={input:false,output:false},board;var reset=function(){pins={};pinModels={};triggers={};actions=[];TriggerView.update(PinController.getDefaultPin('input'));TriggerView.update(PinController.getDefaultPin('output'));}
var load=function(json,boardChanged){if(json){pins=json.pins;triggers=json.triggers;actions=json.actions;for(var name in pins){var type=pins[name]['input']?'input':'output';var pinModel;if(!boardChanged){pinModel=PinController.getPinByName(name);pinModels[name]=pinModel;}else{pinModel=PinController.getDefaultPin(type);var newName=pinModel.getName();pins[newName]=pins[name];pinModels[newName]=pinModel;delete pins[name];delete pinModels[name];triggers.input.lhs.readPin=newName;$(TriggerController).trigger('triggerschanged');}}
triggersEnabled['input']=triggers['input']?true:false;triggersEnabled['output']=(triggers['output']||triggers['success']||triggers['error'])?true:false;}else{triggersEnabled={input:false,output:false};}}
return{init:function(){self=TriggerController;$(ItemController).unbind('itemloaded.triggercontrollerinit').bind('itemloaded.triggercontrollerinit',function(e,item){if(item.isChoreo()){for(var io in triggersEnabled){triggersEnabled[io]?TriggerView.show(io):TriggerView.hide(io);}
var updated={},pin,pinType;for(var name in pinModels){pin=pinModels[name];pinType=pin.getType();TriggerView.update(pin,triggers[pinType]);updated[pinType]=true;}
for(var type in triggersEnabled){updated[type]||TriggerView.update(PinController.getDefaultPin(type));}}});$(PinController).unbind('boardloaded').bind('boardloaded',function(e,data){var existingPins=pinModels?true:false
reset();if(IoTModeController.gatewayEnabled()){load(GatewayController.getSelectedProperty('conditions'),data.boardChanged);}else{if(existingPins){var $inputPin=$('.trigger.input-trigger .pin');var $outputPin=$('.trigger.output-trigger .pin');TriggerView.hide('input');TriggerController.removeInputTrigger($inputPin.text());TriggerView.hide('output');TriggerController.removeOutput($outputPin.text());SnippetController.loadUserSnippet();}}});$(PinboardController).unbind('pinselected').bind('pinselected',function(e,pinModel){'input'==pinModel.getType()?self.updateInputPin(pinModel):self.updateOutputPin(pinModel);TriggerView.update(pinModel,null,true);});},getTriggerPinLabel:function(type){var pinLabel;for(var pinName in pins){if(pins[pinName][type]===true){pinLabel=pinModels[pinName].getLabel();break;}}
return pinLabel;},setInputTrigger:function(pinLabel,op,rhs){var pinModel=PinController.getPinByLabel(pinLabel);var pinModelSignal=pinModel.getSignal();var pinName=pinModel.getName();pins[pinName]={"input":true};pinModels[pinName]=pinModel;triggers.input={};triggers.input.lhs={"readPin":pinName};if(rhs=='HIGH'||rhs=='LOW'||pinModelSignal=='onewire'){pins[pinName].digital=true;}else{pins[pinName].analog=true;}
var deviceType=IoTModeController.getDeviceType();if(deviceType=='Arduino Yun'||deviceType=='Arduino MKR1000'||deviceType=='Arduino Uno'||deviceType=='Arduino Mega'||deviceType=='Arduino Zero'||deviceType=='Arduino 101'){pins[pinName].type=pinModel.getLibrary();}
triggers.input.op=op;triggers.input.rhs=rhs;if(pinModelSignal!='onewire'&&!pins[pinName][pinModelSignal]){pinModel.toggleSignal();}
pinModel.setValue(triggers['input']['rhs']);$(TriggerController).trigger('triggerschanged');},setOutputTrigger:function(name,type,op,value){delete triggers['success'];delete triggers['error'];triggers.output={};triggers.output.name=name;triggers.output.type=type;triggers.output.op=op;triggers.output.value=value;$(TriggerController).trigger('triggerschanged');},setOutputAction:function(pinLabel,value){var pinModel=PinController.getPinByLabel(pinLabel);var pinModelSignal=pinModel.getSignal();var pinName=pinModel.getName();pins[pinName]={"output":true};pinModels[pinName]=pinModel;if(actions=[]){actions.push({"writePin":{"pin":pinName}});}else{actions[0].writePin.pin=pinName;}
if(value=='HIGH'||value=='LOW'){pins[pinName].digital=true;}else{pins[pinName].analog=true;}
var deviceType=IoTModeController.getDeviceType();if(deviceType=='Arduino Yun'||deviceType=='Arduino MKR1000'||deviceType=='Arduino Uno'||deviceType=='Arduino Mega'||deviceType=='Arduino Zero'||deviceType=='Arduino 101'){pins[pinName].type=pinModel.getLibrary();}
actions[0].writePin.value=value;if(!pins[pinName][pinModelSignal]){pinModel.toggleSignal();}
pinModel.setValue(actions[0].writePin.value);$(TriggerController).trigger('triggerschanged');},removeInputTrigger:function(pinLabel){var pinName=PinController.getPinByLabel(pinLabel).getName();delete pins[pinName];delete pinModels[pinName];delete triggers['input'];$(TriggerController).trigger('triggerschanged');},removeOutput:function(pinLabel){var pinName=PinController.getPinByLabel(pinLabel).getName();delete pins[pinName];delete pinModels[pinName];delete triggers['output'];delete triggers['success'];delete triggers['error'];actions=[];$(TriggerController).trigger('triggerschanged');},setTriggerValue:function(value,trigger,property){triggers[trigger][property]=value;if(trigger=='input'&&property=='rhs'){PinController.getPinByLabel(self.getTriggerPinLabel('input')).setValue(value);}
$(TriggerController).trigger('triggerschanged');},setSuccess:function(success){delete triggers['output'];if(success){delete triggers['error'];triggers.success=true;}else{delete triggers['success'];triggers.error=true;}
$(TriggerController).trigger('triggerschanged');},setActionValue:function(value){actions[0].writePin.value=value;PinController.getPinByLabel(self.getTriggerPinLabel('output')).setValue(value);$(TriggerController).trigger('triggerschanged');},updateInputPin:function(pinModel){var pinLabel=pinModel.getLabel();var pinName=pinModel.getName();var oldPinLabel=self.getTriggerPinLabel('input');if(oldPinLabel&&oldPinLabel!=pinLabel){var oldPinName=PinController.getPinByLabel(oldPinLabel).getName();pins[pinName]=pins[oldPinName];pinModels[pinName]=PinController.getPinByLabel(pinLabel);delete pins[oldPinName];delete pinModels[oldPinName];triggers.input.lhs.readPin=pinName;}
$(TriggerController).trigger('triggerschanged');},updateOutputPin:function(pinModel){var pinLabel=pinModel.getLabel();var pinName=pinModel.getName();var oldPinLabel=self.getTriggerPinLabel('output');if(oldPinLabel&&oldPinLabel!=pinLabel){var oldPinName=PinController.getPinByLabel(oldPinLabel).getName();pins[pinName]=pins[oldPinName];pinModels[pinName]=PinController.getPinByLabel(pinLabel);delete pins[oldPinName];delete pinModels[oldPinName];actions[0].writePin.pin=pinName;}
$(TriggerController).trigger('triggerschanged');},toJSON:function(forExtend){var json={pins:pins,triggers:triggers,actions:actions};delete json.triggers.backOffInterval;delete json.triggers.backOffIntervalMillis;delete json.triggers.backOffIntervalSecs;if(json.triggers&&json.triggers.input){var backOffInterval=$('.trigger.input-trigger select.frequency.input').selectBox('value');if(backOffInterval=='continuously'){}else{json.triggers.backOffInterval=parseInt(backOffInterval);json.triggers.backOffIntervalMillis=parseInt(backOffInterval);json.triggers.backOffIntervalSecs=parseInt(backOffInterval)/1000;}}
if(json.triggers&&json.triggers.output){json.triggers.output.nameBytes=json.triggers.output.name?Math.ceil(json.triggers.output.name.length/64.0)*64:64;json.triggers.output.valueBytes=json.triggers.output.value?Math.ceil(json.triggers.output.value.length/64.0)*64:64;if((IoTModeController.getDevice()=='Samsung.Artik.Ten'||GatewayController.getSelectedProperty('device')=='Samsung.Artik.Ten')&&json.triggers.output.type){if(json.triggers.output.type=='decimal'){json.triggers.output.type='float';}}}
if(CLOUD_CONTROLS_ACCESS&&DeviceController.deviceHasTransducers()&&!IoTModeController.gatewayEnabled()){if(json.triggers&&json.triggers.input&&json.triggers.input.rhs!=''){var inputTriggerPinNumber=$('.sensor-selector').val();var model=null,analogUnit=null;scaleHigh=null,scaleLow=null,signal=null,medium=null,calibration=null;if(inputTriggerPinNumber){var inputPin=PinController.getPinByLabel(inputTriggerPinNumber);if(inputPin){model=inputPin.getModel();medium=inputPin.getMedium();analogUnit=inputPin.getAnalogUnit();scaleHigh=inputPin.getScaleHigh()?parseFloat(inputPin.getScaleHigh()):null;scaleLow=inputPin.getScaleLow()?parseFloat(inputPin.getScaleLow()):null;signal=inputPin.getSignal();calibration=inputPin.getCalibration()?parseFloat(inputPin.getCalibration()):null;if(signal=='analog'||signal=='onewire'){json.triggers.input.rhs=parseFloat(inputPin.getValue());var inputValue=parseFloat(json.triggers.input.rhs);var deviceType=IoTModeController.getDeviceType();if(calibration){inputValue=inputValue-calibration;}
if(scaleHigh!=null&&scaleLow!=null){var rawValues=TransducerController.getRawValues(deviceType,model,medium);var rawHigh=parseFloat(rawValues.raw_high);var rawLow=parseFloat(rawValues.raw_low);var percent=(inputValue-scaleLow)/(scaleHigh-scaleLow);inputValue=Math.round((percent*(rawHigh-rawLow))+rawLow);}else{var voltageAndResolution=TransducerController.getDeviceVoltageAndResolution(deviceType);var voltage=parseFloat(voltageAndResolution.voltage);var resolution=parseInt(voltageAndResolution.resolution);if(medium==null&&model==null&&analogUnit=='V'){var percent=inputValue/voltage;inputValue=Math.round(percent*1023);}else if(model){switch(model){case'EKMC160112':case'LRNH31S41':break;case'LMT84LP':if(analogUnit=='F'){inputValue=(inputValue-32)*5/9;}
var milliVolts=-1*(((Math.pow(((inputValue-30)*(-.00352))-5.506,2)-30.316036)/.00704)-870.6);inputValue=((milliVolts/1000)/voltage)*(resolution-1);break;case'TMP36GT9Z':if(analogUnit=='F'){inputValue=(inputValue-32)*5/9;}
var volts=(inputValue+50)/100;inputValue=(volts/voltage)*(resolution-1);break;case'GP2Y0A21YK0F':if(analogUnit=='in'){inputValue=inputValue*2.54;}
var volts=Math.pow((inputValue/27.86),(1/-1.15));inputValue=(volts/voltage)*(resolution-1);break;case'M3051-000005-100PG':var volts=((inputValue+25)/6250)*250;inputValue=(volts/voltage)*(resolution-1);break;case'PDV-P8103':var volts=5/(1+((Math.sqrt(inputValue)*10000)/80000));inputValue=(volts/voltage)*(resolution-1)
break;case'MQ-5':volts=5/(1+(79700*Math.pow(inputValue,-.135)/35300));inputValue=(volts/voltage)*(resolution-1);break;case'DS18B20':if(analogUnit=='F'){inputValue=(inputValue-32)*5/9;}
inputValue=inputValue*16;break;case'Other':var percent=inputValue/5;inputValue=Math.round(percent*1023);default:}
inputValue=Math.round(inputValue);}
if(model=='LMT84LP'||model=='GP2Y0A21YK0F'||model=='PDV-P8103'||model=='MQ-5'){json.triggers.input.op=$('.trigger.input-trigger').find('.operator').selectBox('value');var op=json.triggers.input.op;if(op=='lt'){op='gt';}else if(op=='gt'){op='lt';}else if(op=='lte'){op='gte';}else if(op=='gte'){op='lte';}
json.triggers.input.op=op;}}
if(model=='DS18B20'&&(inputValue<-880||inputValue>2000)){$('.trigger.input-trigger .condition p.error').text('Input value is out of bounds.').show();$('.download-compiled-container button.download-compiled').addClass('disabled');}else if(model!='DS18B20'&&(inputValue<0||inputValue>(resolution-1))){$('.trigger.input-trigger .condition p.error').text('Input value is out of bounds.').show();$('.download-compiled-container button.download-compiled').addClass('disabled');}else{$('.trigger.input-trigger .condition p.error').text('').hide();$('.download-compiled-container button.download-compiled').removeClass('disabled');}
json.triggers.input.rhs=inputValue;}}}}}
if($.isEmptyObject(json.pins)&&$.isEmptyObject(json.triggers)&&$.isEmptyObject(json.actions)){return null;}else{return forExtend?$(json).deepCopy():JSON.stringify(json);}}};}();var TriggerView=function(){var getPinView=function(pinModel){return getView(pinModel.getType()).find('.pin');};var getView=function(type){return $('.trigger.'+type+'-trigger');};return{isOpen:function(type){return getView(type).find('.condition').is(':visible');},hide:function(type){$view=getView(type);$view.find('.condition').hide();},show:function(type){$view=getView(type);$view.find('.condition').show();if(IoTModeController.gatewayEnabled()){if((type=='input'&&!TriggerView.isOpen('output'))||(type=='output'&&!TriggerView.isOpen('input')))
Temboo.trackEvent("M2M","Conditions enabled");}},update:function(pinModel,trigger,skipSelectBox){var $trigger=getView(pinModel.getType()),$pinView=getPinView(pinModel),$outputName=$('.trigger.output-trigger select.output-name');$pinView.text(pinModel.getLabel()).data('uid',pinModel.getId());if(pinModel.getType()=='input'&&trigger){if(pinModel.isDigital()){var $switch=$trigger.find('.switch.digital-value .slider');if(($switch.hasClass('high')&&trigger.rhs=='LOW')||($switch.hasClass('low')&&trigger.rhs=='HIGH')){$switch.click();}}
else{$trigger.find('.value').val(trigger.rhs);$trigger.find('.operator').selectBox('value',trigger.op);}
$trigger.find('.frequency').selectBox();}
if(pinModel.getType()=='output'){if(pinModel.isDigital()){var $switch=$trigger.find('.switch.digital-value .slider');if(($switch.hasClass('high')&&pinModel.getValue()=='LOW')||($switch.hasClass('low')&&pinModel.getValue()=='HIGH')){$switch.click();}}else{if(pinModel.getValue()){$trigger.find('.analog input.analog-value').val(pinModel.getValue());}}}
if(!skipSelectBox&&pinModel.getType()=='output'){var conditions=GatewayController.getSelectedProperty('conditions');if(conditions){if(conditions['triggers']['output']){$outputName.val(conditions['triggers']['output']['name']);}else if(conditions['triggers']['success']||conditions['triggers']['error']){$outputName.val('Success');}}
$outputName.selectBox().trigger('change');}},setTriggerSignal:function(type,signal){var $inputPin=$('.trigger.input-trigger .pin'),$inputOp=$('.trigger.input-trigger select.operator.input'),$inputAnalogValue=$('.trigger.input-trigger .analog input.value'),$inputDigitalValue=$('.trigger.input-trigger .switch.digital-value .slider'),$outputPin=$('.trigger.output-trigger .pin'),$outputAnalogValue=$('.trigger.output-trigger .analog input.value'),$outputDigitalValue=$('.trigger.output-trigger .switch.digital-value .slider');var $trigger;if(type=='input'){$trigger=$('.trigger.input-trigger');if(signal=='digital'){TriggerController.setInputTrigger($inputPin.text(),'eq',$inputDigitalValue.hasClass('high')?'HIGH':'LOW');}else{TriggerController.setInputTrigger($inputPin.text(),$inputOp.selectBox('value'),$inputAnalogValue.val());}}else{$trigger=$('.trigger.output-trigger');if(signal=='digital'){TriggerController.setOutputAction($outputPin.text(),($outputDigitalValue.hasClass('high')?'HIGH':'LOW'));}else{TriggerController.setOutputAction($outputPin.text(),$outputAnalogValue.val());}}
if(signal=='digital'){$('.digital',$trigger).css('display','inline-block');$('.analog',$trigger).hide();}else{$('.digital',$trigger).hide();$('.analog',$trigger).css('display','inline-block');}},toggleDigitalValueSwitch:function(digitalValueSwitch){var $slider=digitalValueSwitch.find('.slider');$('span',digitalValueSwitch).toggleClass('active');$slider.toggleClass('high').toggleClass('low');var value=$slider.hasClass('high')?'HIGH':'LOW';if(digitalValueSwitch.parents(2).hasClass('input-trigger')){TriggerController.setTriggerValue(value,'input','rhs');}else{TriggerController.setActionValue(value);}},toggleTruthSwitch:function(truthSwitch){var $outputName=$('.trigger.output-trigger select.output-name'),successOnly=$('span.success').length>0;var $slider=truthSwitch.find('.slider');$('span',truthSwitch).toggleClass('active');$slider.toggleClass('true').toggleClass('false');var isTrue=$slider.hasClass('true');if(successOnly||$outputName.selectBox('value')=='Success'){TriggerController.setSuccess(isTrue);}else{TriggerController.setTriggerValue('eq','output','op');TriggerController.setTriggerValue(isTrue?'true':'false','output','value');}}};}();var SensorInputController=function(){var clickOutsideCallout=function(event){var $target=$(event.target).closest('.input-container');if(!$target.first().is(event.data.container)){$('.callout-container',event.data.container).remove();$('.run-mode-component',event.data.container).removeClass('sensor-input');$(document).off('click',clickOutsideCallout);}};return{addSensorButton:function(){$('.input-container .run-mode-component').off('focusin').on('focusin',function(){if(CLOUD_CONTROLS_ACCESS&&DeviceController.deviceHasTransducers()&&!IoTModeController.gatewayEnabled()){$('.input-container .callout-container').remove();var $inputContainer=$(this).parent();var sensors=PinController.getSensors();if(sensors.length>0){$inputContainer.append(SensorInputView.renderCallout());$('.callout.sensor-input',$inputContainer).append('<ul id="sensor-input-list"></ul>');var $sensorInputList=$('ul#sensor-input-list');var options=[];options.push('<li class="option-label-only">Use sensor value</li>');for(var i in sensors){options.push('<li class="elided" rel="'+sensors[i]+'">'+sensors[i]+'</li>');}
var $input=$('.run-mode-component',$inputContainer);$input.addClass('sensor-input');$sensorInputList.html(options.join(''));$sensorInputList.off('click','li').on('click','li',function(){if($(this).hasClass('option-label-only')){return;}
var sensorValue='';if($input.val().length>0){sensorValue+=' ';}
sensorValue+='<<{'+$(this).attr('rel')+'}>>';$input.val($input.val()+sensorValue);SnippetController.loadUserSnippet();});$(document).off('click',clickOutsideCallout).on('click',{container:$inputContainer},clickOutsideCallout);}}});}}}();var SensorInputView=function(){return{renderCallout:function(){var callout='<div class="callout-container">\
							<div class="sensor"></div>\
							<div class="hover-container">\
				        		<div class="callout sensor-input">\
				        			</select>\
				        			<div class="head-callout up">\
				                        <div class="arrow-callout line-up-left"></div>\
				                        <div class="arrow-callout line-up-right"></div>\
				                        <div class="arrow-bg"></div>\
			                        </div>\
				        		</div>\
		        			</div>\
	                    </div>';return callout;}}}();var GatewayModel=function(){var choreos={};var buildChoreo=function(tab){choreos[tab]={};return choreos[tab];}
return{addChoreo:function(tab){buildChoreo(tab);},getChoreo:function(tab){return choreos[tab];},removeChoreo:function(tab){delete choreos[tab];},setChoreos:function(newChoreos){choreos=newChoreos;},getChoreos:function(){return choreos;},removeChoreos:function(){choreos={};},setProperty:function(tab,name,value){if(choreos[tab]){choreos[tab][name]=value;}},getProperty:function(tab,name){if(choreos[tab]){return choreos[tab][name];}
return null;},setInputValue:function(tab,key,value){if(choreos[tab]){if(!choreos[tab]['inputs']){choreos[tab]['inputs']={};}
choreos[tab]['inputs'][key]=value;}},removeInputValue:function(tab,key){if(choreos[tab]&&choreos[tab]['inputs']&&choreos[tab]['inputs'][key]){delete choreos[tab]['inputs'][key];if($.isEmptyObject(choreos[tab]['inputs'])){delete choreos[tab]['inputs'];}}},removeProperty:function(tab,name){if(choreos[tab]&&choreos[tab][name]){delete choreos[tab][name];}},removeOutputTrigger:function(tab){if(choreos[tab]&&choreos[tab]['conditions']){if(choreos[tab]['conditions']['triggers']['output']){delete choreos[tab]['conditions']['triggers']['output'];}else if(choreos[tab]['conditions']['triggers']['success']){delete choreos[tab]['conditions']['triggers']['success'];}else if(choreos[tab]['conditions']['triggers']['error']){delete choreos[tab]['conditions']['triggers']['error'];}}}};}();var GatewayController=function(){var gatewayChoreo;var selectedTab;var gatewayDevices=['ArduinoYun','Samsung.Artik.Ten'];var edgeNetworks=['ti_cc3200','ti_cc3200_rtos','arduinowifir3','arduinoethernetr3','adafruitwificc3000'];var edgeDevices=['ti_cc3200','Samsung.Artik.Ten'];var selectedEdgeDevice;var selectedEdgeNetwork;return{init:function(){GatewayController.setSelectedEdgeDevice($.cookie('library_iot_gateway_edge_device'));GatewayController.setSelectedEdgeNetwork($.cookie('library_iot_gateway_edge_network'));GatewayModel.addChoreo('Gateway');selectedTab='Gateway';$(ItemController).unbind('itemloaded.gatewaycontrollerinit').bind('itemloaded.gatewaycontrollerinit',function(e,item){if(item&&item.isChoreo()){if(!GatewayModel.getChoreo('Gateway')){GatewayModel.addChoreo('Gateway');selectedTab='Gateway';}
if(!GatewayModel.getProperty('Gateway','uri')){var uri='/library/'+item.uri;GatewayModel.setProperty('Gateway','uri',uri);}
GatewayView.updateTabs();GatewayView.updateChoreoDetails(item);var tab=GatewayController.getSelectedTab();var choreo=GatewayModel.getChoreo(tab);var device=choreo.device;var network=choreo.network;var inputs=choreo.inputs;var credential=choreo.credential;if(credential){ProfilesView.updateProfileSelector(item,credential);ProfilesView.updateInputs(item,credential);if(credential&&inputs){$('.profile-container button.save-profile').show();}}
if(inputs){GatewayView.updateInputs(inputs);if(!credential){$('.profile-container button.save-profile').show();}}
if(tab!='Gateway'){GatewayView.updateDeviceName(device,network);}
$(IoTModeController).trigger('gatewaytabloaded');}});$(IoTModeController).bind('devicechanged gatewaysettingschanged',function(e,which){var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.isChoreo()){GatewayView.updateChoreoDetails(currentItem);}});$(TriggerController).unbind('triggerschanged').bind('triggerschanged',function(){if(IoTModeController.gatewayEnabled()&&!$.isEmptyObject(GatewayModel.getChoreos())&&TriggerController.toJSON(true)){GatewayController.setSelectedProperty('conditions',TriggerController.toJSON(true));}else{GatewayController.removeSelectedProperty('conditions');}});},getSelectedTab:function(){return selectedTab;},setSelectedTab:function(tab){selectedTab=tab;},getPrevTab:function(tab){var tabArray=Object.keys(GatewayModel.getChoreos());var tabIndex=$.inArray(tab,tabArray);if(tabIndex>0){return tabArray[tabIndex-1];}
return null;},getGatewayDevices:function(){return gatewayDevices;},getEdgeNetworks:function(){if(IoTModeController.getProtocol()!='http'){return['ti_cc3200','ti_cc3200_rtos'];}
return edgeNetworks;},setSelectedProperty:function(name,value){GatewayModel.setProperty(selectedTab,name,value);},getSelectedProperty:function(name){return GatewayModel.getProperty(selectedTab,name);},removeSelectedProperty:function(name){GatewayModel.removeProperty(selectedTab,name);},removeOutputTrigger:function(){GatewayModel.removeOutputTrigger(selectedTab);},getEdgeShield:function(){var currentItem=ItemController.getCurrentItem();var network=GatewayController.getSelectedProperty('network');var shield;if(currentItem&&currentItem.isChoreo()){shield=network?currentItem.deviceNetworkCredentials.data[network].inputs.Shield:null;}
return shield;},setSelectedInput:function(key,value){val=$.trim(value);if(val){GatewayModel.setInputValue(selectedTab,key,value);}else{GatewayModel.removeInputValue(selectedTab,key);}},isEdgeNetwork:function(network){var networks=GatewayController.getEdgeNetworks();var item=ItemController.getCurrentItem();if(network&&item.deviceNetworkCredentials.data[network]&&$.inArray(item.deviceNetworkCredentials.data[network].inputs.Shield,networks)>-1){return true;}
return false;},loadTab:function(tab){var $choreoContainer=$('#choreo-container'),$gatewayStep=$('#iot-gateway-container #gateway-step');selectedTab=tab;GatewayView.updateTabs();var uri=GatewayController.getSelectedProperty('uri');var device=GatewayController.getSelectedProperty('device');var network=GatewayController.getSelectedProperty('network');GatewayController.setSelectedEdgeDevice(device);if(network){if(GatewayController.isEdgeNetwork(network)){GatewayController.setSelectedEdgeNetwork(network);}else{GatewayController.setSelectedEdgeNetwork(null);GatewayModel.removeProperty(tab,'network');network=null;}}else{GatewayController.setSelectedEdgeNetwork(null);}
$('.library-view .tree').removeClass('gateway-select-choreo');GatewayView.fadeIn();if(tab=='Gateway'||(uri&&((network&&device)||device=='Samsung.Artik.Ten'))){$gatewayStep.hide();$choreoContainer.show();TreeController.setClicked([uri]);uri=uri.replace(baseUrl,'');GatewayView.updateTabs();if(ItemModel.isCached(uri)){ItemsView.loading(true,true);}
ItemController.loadItem(uri,null,null,true);}else{$gatewayStep.show();$choreoContainer.hide();GatewayView.updateTabs();if((network&&device)||(device=='Samsung.Artik.Ten')){GatewayView.updateDeviceName(device,network);$('.library-view .tree').addClass('gateway-select-choreo');GatewayView.setEdgeChoreo(tab);$(IoTModeController).trigger('gatewaytabloaded');}else{GatewayView.setEdgeDevice();}}},setSelectedEdgeDevice:function(device){if(selectedEdgeDevice&&selectedEdgeDevice===device){return false;}
selectedEdgeDevice=device;if($.inArray(selectedEdgeDevice,edgeDevices)==-1){selectedEdgeDevice=null;device=null;}
$.cookie('library_iot_gateway_edge_device',device,{expires:180,path:'/'});var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.isChoreo){GatewayView.updateEdgeNetworkSelector(currentItem);}},getSelectedEdgeDevice:function(){return selectedEdgeDevice;},setSelectedEdgeNetwork:function(network){if(selectedEdgeNetwork&&selectedEdgeNetwork===network){return false;}
selectedEdgeNetwork=network;$.cookie('library_iot_gateway_edge_network',network,{expires:180,path:'/'});},getSelectedEdgeNetwork:function(){return selectedEdgeNetwork;},removeTabs:function(){GatewayModel.removeChoreos();GatewayView.setEdgeNum(1);},sendGatewayAnalytics:function(){var item=ItemController.getCurrentItem();var protocol=IoTModeController.getProtocol();if(protocol=='mqtt'){protocolName='MQTT';}
else if(protocol=='coap'){protocolName='CoAP';}
else if(protocol=='http'){protocolName='HTTP';}
else{protocolName='Do not use M2M';}
var deviceName=IoTModeController.getDevice();if(deviceName=='Samsung.Artik.Ten'){deviceName='Samsung.Artik.10'};_gaq.push(['_trackEvent',"M2M","Selected gateway device",protocolName+(protocol?', '+deviceName:'')]);Temboo.trackEvent("M2M","Selected gateway Choreo",item.uri);if(IoTModeController.getProtocol()){if(TriggerController.toJSON()){Temboo.trackEvent("M2M","Conditions enabled");}}}};}();var GatewayView=function(){var edgeNum=1;var toFade;var MAX_EDGES=99;var editing=false;var shieldNameMap={'ti_cc3200':'TI CC3200 (WiFi)','ti_cc3200_rtos':'TI CC3200 (WiFi) + RTOS','arduinowifir3':'Arduino WiFi','arduinoethernetr3':'Arduino Ethernet','adafruitwificc3000':'Adafruit CC3000 WiFi'};return{updateChoreoDetails:function(item){var $gatewayContainer=$('#iot-gateway-container'),$choreoContainer=$('#choreo-container'),$gatewayStep=$('#gateway-step',$gatewayContainer),selectedTab=GatewayController.getSelectedTab(),$editButton=$('#iot-gateway-container button.gateway-edit-choreo');var device=GatewayController.getSelectedProperty('device');var network=GatewayController.getSelectedProperty('network');var uri=GatewayController.getSelectedProperty('uri');toFade=[$('.column.column-first'),$('.details-view .iot-mode-controls'),$('.details-view .item-view .iot-mode-container'),$('.details-view .item-view .iot-gateway-container .gateway-tab-container'),$('.details-view .item-view .iot-gateway-container .gateway-device')];GatewayView.fadeIn();if(!editing){if(device){GatewayController.setSelectedEdgeDevice(device);}
if(network){if(GatewayController.isEdgeNetwork(network)){GatewayController.setSelectedEdgeNetwork(network);}else{GatewayController.setSelectedEdgeNetwork(null);GatewayModel.removeProperty(selectedTab,'network');network=null;}}
if(IoTModeController.enabled()&&IoTModeController.gatewayEnabled()&&!$.isEmptyObject(GatewayModel.getChoreos())){$gatewayContainer.show();if(selectedTab&&selectedTab!='Gateway'){if((device==GatewayController.getSelectedEdgeDevice()&&network==GatewayController.getSelectedEdgeNetwork()||device=='Samsung.Artik.Ten')&&uri){GatewayView.updateDeviceName(device,network);$('#iot-gateway-container hr.gateway-divider').show();$gatewayStep.hide();$choreoContainer.show();$editButton.show();$(ItemsView).trigger('heightchanged');}else{$gatewayStep.show();$choreoContainer.hide();if((device&&network)||device=='Samsung.Artik.Ten'){GatewayView.setEdgeChoreo(selectedTab);}else{GatewayView.setEdgeDevice();}}}}else{$gatewayContainer.hide();$choreoContainer.show();}}
$(ItemsView).trigger('heightchanged');},updateTabs:function(){var $choreoContainer=$('#choreo-container'),$gatewayStep=$('#iot-gateway-container #gateway-step'),$editChoreoCallout=$('#iot-gateway-container .callout.edit-choreo');$('#gateway-tabs').empty();selectedTab=GatewayController.getSelectedTab();var choreos=$(GatewayModel.getChoreos()).deepCopy();var length=Object.keys(choreos).length;var $tabLink=$('<a href="'+choreos['Gateway'].uri+'" rel="Gateway" class="gateway-link">\
						<div class="gateway-tab gateway">\
							<span class="tab-name">Gateway</span>\
						</div></a>');$tabLink.appendTo($('#gateway-tabs'));delete choreos['Gateway'];var i=0;var addTab=function(tab,choreo){var $tabLink=$('<a rel="'+tab+'" class="gateway-link">\
								<div class="gateway-tab edge">\
								<span class="tab-name">'+tab+'</span>\
								<button class="icon close"></button></div></a>');if(choreo.uri){$tabLink.attr('href',choreo.uri);}
$tabLink.appendTo($('#gateway-tabs'));GatewayView.setTabWidth($tabLink.find('.gateway-tab'));delete choreos[tab];};$.each(choreos,function(tab,choreo){if(i==2){return false;}
addTab(tab,choreo);i++;});if(Object.keys(choreos).length==1){var tab=Object.keys(choreos)[0];addTab(tab,choreos[tab]);}
if(length<MAX_EDGES){$('<div class="gateway-tab add"></div>').appendTo($('#gateway-tabs'));if($('.gateway-tab.edge').length==0){$('.gateway-tab.add').text('Edge');$('.gateway-tab.add').addClass('add-edge');}}
if(Object.keys(choreos).length>0){GatewayView.updateEdgeTabSelector(choreos);}
if($('a.gateway-link[rel="'+selectedTab+'"]').length==1){$('a.gateway-link[rel="'+selectedTab+'"] .gateway-tab').addClass('selected');}
$('.gateway-tabs').off('mouseenter').off('mouseleave').on({mouseenter:function(){if($(this).attr('rel')!='Gateway'){$('div.gateway-tab',$(this)).find('button.close').css('visibility','visible');}},mouseleave:function(){$('div.gateway-tab',$(this)).find('button.close').css('visibility','hidden');}},'a.gateway-link');$('.gateway-tabs').off('click','a.gateway-link').on('click','a.gateway-link',function(event){event.preventDefault();var tab=$(this).attr('rel');if($(event.target).hasClass('close')){GatewayModel.removeChoreo(tab);if($(this).find('.gateway-tab').hasClass('selected')){tab=$(this).prev().attr('rel');GatewayController.loadTab(tab);}else{$(this).remove();}}else{GatewayController.loadTab(tab);}});$('#gateway-tabs').off('click','.gateway-tab.add').on('click','.gateway-tab.add',function(event){selectedTab='Edge '+edgeNum;GatewayModel.addChoreo(selectedTab);GatewayController.setSelectedTab(selectedTab);GatewayView.updateTabs();$choreoContainer.hide();$gatewayStep.show();GatewayView.setEdgeDevice(true);edgeNum++;});$('#iot-gateway-container').off('click','#gateway-device').on('click','#gateway-device',function(){$choreoContainer.hide();$gatewayStep.show();GatewayView.setEdgeDevice();});$('#iot-gateway-container').off('mouseenter','.gateway-edit-choreo').on('mouseenter','.gateway-edit-choreo',function(){$editChoreoCallout.fadeIn(200);});$('#iot-gateway-container').off('mouseleave','.gateway-edit-choreo').on('mouseleave','.gateway-edit-choreo',function(){$editChoreoCallout.hide();});$('#iot-gateway-container').off('click','.gateway-edit-choreo').on('click','.gateway-edit-choreo',function(){$editChoreoCallout.hide();$choreoContainer.hide();$gatewayStep.show();GatewayView.setEdgeChoreo();});},setTabWidth:function(tab){tab.addClass('selected');tab.width(tab.width()+1);tab.removeClass('selected');},updateEdgeTabSelector:function(choreos){$('<div class="gateway-tab more">\
						<select id="edge-selector" class="edge-selector">\
						</select>\
					</div>').appendTo('#gateway-tabs');$('.gateway-tab.more').insertBefore($('.gateway-tab.add'));$edgeSelector=$('#edge-selector');var options=[];options.push('<option class="option-label-only">More</option>');$.each(choreos,function(tab,choreo){options.push('<option value="'+tab+'">'+tab+'</option>');});$edgeSelector.html(options.join(''));var selectedOption=GatewayController.getSelectedTab();if(selectedOption&&$('#edge-selector option[value="'+selectedOption+'"]').length==1){$edgeSelector.val(selectedOption);$('#gateway-tabs .gateway-tab.more').addClass('selected');}else{$edgeSelector.val('More');}
$edgeSelector.selectBox().on('change',function(){GatewayController.loadTab($(this).val());});$('a.selectBox.edge-selector').show();$('.selectBox-options.edge-selector-selectBox-dropdown-menu li').each(function(){$('<button class="icon close" value="'+$(this).find('a').attr('rel')+'"></button>').appendTo(this);});$('.selectBox-options.edge-selector-selectBox-dropdown-menu').off('click','button.close').on('click','button.close',function(){if($(this).parent().hasClass('selectBox-selected')){var prevTab=GatewayController.getPrevTab($(this).val());GatewayModel.removeChoreo($(this).val());GatewayController.loadTab(prevTab);}else{GatewayModel.removeChoreo($(this).val());GatewayView.updateTabs();}});},fadeOut:function(fadeStep){$.each(toFade,function(){$(this).addClass('gateway-step-fade')});if(fadeStep){$('#iot-gateway-container #gateway-step').addClass('gateway-step-fade');}},fadeIn:function(){$.each(toFade,function(){$(this).removeClass('gateway-step-fade')});$('#iot-gateway-container #gateway-step').removeClass('gateway-step-fade');},setEdgeDevice:function(add){var $gatewayStep=$('#iot-gateway-container #gateway-step'),$choreoContainer=$('#choreo-container'),$divider=$('#iot-gateway-container hr.gateway-divider'),$editButton=$('#iot-gateway-container button.gateway-edit-choreo'),$gatewayDevice=$('#iot-gateway-container #gateway-device');var device=GatewayController.getSelectedProperty('device');var network=GatewayController.getSelectedProperty('network');var uri=GatewayController.getSelectedProperty('uri');if(!add){editing=true;}
GatewayView.fadeOut();$gatewayDevice.hide();$divider.hide();$editButton.hide();$('.library-view .tree').removeClass('gateway-select-choreo');$gatewayStep.removeClass().addClass('add-device');$gatewayStep.find('.gateway-step-title').hide();$gatewayStep.find('.gateway-step-action').empty();$gatewayStep.find('.gateway-step-title.gateway-select-device').show();$gatewayStep.find('.gateway-step-action').append('<div class="gateway-buttons">\
						<button class="button save" disabled="true">'+(uri?'OK':'Next')+'</button></div>');if(!editing){if(device){GatewayController.setSelectedEdgeDevice(device);}
if(network){GatewayController.setSelectedEdgeNetwork(network);}}
var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.isChoreo){GatewayView.updateEdgeDeviceSelector(currentItem);GatewayView.updateEdgeNetworkSelector(currentItem);}
$gatewayStep.off('click','button.save').on('click','button.save',function(){device=GatewayController.getSelectedEdgeDevice();if(device=='Samsung.Artik.Ten'){network=null;}else{network=GatewayController.getSelectedEdgeNetwork();}
GatewayController.setSelectedProperty('device',device);GatewayController.setSelectedProperty('network',network);GatewayView.updateDeviceName(device,network);IoTModeView.updateSnippets(currentItem);if(add){TriggerView.hide('input');TriggerView.hide('output');}
$(IoTModeController).trigger('gatewaydevicechanged');if(GatewayController.getSelectedProperty('uri')){$gatewayStep.hide();$choreoContainer.show();$divider.show();$editButton.show();$gatewayDevice.css('display','inline-block');GatewayView.fadeIn();}else{GatewayView.setEdgeChoreo();}
if(!add){editing=false;}
var deviceName=GatewayController.getSelectedProperty('device');if(deviceName=='Samsung.Artik.Ten'){deviceName='Samsung.Artik.10'};_gaq.push(['_trackEvent',"M2M","Selected edge device",deviceName+(GatewayController.getEdgeShield()?', '+shieldNameMap[GatewayController.getEdgeShield()]:'')]);});$gatewayStep.off('click','button.close').on('click','button.close',function(){if((GatewayController.getSelectedProperty('device')&&GatewayController.getSelectedProperty('network'))||GatewayController.getSelectedProperty('device')=='Samsung.Artik.Ten'){$gatewayStep.hide();$gatewayDevice.css('display','inline-block');$choreoContainer.show();$divider.show();$editButton.show();}else{var prevTab=GatewayController.getPrevTab(selectedTab);if(add){GatewayModel.removeChoreo(selectedTab);}
GatewayController.loadTab(prevTab);}
if(!add){editing=false;}
GatewayView.fadeIn();});},updateEdgeDeviceSelector:function(item){$('.gateway-device-select-container').remove();var $gatewayStep=$('#iot-gateway-container #gateway-step');var $deviceSelector=$('<select class="gateway-device-selector"></select>');$deviceSelector.append('<option value="Samsung.Artik.Ten">Samsung ARTIK 10</option>\
						<option value="ti_cc3200">TI CC3200</option>');$deviceSelector.appendTo($gatewayStep.find('.gateway-step-action'));$deviceSelector.wrap('<div class="gateway-device-select-container"></div>');var device=GatewayController.getSelectedEdgeDevice();var network=GatewayController.getSelectedEdgeNetwork();for(var optionName in item.deviceNetworkCredentials.data){if($.inArray(item.deviceNetworkCredentials.data[optionName].inputs.Shield,GatewayController.getEdgeNetworks())>-1){var firstNetwork=item.deviceNetworkCredentials.data[optionName];break;}}
if(device&&device!='ArduinoOthers'){$deviceSelector.val(device);}else if(network&&item.deviceNetworkCredentials.data[network]&&(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[network].inputs.Shield)!='ArduinoOthers')){device=IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[network].inputs.Shield);GatewayController.setSelectedEdgeDevice(device);$deviceSelector.val(device);}else if(firstNetwork){device=IoTModeController.getShieldDevice(firstNetwork.inputs.Shield);GatewayController.setSelectedEdgeDevice(device);$deviceSelector.val(device);}else{$deviceSelector.prepend('<option class="option-label-only">What\'s your edge device?</option>').val('Select');}
var elideBy=$deviceSelector.data('max-chars');if(!elideBy||elideBy.length<1){elideBy=17;}
$deviceSelector.selectBox().on('change',function(){var selectedDevice=$(this).val();if(selectedDevice!='Select'){GatewayController.setSelectedEdgeDevice(selectedDevice);}});$(ItemController).unbind('unload.selectiotmodedevice').bind('unload.selectiotmodedevice',function(e,item){$deviceSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});},updateEdgeNetworkSelector:function(item){$('.gateway-network-select-container').remove();$('#gateway-step .connectivity-not-needed').remove();var $gatewayStep=$('#iot-gateway-container #gateway-step');var $networkSelector=$('<select class="gateway-network-selector" data-max-chars="20"></select>');var $connectivityNotNeeded=$('<div class="connectivity-not-needed">Onboard Ethernet & WiFi</div>');$networkSelector.appendTo($gatewayStep.find('.gateway-step-action'));$networkSelector.wrap('<div class="gateway-network-select-container"></div>');$connectivityNotNeeded.appendTo($gatewayStep.find('.gateway-step-action'));$('#gateway-step button.save').attr('disabled','disabled');var device=GatewayController.getSelectedEdgeDevice();var network=GatewayController.getSelectedEdgeNetwork();var options=[];var elideBy=$networkSelector.data('max-chars');if(device=='ti_cc3200'){for(var optionName in item.deviceNetworkCredentials.data){if(IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[optionName].inputs.Shield)=='ti_cc3200'&&$.inArray(item.deviceNetworkCredentials.data[optionName].inputs.Shield,GatewayController.getEdgeNetworks())>-1)
options.push('<option value="'+optionName+'">'+$.temboo.elide(optionName,elideBy,'middle')+'</option>');}}
if(!device){$('.gateway-network-select-container').addClass('disabled');}else{$('.gateway-network-select-container').removeClass('disabled');}
if(options.length>0){GatewayView.showConnectivity();if(device=='ti_cc3200'){options.push('<option value="Shield type" class="new-device-network-credential device-network-credential-component choose-device-network-credential">Add a new connection:</option>');if(FEATURE_RTOS){options.push('<option value="Shield type" class="device-network-credential-component device-network-category">TI-RTOS</option>\
						                <option value="new-ti_cc3200_rtos" class="new-device-network-credential device-network-credential-component">TI CC3200 (WiFi) + RTOS</option>\
						                <option value="Shield type" class="device-network-credential-component device-network-spacer"></option>\
						                <option value="Shield type" class="device-network-credential-component device-network-category">Other</option>');}
options.push('<option value="new-ti_cc3200" class="new-device-network-credential device-network-credential-component">TI CC3200 (WiFi)</option>');}
$networkSelector.html(options.join());$('#gateway-step button.save').removeAttr('disabled');if(network&&item.deviceNetworkCredentials.data[network]&&device==IoTModeController.getShieldDevice(item.deviceNetworkCredentials.data[network].inputs.Shield)){$networkSelector.val(network);}else{var firstNetwork=$networkSelector.find('option:first').val();if(firstNetwork&&item.deviceNetworkCredentials.data[firstNetwork]){GatewayController.setSelectedEdgeNetwork(firstNetwork);$networkSelector.val(firstNetwork);}}
$networkSelector.selectBox().on('change',function(){var selectedDeviceNetworkCredential=$(this).val();if(selectedDeviceNetworkCredential=='Select'){return false;}
if(item.deviceNetworkCredentials.data[selectedDeviceNetworkCredential]){GatewayController.setSelectedEdgeNetwork(selectedDeviceNetworkCredential);}else{$(this).val(GatewayController.getSelectedEdgeNetwork());}}).on('close',function(){var selectedDeviceNetworkCredential=GatewayController.getSelectedEdgeNetwork();if(selectedDeviceNetworkCredential&&selectedDeviceNetworkCredential.length>0){$('.gateway-network-selector.selectBox-dropdown .selectBox-label').html($.temboo.elide(selectedDeviceNetworkCredential,elideBy,'middle'));}});$('.gateway-network-selector-selectBox-dropdown-menu li.new-device-network-credential').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();if(!$(this).hasClass('choose-device-network-credential')){var networkName=$(this).find('a').attr('rel');GatewayView.updateEdgeNetworkSelector(item);if(networkName!==''){CredentialsTemplateController.addCredential(event,device,networkName.substring(4));}}});$('.selectBox-options.gateway-network-selector-selectBox-dropdown-menu li:not(.new-device-network-credential)').each(function(){$('<button class="button xsmall edit-credential device-network-credential-component gateway-network-credential-component" value="'+$(this).find('a').attr('rel')+'">edit</button>').appendTo(this).click(function(e){GatewayView.updateEdgeNetworkSelector(item);});});}else{if(device=='Samsung.Artik.Ten'){GatewayView.hideConnectivity();GatewayController.setSelectedEdgeNetwork(null);$('#gateway-step button.save').removeAttr('disabled');}else{GatewayView.showConnectivity();if(device=='ti_cc3200'){$networkSelector.html('<option class="option-label-only">How is it connected?</option>');if(FEATURE_RTOS){$networkSelector.append('<option value="Shield type" class="device-network-credential-component device-network-category">TI-RTOS</option>\
							                           <option value="new-ti_cc3200_rtos">TI CC3200 (WiFi) + RTOS</option>\
							                           <option value="Shield type" class="device-network-credential-component device-network-spacer"></option>\
							                           <option value="Shield type" class="device-network-credential-component device-network-category">Other</option>');}
$networkSelector.append('<option value="new-ti_cc3200">TI CC3200 (WiFi)</option>');}else{$networkSelector.html('<option class="option-label-only">How is it connected?</option>');}}
$networkSelector.selectBox();$('.gateway-network-selector-selectBox-dropdown-menu li').addClass('device-network-credential-component').off('mouseup').on('mouseup',function(event){event.stopPropagation();event.preventDefault();var credentialName=$(this).find('a').attr('rel');if(credentialName!=''){GatewayView.updateEdgeNetworkSelector(item);if(device){CredentialsTemplateController.addCredential(event,GatewayController.getSelectedEdgeDevice(),credentialName.substring(4));}else{CredentialsTemplateController.addCredential(event,IoTModeController.getShieldDevice(credentialName.substring(4)),credentialName.substring(4));}}});}
$(ItemController).unbind('unload.selectiotmodenetworkcredential').bind('unload.selectiotmodenetworkcredential',function(e,item){$networkSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});},hideConnectivity:function(){$('.gateway-network-select-container').hide();$('#gateway-step .connectivity-not-needed').show();},showConnectivity:function(){$('#gateway-step .connectivity-not-needed').hide();$('.gateway-network-select-container').show();},setEdgeChoreo:function(){var $gatewayStep=$('#iot-gateway-container #gateway-step'),$gatewayStepAction=$('.gateway-step-action',$gatewayStep),$choreoContainer=$('#choreo-container'),$divider=$('#iot-gateway-container hr.gateway-divider'),$editButton=$('#iot-gateway-container button.gateway-edit-choreo');$divider.hide();$editButton.hide();$gatewayStep.removeClass().addClass('add-choreo');$('.library-view .tree').addClass('gateway-select-choreo');GatewayView.fadeOut();$('.column.column-first').removeClass('gateway-step-fade');$gatewayStep.find('.gateway-step-title').hide();$gatewayStepAction.empty();if(selectedTab=='Gateway'){$gatewayStep.find('.gateway-step-title.gateway-select-gateway-choreo').show();}else{$('#iot-gateway-container #gateway-device').css('display','inline-block');$gatewayStep.find('.gateway-step-title.gateway-select-edge-choreo').show();}
$gatewayStep.off('click','button.close').on('click','button.close',function(){$('.library-view .tree').removeClass('gateway-select-choreo');if(GatewayController.getSelectedProperty('uri')){$gatewayStep.hide();$choreoContainer.show();$editButton.show();if(selectedTab!='Gateway'){$divider.show();}}else{var prevTab=$('a[rel="'+selectedTab+'"]').prev().attr('rel');GatewayModel.removeChoreo(selectedTab);GatewayController.loadTab(prevTab);}
GatewayView.fadeIn();});},updateDeviceName:function(device,network){if(!device&&!network){$('#iot-gateway-container #gateway-device').hide();}else{if(device=='ti_cc3200'){device='TI CC3200';}else if(device=='Samsung.Artik.Ten'){device='Samsung ARTIK 10';network='Onboard Ethernet & WiFi';}
$('#iot-gateway-container #gateway-device .device').text(device);$('#iot-gateway-container #gateway-device .network').text(network);$('#iot-gateway-container #gateway-device').css('display','inline-block');}},updateInputs:function(inputs){var $inputFields=$('.details-view .item-view .run-mode-form').find('input.run-mode-component');for(var input in inputs){var $inputField=$inputFields.filter('[name='+input+']');$inputField.val(inputs[input]);}
SnippetController.loadUserSnippet();},setEdgeNum:function(num){edgeNum=num;}};}();var ProfilesController=function(){return{init:function(){var unpickle=$.cookie('tmbLastProfile');$(ItemController).bind('itemloaded',function(event){var currentItem=ItemController.getCurrentItem();if(currentItem&&currentItem.model&&currentItem.model.type=='choreo'){$('#save-profile').off('click').on('click',function(event){event.preventDefault();ProfilesView.updateInputs(currentItem);});var profileEditLink;if(unpickle&&unpickle.length>0){unpickle=$.parseJSON(unpickle);if(unpickle&&unpickle.uri&&unpickle.uri==currentItem.uri){profileEditLink=unpickle.name;unpickle=false;$.cookie('tmbLastProfile','',{expires:-1,path:'/'});}}
ProfilesView.updateProfileSelector(currentItem,profileEditLink);if(profileEditLink){ProfilesView.updateInputs(currentItem,profileEditLink);}}});},save:function(item,profileName,credentialName){var args={profileName:profileName,choreoUri:item.uri};var inputs={};var credentialInputs={};var $inputs=ProfilesView.getNonCredentialInputs(true);var $credentialInputs=ProfilesView.getCredentialInputs(true);var credentialOnly=($inputs.length==0&&$credentialInputs.length>0);credentialName=credentialOnly?profileName:credentialName;$inputs.each(function(){inputs[$(this).data('name')]=$(this).val();});$credentialInputs.each(function(){credentialInputs[$(this).data('name')]=$(this).data('credential-value');});args.inputs=JSON.stringify(inputs);args.credentialInputs=JSON.stringify(credentialInputs);CredentialsModel.template()&&(args.templateName=CredentialsModel.template().name);credentialName&&(args.credentialName=credentialName);$('.profile-container .profile-buttons').hide();$('.profile-container .profile-name').removeClass('error');$('.profile-container').addClass('has-spinner');$('.profile-container .profile-buttons .callout').removeClass('shadow');$.post('/choreo_proxy/profile/',args,function(response){if(response.status=='success'){$('<div class="status-alert success"></div>').append($('<p>').text('Your Profile has been saved!')).appendTo('body').fadeIn(200).delay(4000).fadeOut(200,function(){$(this).remove();});if(credentialName){if(!item.credentials.data){item.credentials.data={};}
item.credentials.data[credentialName]={name:credentialName,inputs:credentialInputs};if(ItemController.getCurrentItem().uri==item.uri){CredentialsModel.init(item.credentials.template,item.credentials.data);}}
if(!credentialOnly){if(!item.profiles){item.profiles={};}
item.profiles[profileName]={name:profileName,inputs:inputs,credential:credentialName}}
ItemController.flushCurrentItem();ProfilesView.updateProfileSelector(item,profileName);ProfilesView.updateInputs(item,profileName);ItemsView.applyCredential(CredentialsModel.get(profileName));SnippetController.loadUserSnippet();}else{$('.profile-container .profile-name').addClass('error');if(response.data&&response.data.errorHTML){$('.profile-container').find('.profile-name-error').html(response.data.errorHTML).show();if($('.max-profiles-message','.profile-container .profile-buttons .callout').length>0){$('.profile-container .profile-buttons .callout').addClass('shadow');$('.profile-container .profile-name').removeClass('error');}}else{$('.profile-container').find('.profile-name-error').html('Something went wrong while saving your profile. Please contact <a href="/support" target="_blank">Support</a> if this persists.').show();$('.profile-container .profile-buttons .callout').removeClass('shadow');}
$('.profile-container .callout').show();}
$('.profile-container').removeClass('has-spinner');$('.profile-container .profile-buttons').show();},'json').error(function(){$('.profile-container').find('.profile-name-error').html('Something went wrong while saving your profile. Please contact <a href="/support" target="_blank">Support</a> if this persists.').show();$('.profile-container .callout').show();$('.profile-container .profile-name').addClass('error');$('.profile-container').removeClass('has-spinner');$('.profile-container .profile-buttons').show();});},getExistingOrNewCredentialName:function(checkInputs){var credentials=CredentialsModel.credentials();var matchingCredential;if(checkInputs){for(var checkName in credentials){if(Object.keys(credentials[checkName].inputs).length!=Object.keys(checkInputs).length){continue;}
var mismatch=false;for(var checkInputName in checkInputs){if(!credentials[checkName].inputs[checkInputName]||credentials[checkName].inputs[checkInputName]!==checkInputs[checkInputName]){mismatch=true;break;}}
if(!mismatch){return checkName;}}}
var baseName=CredentialsModel.template().name+"Account";var tryName=baseName;var i=2;while(credentials[tryName]){tryName=baseName+i;i++;}
return tryName;}};}();var ProfilesView=function(){return{updateInputs:function(item,selectedProfile){var $profileInputs=ProfilesView.getInputs();var $profileContainer=$('.profile-container');var $credentialInputs=ItemController.getCredentialInputs(true);var $otherInputs=ItemController.getNonCredentialInputs(true);var $choreoInputs=$credentialInputs.add($otherInputs);var $profileName=$('#profile-name').val('');var $profileSave=$('.profile-container button.profile-confirm-save').attr('disabled',true);var credentials=CredentialsModel.credentials();var credentialInputs={};var otherInputs={};var credentialOnly=false;var existingCredential=false;var newCredential=false;var clearProfileName=false;var credentialProfileName=false;var previous;$profileInputs.off('cut keyup paste');if(!selectedProfile){if($('#profile-selector').val()&&$('#profile-selector').val()!='Select Profile'){previous=CredentialsModel.get($('#profile-selector').val()).hasOwnProperty('credential')?'choreoInputs':'credential';}
if($choreoInputs.length==0){$('.profile-buttons').show();$('#save-profile').show();ProfilesView.updateProfileSelector(item);return false;}
credentialOnly=($otherInputs.length==0&&$credentialInputs.length>0);$profileInputs.data('credential-value','');if(credentialOnly){ItemController.getCredentialInputs().removeClass('credential-profile');$('.credential-name').hide();if(previous=='choreoInputs'){credentialProfileName=CredentialsModel.get($('#profile-selector').val()).credential;}
if(previous=='choreoInputs'){clearProfileName=true;}}else{if($credentialInputs.length>0&&previous=='credential'){clearProfileName=true;}}}else{if(item.profiles&&item.profiles[selectedProfile]){otherInputs=item.profiles[selectedProfile].inputs;credential=item.profiles[selectedProfile].credential;if(credentials&&credentials[credential]){existingCredential=credential;credentialInputs=credentials[credential].inputs;}}else if(credentials&&credentials[selectedProfile]){credentialInputs=credentials[selectedProfile].inputs
credentialOnly=true;}else{$('.profile-buttons').hide();$('#save-profile').show();ProfilesView.updateProfileSelector(item);return false;}
$profileInputs.data('credential-value','').val('');ItemController.getCredentialInputs().removeClass('credential-profile');$('.credential-name').hide();var optional=false;if(credentialOnly){for(var credentialInput in credentialInputs){var $input=$profileInputs.filter('[name='+credentialInput+']');$input.val(credentialInputs[credentialInput]).data('credential-value',credentialInputs[credentialInput]);if($input.parent().parent().hasClass('optional')&&!optional){optional=true;}}}else{if(existingCredential){for(var credentialInput in credentialInputs){var $input=$profileInputs.filter('[name='+credentialInput+']');$input.val(credentialInputs[credentialInput]).data('credential-value',credentialInputs[credentialInput]);$('<div class="tmb-flash"></div>').css({width:$input.innerWidth(),height:$input.innerHeight()}).insertAfter($input);}
ItemController.getCredentialInputs().addClass('credential-profile');$('.credential-name').text($.temboo.elide(existingCredential,17,'middle')).show();if($input.parent().parent().hasClass('optional')&&!optional){optional=true;}}
for(var otherInput in otherInputs){var $input=$profileInputs.filter('[name='+otherInput+']');$input.val(otherInputs[otherInput]);if($input.parent().hasClass('optional')&&!optional){optional=true;}}}
if(optional&&$('.meta-class.inputs.optional').hasClass('tmb-collapsed')){$('.meta-class.inputs.optional .meta-class-name.subtitle').click()}
$profileInputs.each(function(){var $input=$(this);$('<div class="tmb-flash"></div>').css({width:$input.innerWidth(),height:$input.innerHeight()}).insertAfter($input);});setTimeout(function(){$('.details-view .item-view .tmb-flash').fadeOut('600',function(){$(this).remove();});},200);ItemsView.applyCredential(CredentialsModel.get(selectedProfile));SnippetController.loadUserSnippet();}
$profileContainer.find('button.profile-cancel').off('click').on('click',function(event){event.preventDefault();if(selectedProfile){ProfilesView.updateInputs(item,selectedProfile);}else{$('.profile-container .callout').hide();$('.profile-container .profile-name').removeClass('error');$('.profile-buttons').hide();$('#save-profile').show();$('a.profile-selector').show();if(!credentialOnly&&clearProfileName){$('.credential-profile').removeClass('credential-profile');$('.credential-name').hide();}}});$profileContainer.find('.callout button.close').off('click').on('click',function(event){$('.profile-container .callout').hide();$('.profile-container .profile-name').removeClass('error');})
$profileContainer.find('button.profile-confirm-save').off('click').on('click',function(event){event.preventDefault();var $credentialInputs=ItemController.getCredentialInputs(true);var $otherInputs=ItemController.getNonCredentialInputs(true);var $choreoInputs=$credentialInputs.add($otherInputs);credentialOnly=($otherInputs.length==0&&$credentialInputs.length>0);if(credentialOnly){$credentialInputs.each(function(){$profileInputs.filter('[name='+$(this).attr('name')+']').data('credential-value',$(this).val());});}else if($credentialInputs.length>0){var checkInputs={}
$credentialInputs.each(function(){$profileInputs.filter('[name='+$(this).attr('name')+']').data('credential-value',$(this).val());checkInputs[$(this).attr('name')]=$(this).val();});newCredential=ProfilesController.getExistingOrNewCredentialName(checkInputs);ItemController.getCredentialInputs().addClass('credential-profile');$('.credential-name').text($.temboo.elide(newCredential,17,'middle')).show();}
if(existingCredential){newCredential=existingCredential;}
ProfilesController.save(item,$profileName.val(),newCredential);});$profileName.on('keypress',function(event){if(event.keyCode==13){$profileContainer.find('button.profile-confirm-save').click();}});$('.profile-container').removeClass('has-spinner');if(selectedProfile){$('.profile-container .profile-buttons button').hide();}else{$('.profile-container .profile-buttons button').show();}
$('.profile-buttons').show();$('#save-profile').hide();$profileName.off('cut keyup paste').on('cut keyup paste',function(event){var userVal=$(this).val(),formattedVal=userVal;if(formattedVal.length>0){formattedVal=formattedVal.replace(/[^a-zA-Z0-9]/g,'');}
if(formattedVal!=userVal){$(this).val(formattedVal);}
if(formattedVal!=''){$profileSave.attr('disabled',false);}else{$profileSave.attr('disabled',true);}});if(selectedProfile){$profileName.hide();$('a.profile-selector').show();}else{$profileName.show().focus();if($('#profile-selector').val()&&$('#profile-selector').val()!='Select Profile'&&!clearProfileName&&!credentialProfileName){$profileName.val($('#profile-selector').val());$profileSave.attr('disabled',false);}else if(credentialProfileName){$profileName.val(credentialProfileName);$profileSave.attr('disabled',false);}
$('a.profile-selector').hide();}
$('.profile-container .callout').hide();ChoreoController.runModeIsActive()&&$('.details-view .run-mode-form').valid();},updateProfileSelector:function(item,selectedProfile){var $profileSelector=$('#profile-selector');var options=[];var choreoInputs=[];var credentials=[];$profileSelector.off('change').filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();})
for(var profile in item.profiles){choreoInputs.push('<option data-sort="'+profile.toLowerCase()+'" value="'+profile+'" class="profile choreo-input">'+$.temboo.elide(profile,17,'middle')+'</option>');}
for(var credential in CredentialsModel.credentials()){credentials.push('<option data-sort="'+credential.toLowerCase()+'"value="'+credential+'" class="profile credential">'+$.temboo.elide(credential,17,'middle')+'</option>');}
if(choreoInputs.length){choreoInputs.sort();options.push(choreoInputs);}
if(credentials.length){credentials.sort();options.push('<option class="profile credentials-label" disabled="disabled">Account Credentials</option>')
options.push(credentials);}
if(options.length){options.unshift('<option class="option-label-only">Select Profile</option>');$profileSelector.html(options.join(''));if(selectedProfile){$profileSelector.val(selectedProfile);}
$profileSelector.selectBox().on('change',function(){ProfilesView.updateInputs(item,$(this).val());});$('.details-view .item-view a.profile-selector').show();$('#save-profile').text('Save');$(ItemController).unbind('unload.selectprofile').bind('unload.selectprofile',function(e,item){$profileSelector.filter('.selectBox').each(function(){$(this).selectBox('destroy').hide();});});}else{$('#save-profile').text('Save Profile');}
$('.profile-container .callout').hide();ChoreoController.runModeIsActive()&&$('.details-view .run-mode-form').valid();},updateButtons:function(input){if(ItemController.getInputs(true).length>0&&!$('.profile-buttons button').is(':visible')){$('#save-profile').show();}else{$('#save-profile').hide();}
if(input.hasClass('credential-profile')){$('.credential-profile').removeClass('credential-profile');$('.credential-name').hide();}},getInputs:function(filledOnly){var $inputs=$('.details-view .item-view .run-mode-form').find('input.run-mode-component, textarea.run-mode-component');return filledOnly?$inputs.filter(function(){return $(this).val()!='';}):$inputs;},getCredentialInputs:function(filledOnly){var $inputs=$('.details-view .item-view .run-mode-form .meta-item.credential').find('input.run-mode-component, textarea.run-mode-component');return filledOnly?$inputs.filter(function(){return $(this).val()!='';}):$inputs;},getNonCredentialInputs:function(filledOnly){var $inputs=$('.details-view .item-view .run-mode-form .meta-item').not('.credential').find('input.run-mode-component, textarea.run-mode-component');return filledOnly?$inputs.filter(function(){return $(this).val()!='';}):$inputs;}};}();var PinController=function(){var $container=$('#pin-selector'),boardModel,pins,defaultPins,boardController,selectedTab;var setSelectable=function(selectable){if(selectable){$container.addClass('selectable');}else{$container.removeClass('selectable');}}
var pinSelectHandler=function(event,pin){if(event.type=='select'){$(pin).off('remove.pin').on('remove.pin',function(){Temboo.log('PinController removing pin '+pin.getId());delete pins[pin.getId()];});}};return{getDefaultPin:function(type){return defaultPins[type];},updateDefaultPin:function(type,pin){defaultPins[type]=pin;},getPin:function(id){return pins[id];},getPinByLabel:function(name){var pin;for(var id in pins){if(name==pins[id].getLabel()){pin=pins[id];break;}}
return pin;},getPinByName:function(name){var pin;for(var id in pins){if(name==pins[id].getName()){pin=pins[id];break;}}
return pin;},getPinByType:function(type){var pin;for(var id in pins){if(type==pins[id].getType()){pin=pins[id];break;}}
return pin;},getPinsBySupportedMode:function(signal,type){var supportingPins=[];for(var id in pins){if(pins[id].supportsMode(signal,type)){supportingPins.push(pins[id]);}}
return supportingPins;},getPinByPinId:function(transducerName){var pin;for(var id in pins){if(transducerName==pins[id].getPinId()){pin=pins[id];break;}}
return pin;},getPins:function(){return $(pins).deepCopy();},getSensors:function(){var sensors=[];for(var pinId in pins){var pin=pins[pinId];if(pin.isSensor()){sensors.push(pin.getPinId());}}
return sensors;},getMonitoringStructure:function(){var monitoring={};monitoring.inputs=false;monitoring.analogInputs=false;monitoring.pins={};monitoring.numPins=0;for(var pinId in pins){var pin=pins[pinId];if(pin.isTransducer()){var myPin={};myPin.pinNumber=pin.getLabel();myPin.input=pin.isSensor();myPin.default=pin.getDefaultValue();myPin.analog=pin.isAnalog();if(pin.isSensor()){monitoring.inputs=true;if(pin.isAnalog()){monitoring.analogInputs=true;}}
if(boardModel.device=='Yun'&&boardModel.brand=='Arduino'){myPin.type=pin.getLibrary();}
monitoring.pins[pin.getPinName()]=myPin;monitoring.numPins=monitoring.numPins+1;}}
monitoring.storage=$('.device-registration-form input[name=safeguard-data]').is(':checked');var sensorInterval=$('.device-registration-form select[name=sensor-interval]').val();if(sensorInterval=='custom'){sensorInterval=parseInt($('.device-registration-form input#custom-interval').val())*1000;}else{sensorInterval=parseInt(sensorInterval);}
monitoring.interval=sensorInterval;return monitoring;},init:function(){$(IoTModeController).unbind('brandchanged devicechanged networkchanged gatewaytabloaded gatewaydevicechanged').bind('brandchanged devicechanged networkchanged gatewaytabloaded gatewaydevicechanged',function(e,which){var device;var shield;var boardChanged=false;if(IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'){device=GatewayController.getSelectedProperty('device');shield=GatewayController.getEdgeShield();}else{device=IoTModeController.getDevice();shield=IoTModeController.getShield();}
var prevBoard=boardModel;boardModel=BoardModel.get(device,shield);var prevTab;if(IoTModeController.gatewayEnabled()){prevTab=selectedTab;selectedTab=GatewayController.getSelectedTab();}
if(ItemController.getLoggedIn()&&device&&(shield||device=='ArduinoYun'||device=='Samsung.Artik.Ten')){setSelectable(true);}else{setSelectable(false);}
if(!prevBoard||e.type=='brandchanged'||boardModel.constructor!=prevBoard.constructor||IoTModeController.gatewayEnabled()&&prevTab!=selectedTab){if((!prevBoard||e.type=='brandchanged'||boardModel.constructor!=prevBoard.constructor)&&e.type=='gatewaydevicechanged'){boardChanged=true;}
var pin;pins={};defaultPins={};var triggerPins={};$.each(boardModel.pins,function(bank,pinsData){$.each(pinsData,function(pinRow,pinInit){pinInit.bank=bank;pinInit.row=pinRow;pin=new PinModel(boardModel,pinInit);pins[pin.getId()]=pin;pinInit.default&&(defaultPins[pinInit.type]=pin);$(pin).bind('select deselect',pinSelectHandler);});});if(IoTModeController.gatewayEnabled()){if(!boardChanged){var conditions=GatewayController.getSelectedProperty('conditions');if(conditions){var triggerPins=conditions['pins'];for(var name in triggerPins){var signal=triggerPins[name]['analog']?'analog':'digital';var type=triggerPins[name]['input']?'input':'output';var value=type=='input'?conditions.triggers.input.rhs:conditions.actions[0].writePin.value;var newPin=PinController.getPinByName(name);var oldPin=PinController.getDefaultPin(type);if(newPin){oldPin.setSignal(signal);oldPin.setValue(value);oldPin.relocate(newPin);}}}}}
$('.trigger .subtitle').hide();$('.trigger .selectBox-container').hide();$(PinController).trigger('boardloaded',{boardModel:boardModel,pinModels:pins,boardChanged:boardChanged});}});}}}();var PinboardController=function(){var $pinSelector=$('#pin-selector'),$board=$('.board',$pinSelector),selectedPins={},self;var calloutCloseTimeout;var pinSelectHandler=function(event,pin){var $view=PinboardView.getPinView(pin);if(event.type=='deselect'){$view.removeClass('selected selected-'+pin.getType());}
else{selectedPins[pin.getId()]=pin;$view.addClass('selected selected-'+pin.getType());if(!pin.modeIsValid()){$(pin).trigger('invalidstartsignal');}
$(pin).off('mouseenter.board').on('mouseenter.board',function(){if(pin.isInput()){$('.trigger.input-trigger label.pin').addClass('hover');}else if(pin.isOutput()){$('.trigger.output-trigger label.pin').addClass('hover');}});$(pin).off('mouseleave.board').on('mouseleave.board',function(){if(pin.isInput()){$('.trigger.input-trigger .pin').removeClass('hover');}else if(pin.isOutput()){$('.trigger.output-trigger .pin').removeClass('hover');}});$(pin).off('remove.board').on('remove.board',function(){var stillInUse=false,newUID='',currentItem=ItemController.getCurrentItem(),pinModels=currentItem?currentItem.pinModels:null,currentPinId=''+this.getId(),currentPinName=this.getLabel(),lastMatch;if(pinModels){for(var pinId in pinModels){if(pinId!=currentPinId&&pinModels[pinId].getLabel()==currentPinName){lastMatch=pinModels[pinId];}}
if(lastMatch){stillInUse=true;newUID=lastMatch.getId();}}
if(stillInUse){$view.data('uid',newUID);}else{$view.removeClass('selected selected-input selected-output').data('uid','');}
delete selectedPins[pin.getId()];});}};var alignPinCallout=function(hoverContainer){hoverContainer.css('margin-top',($('.callout',hoverContainer).outerHeight()/2+10)*-1);};var clickOutsideCallout=function(event){var $target=$(event.target).closest('.pin-container');if(!$target.first().is(event.data.container)){removeCallout();$(document).off('click',clickOutsideCallout);if($target.length>0){$target.mouseenter();}}else{$pinSelector.addClass('callout-open');$('.pin',$target).removeClass('hover').addClass('callout-open');}};var addCallout=function(pinContainer){var $pinContainer=pinContainer,pinView=$('.pin',$pinContainer),pinId=pinView.data('uid'),pin=PinController.getPin(pinId);clearTimeout(calloutCloseTimeout);$pinContainer.append(PinboardView.renderPinCallout());var $callout=$('.callout',$pinContainer);$callout.append('<div class="content step-menu"></div>');var $content=$('.content.step-menu',$callout);if(!pinView.hasClass('transducer')){var text='';if(pin.supportsMode('analog','input')||pin.supportsMode('digital','input')){if(!pin.supportsMode('digital','input')){text+='Analog ';}else if(!pin.supportsMode('analog','input')){text+='Digital ';}
$content.append('<a class="menu add sensor">'+text+'Sensor</a><br/>');}
if(pin.supportsMode('analog','output')||pin.supportsMode('digital','output')){text='';if(!pin.supportsMode('digital','output')){text+='Analog ';}else if(!pin.supportsMode('analog','output')){text+='Digital ';}
$content.append('<a class="menu add actuator">'+text+'Actuator</a><br/>');}
if(CLOUD_CONTROLS_ACCESS&&DeviceController.deviceHasTransducers()){$content.append('<div class="not-sure">Not sure yet?</div>');}}else{editTransducer(pinView);}
$callout.on('click','.menu.add.sensor',function(event){setTransducerMedium(pinView,'sensor');});$callout.on('click','.menu.add.actuator',function(event){setTransducerMedium(pinView,'actuator');});$callout.on('click','.not-sure',function(){notSureYet(pinView);});if(!$callout.is(':empty')){$callout.fadeIn(200);$('.head-callout',$callout.closest('.callout-container')).fadeIn(200);}
pinView.off('click').on('click',function(){var calloutVisible=$('.callout',$(this).parent()).length>0;if(!$pinSelector.hasClass('callout-open')&&calloutVisible){clickMenu(pinView);}else if(calloutVisible){removeCallout();pinView.off('click').on('click',function(){pinView.mouseenter();});}else{pinView.mouseenter();}});$callout.on('click',function(e){if(e.target==this&&!$pinSelector.hasClass('callout-open')){clickMenu(pinView);}});$(document).off('click',clickOutsideCallout).on('click',{container:$pinContainer},clickOutsideCallout);}
var editTransducer=function(pinView){var $pinView=pinView,pinId=$pinView.data('uid'),pin=PinController.getPin(pinId),$callout=$pinView.parent().find('.callout');var $content=$('.content.step-menu',$callout);if($('.transducer-header',$callout).length>0){$('.transducer-header',$callout).show();}else{$callout.prepend('<div class="transducer-header">\
						<div class="transducer-name medium elided">'+(pin.getMedium()?pin.getMedium():pin.getLabel())+'</div>\
	    				<div class="direction">'+(pin.getMedium()?pin.getDirection():(pin.isSensor()?'Read':'Write')+' Data')+'</div></div>');}
$content.append('<div class="variable-name elided">'+pin.getPinId()+'</div>');if(pin.isAnalog()){$content.append('<span class="button xsmall white signal analog-only">Analog</span>');}else{$content.append('<span class="button xsmall white signal digital-only">Digital</span>');}
$content.append('<div class="buttons"></div>');$buttons=$('.buttons',$content);if(pin.getMedium()){$buttons.append('<a class="menu edit">Edit</a>');$buttons.on('click','.menu.edit',function(){clearTimeout(calloutCloseTimeout);var pinParams={'direction':pin.getDirection(),'medium':pin.getMedium(),'name':pin.getModel(),'manufacturer':pin.getManufacturer(),'signal':pin.getSignal(),'unit_high':pin.getUnitHigh(),'unit_low':pin.getUnitLow(),'analog_unit':pin.getAnalogUnit(),'analog_units':pin.getAnalogUnits(),'scale_high':pin.getScaleHigh(),'scale_low':pin.getScaleLow(),'calibration':pin.getCalibration(),'library':pin.getLibrary()};setTransducerName(pinView,pinParams,pin.getPinName(),pin.getPinId(),pin.getSafe());});}
$buttons.append('<a class="menu off">Delete</a>');$buttons.on('click','.menu.off',function(){var transducer=pin.getDirection();pin.removeTransducer();pinView.removeClass('transducer');if(pinView.hasClass('selected')){pin.select(false);if(transducer=='sensor'&&TriggerView.isOpen('input')){TriggerView.hide('input');TriggerController.removeInputTrigger(pin.getLabel());}else if(transducer=='actuator'&&TriggerView.isOpen('output')){TriggerView.hide('output');TriggerController.removeOutput(pin.getLabel());}}
if(transducer=='sensor'){IoTModeView.updateSensorSelector();}else if(transducer=='actuator'){IoTModeView.updateActuatorSelector();}
$('<div class="status-alert success"></div>').append($('<p>').text((transducer=='sensor'?'Sensor':'Actuator')+' deleted on Pin '+pin.getLabel())).appendTo('body').fadeIn(200).delay(4000).fadeOut(200,function(){$(this).remove();});removeCallout();SnippetController.loadUserSnippet();var currentItem=ItemController.getCurrentItem();IoTModeView.updateChoreoDetails(currentItem);});}
var setTransducerMedium=function(pinView,transducer){var $pinView=pinView,pinId=$pinView.data('uid'),pin=PinController.getPin(pinId),$callout=$pinView.parent().find('.callout');$pinSelector.addClass('callout-open');$pinView.removeClass('hover').addClass('callout-open');$callout.children().hide();var signal;if(pin.supportsMode('analog','input')||pin.supportsMode('digital','input')){if(!pin.supportsMode('digital','input')){signal='analog';}else if(!pin.supportsMode('analog','input')){signal='digital';}}
if(transducer=='sensor'){pin.setType('input');$callout.append('<ul class="sensor-type">\
	    				<li class="option-label-only">What are you sensing?</li>\
	    			</ul>');var sensors=TransducerController.getSensors();$.each(sensors,function(k,v){$('ul.sensor-type').append('<li><div class="transducer-icon" data-medium="'+v+'"></div>'+v+'</li>');});$('ul.sensor-type').off('click','li').on('click','li',function(){if($(this).hasClass('option-label-only')){return;}
var medium=$(this).text();var transducers=TransducerController.getTransducersByMedium(medium,'sensor',signal);if(!CLOUD_CONTROLS_ACCESS||!DeviceController.deviceHasTransducers()||IoTModeController.gatewayEnabled()){setTransducerName(pinView,{'direction':'sensor','medium':medium,'name':'Other'});}else if((!signal&&transducers.length<3)||(signal&&transducers.length<2)){var transducerCopy=transducers[0];setTransducerName(pinView,transducerCopy);}else{setTransducerModel(pinView,medium,'sensor',signal);}});}else{pin.setType('output');$callout.append('<ul class="actuator-type">\
	    				<li class="option-label-only">What is your actuator?</li>\
	    			</ul>');var actuators=TransducerController.getActuators();$.each(actuators,function(k,v){$('ul.actuator-type').append('<li><div class="transducer-icon" data-medium="'+v+'"></div>'+v+'</li>');});$('ul.actuator-type').off('click','li').on('click','li',function(){if($(this).hasClass('option-label-only')){return;}
var medium=$(this).text();var transducers=TransducerController.getTransducersByMedium(medium,'actuator',signal);if(!CLOUD_CONTROLS_ACCESS||!DeviceController.deviceHasTransducers()||IoTModeController.gatewayEnabled()){setTransducerName(pinView,{'direction':'actuator','medium':medium,'name':'Other'});}else if(medium=='LED'){setTransducerName(pinView,{'direction':'actuator','medium':'LED','name':'Other'});}else if(medium=='Other'){setTransducerName(pinView,{'direction':'actuator','medium':'Other','name':'Other'});}else if(transducers.length<2){setTransducerName(pinView,transducers[0]);}else{setTransducerModel(pinView,medium,'actuator',signal);}});}}
var setTransducerModel=function(pinView,medium,direction,signal){var $pinView=pinView,pinId=$pinView.data('uid'),pin=PinController.getPin(pinId),$callout=$pinView.parent().find('.callout');$callout.children().hide();$callout.append('<div class="transducer-header">\
    				<div class="medium">'+medium+'</div>\
    				<div class="direction">'+direction+'</div>\
    			</div>');$callout.append('<ul class="transducer-model">\
    				<li class="option-label-only">Which model will you use?</li>\
    			</ul>');var transducers=TransducerController.getTransducersByMedium(medium,direction,signal);var other=false;var any420ma=false;$.each(transducers,function(k,v){if(v.name=='Other'){if(other==false){other=k;}}else if(v.name=='Any 4-20 mA'){if(any420ma==false){any420ma=k;}}else{$('ul.transducer-model').append('<li data-index="'+k+'">'+(v.manufacturer?v.manufacturer+' ':'')+v.name+'</li>');}});if(any420ma!==false){$('ul.transducer-model').append('<li data-index="'+any420ma+'">Any 4-20 mA</li>');}
if(other!==false){$('ul.transducer-model').append('<li data-index="'+other+'">Other</li>');}
$('ul.transducer-model').off('click','li').on('click','li',function(){if($(this).hasClass('option-label-only')){return;}
var index=$(this).attr('data-index');setTransducerName(pinView,transducers[index]);});}
var notSureYet=function(pinView){var $pinView=pinView,pinId=$pinView.data('uid'),pin=PinController.getPin(pinId),$callout=$pinView.parent().find('.callout');$callout.children().hide();$callout.append('<div class="pin-instructions">\
					<p>OK! We’ll work directly with the pin for now.</p>\
					<a class="menu add read-pin">Read from Pin</a><br/>\
					<a class="menu add write-pin">Write to Pin</a>\
				</div>');$callout.off('click','a.read-pin').on('click','a.read-pin',function(){pin.setType('input');if(pin.supportsMode('analog','input')){pin.setSignal('analog');}else{pin.setSignal('digital');}
$('<div class="status-alert success"></div>').append($('<p>').text('Reading data on Pin '+pin.getLabel())).appendTo('body').fadeIn(200).delay(4000).fadeOut(200,function(){$(this).remove();});if(!pinView.hasClass('transducer')){pinView.addClass('transducer');}
pin.addTransducer({direction:'sensor',name:'Pin '+pin.getLabel()+' ('+pin.getSignal()+' read)',id:'pin_'+pin.getLabel()+'_'+pin.getSignal()+'_read',analogUnit:'V',analogUnits:['V']});$('.trigger a.selectBox.sensor-selector').show();IoTModeView.updateSensorSelector();if($('#sensor-selector').val()==pin.getLabel()){TriggerView.setTriggerSignal('input',pin.getSignal());}
$callout.children().hide();$callout.append('<div class="content step-menu"></div>');editTransducer(pinView);calloutCloseTimeout=setTimeout(function(){$callout.fadeOut(200,function(){removeCallout();});},2000);var currentItem=ItemController.getCurrentItem();IoTModeView.updateChoreoDetails(currentItem);});$callout.off('click','a.write-pin').on('click','a.write-pin',function(){pin.setType('output');if(pin.supportsMode('analog','output')){pin.setSignal('analog');}else{pin.setSignal('digital');}
$('<div class="status-alert success"></div>').append($('<p>').text('Writing data on Pin '+pin.getLabel())).appendTo('body').fadeIn(200).delay(4000).fadeOut(200,function(){$(this).remove();});if(!pinView.hasClass('transducer')){pinView.addClass('transducer');}
pin.addTransducer({direction:'actuator',name:'Pin '+pin.getLabel()+' ('+pin.getSignal()+' write)',id:'pin_'+pin.getLabel()+'_'+pin.getSignal()+'_write'});$('.trigger a.selectBox.actuator-selector').show();IoTModeView.updateActuatorSelector();if($('#actuator-selector').val()==pin.getLabel()){TriggerView.setTriggerSignal('output',pin.getSignal());}
$callout.children().hide();$callout.append('<div class="content step-menu"></div>');editTransducer(pinView);calloutCloseTimeout=setTimeout(function(){$callout.fadeOut(200,function(){removeCallout();});},2000);var currentItem=ItemController.getCurrentItem();IoTModeView.updateChoreoDetails(currentItem);});$callout.off('click','button.cancel').on('click','button.cancel',function(){removeCallout();});}
var log10=Math.log(10);var getSignificantDigitCount=function(n){n=Math.abs(String(n).replace(".",""));if(n==0)return 0;while(n!=0&&n%10==0)n/=10;return Math.floor(Math.log(n)/log10)+1;}
var setTransducerName=function(pinView,transducer,name,id,safe){var $pinView=pinView,pinId=$pinView.data('uid'),pin=PinController.getPin(pinId),$callout=$pinView.parent().find('.callout');$callout.children().hide();$pinSelector.addClass('callout-open');$pinView.removeClass('hover').addClass('callout-open');$callout.append('<div class="content step-name"></div>');var $content=$('.content.step-name',$callout);var checkInputs=function(){$callout.find('p.error').hide();$callout.find('button.save').removeAttr('disabled');if($('input[name=min-bound]').val()!=''&&$('input[name=max-bound]').val()!=''){$('.caution-outer').slideDown();}
$.each($('input:visible:not([name=calibration])',$callout),function(){if($(this).val()==''){$callout.find('button.save').attr('disabled','disabled');return false;}});}
if($('.transducer-header',$callout).length>0){$('.transducer-header',$callout).show();}else{$callout.prepend('<div class="transducer-header">\
	    				<div class="medium">'+transducer.medium+'</div>\
	    				<div class="direction">'+(transducer.direction=='sensor'?'Sensor':'Actuator')+'</div>\
	    			</div>');}
var modeType=transducer.direction=='sensor'?'input':'output';if(transducer.name=='Other'&&pin.supportsMode('digital',modeType)&&pin.supportsMode('analog',modeType)){if(!pin.getSignal()){if(modeType=='input'){pin.setSignal('analog');}else{pin.setSignal('digital');}}
$content.append('<a class="switch signal">\
						<div class="slider '+(pin.isAnalog()?'analog':'digital')+'">\
							<span class="left '+(pin.isAnalog()?'active':'')+'">Analog</span>\
							<span class="right '+(pin.isDigital()?'active':'')+'">Digital</span>\
						</div>\
					</a>');$callout.off('click','.switch.signal').on('click','.switch.signal',function(e){var clicked=$(this);if(!clicked.hasClass('sliding')){clicked.addClass('sliding');var active=$('span.active',clicked);var width=active.outerWidth();var delta='-='+width;if(active.hasClass('right')){delta='+='+width;}
$('.slider',clicked).animate({left:delta},200,'swing',function(){$('span',clicked).toggleClass('active');clicked.removeClass('sliding');});pin.toggleSignal();if(transducer.direction=='sensor'){if(pin.isDigital()){$('.safe-type').text('state');if($('.safe-container').is(':visible')){$('.safe-container.analog').hide();$('.safe-container.digital').show();}}else{$('.safe-type').text('bounds');if($('.safe-container').is(':visible')){$('.safe-container.digital').hide();$('.safe-container.analog').show();$('.safe-container.analog input[name=min-bound]').focus();}}
checkInputs();}}});}else if(transducer.signal=='onewire'){$content.append('<span class="button xsmall white signal digital-only">Digital</span>');pin.setSignal('onewire');}else if(transducer.signal=='digital'||(pin.supportsMode('digital',modeType)&&!pin.supportsMode('analog',modeType))){$content.append('<span class="button xsmall white signal digital-only">Digital</span>');pin.setSignal('digital');}else if(transducer.signal=='analog'||(pin.supportsMode('analog',modeType)&&!pin.supportsMode('digital',modeType))){$content.append('<span class="button xsmall white signal analog-only">Analog</span>');pin.setSignal('analog');}
$content.append('<input type="text" name="transducer-name" placeholder="'+(transducer.direction=='sensor'?'Your Sensor Name':'Your Actuator Name')+'" maxlength="32"></input>');if(name){$('input[name=transducer-name]',$callout).val(name);}
if(transducer.direction=='sensor'){var analogUnits;var analogUnit;var unitHigh;var unitLow;var scaleHigh;var scaleLow;var calibration;var library;if(transducer.analog_units){analogUnits=JSON.parse(transducer.analog_units);}else{if(transducer.name=='Any 4-20 mA'){analogUnits=[''];}else{analogUnits=['V'];}}
if(transducer.analog_unit){analogUnit=transducer.analog_unit;}else{if(transducer.name=='Any 4-20 mA'){analogUnit='';}else{analogUnit='V';}}
if(transducer.unit_high){unitHigh=transducer.unit_high;}else{unitHigh='High';}
if(transducer.unit_low){unitLow=transducer.unit_low;}else{unitLow='Low';}
if(transducer.scale_high){scaleHigh=transducer.scale_high;}else{scaleHigh=null;}
if(transducer.scale_low){scaleLow=transducer.scale_low;}else{scaleLow=null;}
if(transducer.calibration){calibration=transducer.calibration;}else{calibration=null;}
if(transducer.library){library=transducer.library;}else{library=null;}
if(CLOUD_CONTROLS_ACCESS&&DeviceController.deviceHasTransducers()){var unitSwitchLeft=true;if(transducer.analog_unit&&analogUnits&&(transducer.analog_unit==analogUnits[1])){unitSwitchLeft=false;}
$content.append('<a class="switch unit-selector">\
								<div class="slider '+(unitSwitchLeft?'first':'second')+'">\
									<span class="left '+(unitSwitchLeft?'active':'')+'"></span>\
									<span class="right '+(unitSwitchLeft?'':'active')+'"></span>\
								</div>\
							</a>');if(analogUnits.length==2){$('#pin-selector .board .pins .callout input[name=transducer-name]').addClass('with-unit');$('#pin-selector .board .pins .callout .switch.unit-selector .left').text(analogUnits[0]);$('#pin-selector .board .pins .callout .switch.unit-selector .right').text(analogUnits[1]);$('#pin-selector .board .pins .callout .switch.unit-selector').css('display','inline-block');$callout.off('click','.switch.unit-selector').on('click','.switch.unit-selector',function(e){var clicked=$(this);if(!clicked.hasClass('sliding')){clicked.addClass('sliding');var active=$('span.active',clicked);var width=active.outerWidth();var delta='-='+width;if(active.hasClass('right')){delta='+='+width;}
$('.slider',clicked).animate({left:delta},200,'swing',function(){$('span',clicked).toggleClass('active');clicked.removeClass('sliding');});$('#pin-selector .board .pins .callout .unit').text($('span:not(.active)',clicked).text());}});}else{$('#pin-selector .board .pins .callout input[name=transducer-name]').removeClass('with-unit');$('#pin-selector .board .pins .callout .switch.unit-selector .left').text('');$('#pin-selector .board .pins .callout .switch.unit-selector .right').text('');$('#pin-selector .board .pins .callout .switch.unit-selector').hide();}
if(transducer.name=='Any 4-20 mA'){$content.append('<div class="sensor-range">\
								<div class="sensor-range-label">Specify sensor range</div>\
								<input class="scale" name="scale-low" placeholder="lower" value="'+(scaleLow?scaleLow:'')+'"></input>\
								<span class="dash">-</span> \
								<input class="scale" name="scale-high" placeholder="upper" value="'+(scaleHigh?scaleHigh:'')+'"></input>\
							</div>');if(transducer.medium=='Other'){$content.append('<div class="specify-unit">\
									<div class="specify-unit-label">Specify units</div>\
									<input class="specified-units" name="specified-units" placeholder="units" value="'+(analogUnit?analogUnit:'')+'" maxlength="32"></input>\
								</div>');$callout.on('cut keyup paste','input[name=specified-units]',function(event){$('.unit',$callout).text($(this).val());});}}else if(transducer.name=='DS18B20'&&FEATURE_CALIBRATION){$content.append('<div class="calibration-container">\
								<div class="calibration-label">Calibrate sensor</div>\
								<input class="calibration" name="calibration" placeholder="0.000" value="'+(calibration?calibration:'')+'"></input>\
								<span class="unit">'+(unitSwitchLeft?analogUnits[0]:analogUnits[1])+'</span>\
							</div>');}
if(DeviceController.deviceHasCloudControls()){var safeSwitchLeft=true;if(safe&&safe.state==false){safeSwitchLeft=false;}
$content.append('<div class="toggle-label safe-label open"><button class="safe" tabindex="-1"></button>Graph safe\
 								<span class="safe-type">'+(pin.isDigital()?'state':'bounds')+'</span></div>\
 							<div class="safe-container analog">\
 								<div class="bounds">\
 									<input class="bound" name="min-bound" placeholder="min"></input>\
 									<span class="dash">-</span> \
 									<input class="bound" name="max-bound" placeholder="max"></input>\
 									<span class="unit">'+(unitSwitchLeft?analogUnits[0]:analogUnits[1])+'</span>\
 								</div>\
 								<div class="caution-outer">\
 									<div class="toggle-label caution-label closed"><button class="caution" tabindex="-1"></button>Graph caution bounds</div>\
 									<div class="bounds caution-container">\
 										<span class="plus-minus">+ / -</span>\
 										<input class="bound" name="caution-bound" placeholder="outside bound"></input>\
 										<span class="unit">'+(unitSwitchLeft?analogUnits[0]:analogUnits[1])+'</span>\
 									</div>\
 								</div>\
 							</div>\
 							<div class="safe-container digital">\
 								Sensor should read\
 								<a class="switch digital-value">\
 									<div class="slider '+(safeSwitchLeft?'high':'low')+'">\
 										<span class="left '+(safeSwitchLeft?'active':'')+'">'+unitHigh+'</span>\
 										<span class="right '+(safeSwitchLeft?'':'active')+'">'+unitLow+'</span>\
 									</div>\
 								</a>\
 							</div>');if(pin.isDigital()){if(!name||safe){$('.safe-container.digital').show();}}else{if(!name||safe){$('.safe-container.analog').show();}}
if(safe){$('.safe-label').removeClass('closed').addClass('open');if(pin.isDigital()){$('.safe-container.digital').show();}else{$('.safe-container.analog').show();$('input[name=min-bound]',$callout).val(safe.min);$('input[name=max-bound]',$callout).val(safe.max);if(safe.caution){$('.caution-container').show();$('.caution-label').removeClass('closed').addClass('open');$('input[name=caution-bound]',$callout).val(safe.caution);}}}
$callout.off('click','.safe-label').on('click','.safe-label',function(){if($('.safe-container').is(':visible')){$('.safe-container').hide();$(this).removeClass('open').addClass('closed');}else{if(pin.isDigital()){$('.safe-container.digital').show();}else{$('.safe-container.analog').show();$('.safe-container.analog input[name=min-bound]').focus();}
$(this).removeClass('closed').addClass('open');}
checkInputs();});$callout.off('click','.caution-label').on('click','.caution-label',function(){if($('.caution-container').is(':visible')){$('.caution-container').hide();$(this).removeClass('open').addClass('closed');}else{$('.caution-container').show();$(this).removeClass('closed').addClass('open');}
checkInputs();});}}
$callout.off('click','.switch.digital-value').on('click','.switch.digital-value',function(e){var clicked=$(this);if(!clicked.hasClass('sliding')){clicked.addClass('sliding');var active=$('span.active',clicked);var width=active.outerWidth();var delta='-='+width;if(active.hasClass('right')){delta='+='+width;}
$('.slider',clicked).animate({left:delta},200,'swing',function(){$('span',clicked).toggleClass('active');clicked.removeClass('sliding');});}});}
if(!(window.navigator.userAgent.indexOf('MSIE ')>-1||window.navigator.userAgent.indexOf('Trident/')>-1)){$callout.find('input[name=transducer-name]').focus();}
$content.append('<p class="error"></p>');$content.append('<div class="buttons">\
					<button class="button small white cancel">Cancel</button>\
					<button class="button small save">Save</button>\
				</div>');$callout.find('button.save').attr('disabled','disabled');checkInputs();$callout.on('cut keyup paste','input:visible',function(event){checkInputs();if(event.type=='keyup'&&event.which==13){$callout.find('button.save').click();}});$callout.off('click','.buttons button').on('click','.buttons button',function(event){if($(this).hasClass('save')){var transducerName=$('input[name=transducer-name]',$callout).val();var transducerId=transducerName;if(!isNaN(parseInt(transducerId[0]))){transducerId='_'+transducerId;}
transducerId=transducerId.replace(/[^a-zA-Z0-9_\s]/g,'');transducerId=transducerId.replace(/\s+/g,'_');transducerId=transducerId.toLowerCase();if(transducerName.length>32){$('p.error',$callout).text('Name must be under 32 characters.').show();return;}
var pins=PinController.getPins();for(var pinId in pins){var thisPin=pins[pinId];if(transducerId==thisPin.getPinId()&&pin.getLabel()!=thisPin.getLabel()){$('p.error',$callout).text('ID is already in use.').show();return;}}
if(transducer.direction=='sensor'&&$('input[name=calibration]').length>0&&$('input[name=calibration]').val()!=''){if(!$.isNumeric($('input[name=calibration]').val())){$('p.error',$callout).text('Your calibration value must be a number.').show();return;}
if(getSignificantDigitCount($('input[name=calibration]').val())>4){$('p.error',$callout).text('Calibration values can contain at most 4 digits.').show();return;}}
if(transducer.direction=='sensor'&&$('.safe-container.analog').is(':visible')){var notNumber=false;$.each($('.bounds input:visible',$callout),function(){if(!$.isNumeric(($(this)).val())){notNumber=true;return false;}});if(notNumber){$('p.error',$callout).text('Bounds must be numbers.').show();return;}
if(parseFloat($('input[name=max-bound]').val())-parseFloat($('input[name=min-bound]').val())<0){$('p.error',$callout).text('Min bound must be less than or equal to max bound.').show();return;}}
$('p.error',$callout).hide();$('<div class="status-alert success"></div>').append($('<p>').text((transducer.direction=='sensor'?'Sensor':'Actuator')+(name?' edited':' added')+' on Pin '+pin.getLabel())).appendTo('body').fadeIn(200).delay(4000).fadeOut(200,function(){$(this).remove();});if(!pinView.hasClass('transducer')){pinView.addClass('transducer');}
var safe=null;var scaleHigh=null;var scaleLow=null;if(transducer.direction=='sensor'){if($('.sensor-range',$callout).length>0){scaleLow=parseFloat($('.sensor-range input[name=scale-low]',$callout).val());scaleHigh=parseFloat($('.sensor-range input[name=scale-high]',$callout).val());}
if($('.calibration-container',$callout).length>0){calibration=parseFloat($('.calibration-container input[name=calibration]',$callout).val());}
if($('.safe-container',$callout).is(':visible')){if(pin.isDigital()){safe={'state':$('.switch.digital-value .slider span.left',$callout).hasClass('active')}}else{safe={'min':parseFloat($('input[name=min-bound]',$callout).val()),'max':parseFloat($('input[name=max-bound]',$callout).val())}
if($('input[name=caution-bound]',$callout).val()!=''){safe['caution']=parseFloat($('input[name=caution-bound]',$callout).val());}}}}
if(analogUnits&&analogUnits.length==1){analogUnit=analogUnits[0];}else{analogUnit=$('#pin-selector .board .pins .callout .switch.unit-selector .slider span.active').text();}
if(transducer.name=='Any 4-20 mA'){analogUnits=[analogUnit];}
pin.addTransducer({direction:transducer.direction,name:transducerName,id:transducerId,medium:transducer.medium,model:transducer.name,manufacturer:transducer.manufacturer,safe:safe,analogUnit:analogUnit,analogUnits:JSON.stringify(analogUnits),unitHigh:unitHigh,unitLow:unitLow,scaleLow:scaleLow,scaleHigh:scaleHigh,calibration:calibration,library:transducer.library});if(transducer.direction=='sensor'){$('.trigger a.selectBox.sensor-selector').show();IoTModeView.updateSensorSelector();if($('#sensor-selector').val()==pin.getLabel()){TriggerView.setTriggerSignal('input',pin.getSignal());}
var payload={'boardType':IoTModeController.getDeviceType(),'sensorType':transducer.medium,'name':transducerName}
_gaq.push(['_trackEvent',"Cloud Controls","Sensor Added",JSON.stringify(payload)]);}else{$('.trigger a.selectBox.actuator-selector').show();IoTModeView.updateActuatorSelector();if($('#actuator-selector').val()==pin.getLabel()){TriggerView.setTriggerSignal('output',pin.getSignal());}
var payload={'boardType':IoTModeController.getDeviceType(),'sensorType':transducer.medium,'name':transducerName}
_gaq.push(['_trackEvent',"Cloud Controls","Actuator Added",JSON.stringify(payload)]);}
$callout.children().hide();$callout.append('<div class="content step-menu"></div>');editTransducer(pinView);calloutCloseTimeout=setTimeout(function(){$callout.fadeOut(200,function(){removeCallout();});},2000);var currentItem=ItemController.getCurrentItem();IoTModeView.updateChoreoDetails(currentItem);}else{removeCallout();}
SnippetController.loadUserSnippet();});$(document).off('click',clickOutsideCallout).on('click',{container:$pinView.parent()},clickOutsideCallout);}
var clickMenu=function(pinView){$callout=pinView.parent().find('.callout');if($('.menu',$callout).length==1){if($('.menu',$callout).hasClass('off')){$pinSelector.addClass('callout-open');pinView.addClass('callout-open');}else{$('.menu',$callout).click();}}else if($('.menu',$callout).length>1){$pinSelector.addClass('callout-open');pinView.addClass('callout-open');}};var removeCallout=function(){$pinSelector.find('.callout-container').remove();$pinSelector.removeClass('callout-open');$pinSelector.find('.pin.callout-open').removeClass('callout-open');$pinSelector.find('.pin.hover').removeClass('hover');$('.trigger .pin.hover').removeClass('hover');};return{init:function(){self=PinboardController;$board.off('click','**');$board.off('mouseenter').off('mouseleave').on({mouseenter:function(){if(!$pinSelector.hasClass('selectable')){return;}
var $pinView=$(this).find('.pin'),pinId=$pinView.data('uid'),pin=PinController.getPin(pinId);if($pinView.hasClass('selected')){selectedPins[pinId].hover();}
if(!$pinView.hasClass('disabled')&&!$pinSelector.hasClass('callout-open')&&!IoTModeController.gatewayEnabled()){addCallout($(this));if($('.callout .menu',$pinView.parent()).length==1){$('.callout .menu',$pinView.parent()).addClass('hover');}
$pinView.addClass('hover');}},mouseleave:function(){if(!$pinSelector.hasClass('selectable')){return;}
var $pinView=$(this).find('.pin'),pinId=$pinView.data('uid'),pin=PinController.getPin(pinId);if($pinView.hasClass('selected')){selectedPins[pinId].hover(false);}
if(!$pinView.hasClass('disabled')&&!$pinSelector.hasClass('callout-open')){removeCallout();}}},'.pin-container');$(PinController).unbind('boardloaded.pinboardcontroller').bind('boardloaded.pinboardcontroller',function(e,data){var events='select.pinboardcontroller deselect.pinboardcontroller';$.each(data.pinModels,function(i,pin){$(pin).unbind(events).bind(events,pinSelectHandler);});PinboardView.init(data.boardModel,data.pinModels,IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'?GatewayController.getSelectedProperty('device'):IoTModeController.getDevice(),IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'?GatewayController.getEdgeShield():IoTModeController.getShield());});}}}();var PinboardView=function(){var $pinSelector=$('#pin-selector'),$pinBoard=$pinSelector.find('.board');var renderPin=function(pinModel){$pinContainer=$('<li class="pin-container" />');$pin=$('<div />').addClass('pin').addClass('pin-'+pinModel.getId()).attr('data-uid',pinModel.getId());if(pinModel.getLabel()){$pin.html(pinModel.getLabel())}else{$pin.addClass('disabled');}
if(pinModel==PinController.getDefaultPin('input')){$pin.addClass('default-input');}
$pinContainer.append($pin);return $pinContainer;};var renderPinBank=function(bank){return $('<ul />').attr('class','pins bank-'+bank).attr('data-bank',bank);};var initPins=function(pins){var bank,colPins,pinModel,pinNum,pin,$pinList;$pinBoard.empty();$.each(pins,function(id,pinModel){if(bank!=pinModel.getBank()){bank&&$pinBoard.append($pinList);bank=pinModel.getBank();$pinList=renderPinBank(bank);}
$pinList.append(renderPin(pinModel));});$pinBoard.append($pinList);};return{getPinView:function(pin){return $('#pin-selector .pin-'+pin.getId());},renderPinCallout:function(){var callout='<div class="callout-container">\
						<div class="hover-container">\
			        		<div class="callout"></div>\
	        			</div>\
	        			<div class="head-callout left">\
	                        <div class="arrow-callout line-left-down"></div>\
	                        <div class="arrow-callout line-left-up"></div>\
	                        <div class="arrow-bg"></div>\
                        </div>\
                    </div>';return callout;},init:function(boardModel,pins,device,shield){Temboo.log('PinboardView','Initializing '+device+', '+shield);if(boardModel.brand=='Arduino'){$pinSelector.attr('rel','arduino');}else if(boardModel.brand=='TI'){$pinSelector.attr('rel',shield.toLowerCase().replace(/_/g,'-'));}else if(boardModel.brand==BoardModel.Samsung.brand){if(boardModel.family==BoardModel.Samsung.Artik.family){switch(boardModel.device){case BoardModel.Samsung.Artik.Ten.device:$pinSelector.attr('rel','samsung-artik-ten');break;}}}else{$pinSelector.attr('rel','default');}
initPins(pins);}}}();var TransducerController=function(){var sensors=[];var actuators=[];var TRANSDUCERS,SENSORS,ACTUATORS,DEVICE_TYPE,DEVICE_TYPE_TRANSDUCER;var getDeviceTypeId=function(name){var id=false;$.each(DEVICE_TYPE,function(k,v){if(v.name==name){id=v.id;}});return id;};var getTransducerId=function(model,medium){var id=false;$.each(TRANSDUCERS,function(k,v){if(v.name==model&&v.medium==medium){id=v.id;}});return id;};return{init:function(transducers,deviceType,deviceTypeTransducer){TRANSDUCERS=transducers;SENSORS=TransducerController.getTransducerMediums('sensor');ACTUATORS=TransducerController.getTransducerMediums('actuator');DEVICE_TYPE=deviceType;DEVICE_TYPE_TRANSDUCER=deviceTypeTransducer;},getTransducerMediums:function(direction){if(!direction||(direction!='sensor'&&direction!='actuator')){return false;}
var keys=[];var mediums=[];$.each(TRANSDUCERS,function(k,v){if(v.direction==direction&&!keys[v.medium]){mediums.push(v.medium);keys[v.medium]=true;}});for(var i=0;i<mediums.length;i++){if(mediums[i]=='Other'){mediums.splice(i,1);}}
mediums.push('Other');return mediums;},getTransducersByMedium:function(medium,direction,signal){var transducers=[];if(!medium||!direction||(direction!='sensor'&&direction!='actuator')){return transducers;}
$.each(TRANSDUCERS,function(k,v){if(v.direction==direction&&v.medium==medium&&((!signal||v.signal==signal)||(signal=='digital'&&v.signal=='onewire'))){transducers.push(v);}});return transducers;},getTransducers:function(){return TRANSDUCERS;},getSensors:function(){return SENSORS;},getActuators:function(){return ACTUATORS;},getDeviceVoltageAndResolution:function(deviceType){var voltage=false;var resolution=false;$.each(DEVICE_TYPE,function(k,v){if(v.name==deviceType){voltage=v.voltage;resolution=v.resolution;}});return{'voltage':voltage,'resolution':resolution};},getRawValues:function(deviceType,model,medium){var deviceTypeId=getDeviceTypeId(deviceType);var transducerId=getTransducerId(model,medium);var raw_low=false;var raw_high=false;$.each(DEVICE_TYPE_TRANSDUCER,function(k,v){if(v.device_type_id==deviceTypeId&&v.transducer_id==transducerId){raw_low=v.raw_low;raw_high=v.raw_high;}});return{'raw_low':raw_low,'raw_high':raw_high};}}}();var TitleHelper=function(item){if(item.pageTitle&&item.pageTitle.length>0){return item.pageTitle;}
var uri=item.uri;var titleElements=uri.split('/');titleElements.pop();var title=titleElements.join(' - ')+' API :: Temboo';return title;};var HistoryController=function(){var isInternalPush=false;var isInternalLoad=false;return{init:function(){var originalHtml=ItemsView.html();$(ItemController).bind('itemloaded',function(event,item,previousItem){if(previousItem&&previousItem.uri&&item.uri==previousItem.uri){return true;}
if(isInternalLoad){document.title=TitleHelper(item);$('body').attr('id',item.pageId);isInternalLoad=false;return true;}
isInternalPush=true;window.History.pushState({treeState:TreeController.getState(),filterInputState:TreeController.getFilterInputs()},null,baseUrl+item.uri);document.title=TitleHelper(item);$('body').attr('id',item.pageId);$("meta[name='description']").attr("content","");if($(window).scrollTop()>$('#header').outerHeight()){window.scrollTo(0,0);}});$(SearchModel).bind('searchresult',function(event,result){if(isInternalLoad){document.title="Search: "+result.query+" :: Temboo";$('body').attr('id','page-library-search');isInternalLoad=false;return true;}
isInternalPush=true;window.History.pushState({treeState:TreeController.getState(),filterInputState:TreeController.getFilterInputs()},null,baseUrl+'?q='+result.query);document.title="Search: "+result.query+" :: Temboo";$('body').attr('id','page-library-search');});$(window).bind('statechange',function(event){if(isInternalPush){isInternalPush=false;return true;}
var state=window.History.getState();TreeController.setState(state.data.treeState);TreeController.setFilterInputs(state.data.filterInputState);var uri=state.url.replace(/^https?:\/\/[^\/]*/,'').replace(baseUrl,'');var search=uri.match(/\?q=(.+)/);if(search!=null){isInternalLoad=true;SearchController.doQuery(search[1]);}else if(uri){isInternalLoad=true;if(IoTModeController.getGateway()){GatewayController.removeTabs();}
if(ItemModel.isCached(uri)){ItemsView.loading(true);}
ItemController.loadItem(uri);SearchController.clearForm();}else{ItemsView.loading(true);$('body').attr('id','page-library-index');if(state.data.originalHtml){ItemsView.update(state.data.originalHtml,false,baseUrl);}else{ItemsView.update(originalHtml,false,baseUrl);}
SearchController.clearForm();$(HistoryController).trigger('indexloaded');}
if(IoTModeController.getGateway()){$('.library-view .tree').removeClass('gateway-select-choreo');GatewayView.fadeIn();}});},loadInitItem:function(data){var initUri=window.location.href.toString().replace(/^https?:\/\/[^\/]*/,'').replace(baseUrl,'').replace(/[&?]_suid=[^&]*/,'')
initSearch=initUri.match(/[&?]q=([^&]+)/);initUri=initUri.replace(/[#&?]/g,'');var firstState='';if(initSearch!=null){isInternalLoad=true;SearchController.doQuery(decodeURIComponent(initSearch[1]));firstState=initSearch[0];}
else if(initUri){firstState=initUri;if(window.History.emulated.pushState||preHistoryUrl.indexOf('#')>-1){isInternalLoad=true;ItemController.loadItem(initUri);}
else{if(!data.item){data.item={};}
data.item.html=$('.details-view .item-view').html();data.item.pageTitle=document.title;data.item.pageId=$('body').attr('id');isInternalLoad=true;ItemController.loadItem(initUri,null,data.item);}}
isInternalPush=true;window.History.replaceState({treeState:TreeController.getState(),filterInputState:TreeController.getFilterInputs(),originalHtml:ItemsView.html()},null,baseUrl+firstState);},checkHtml4Redirect:function(){if(window.History.emulated.pushState){var initUri=window.location.href.toString().replace(/^https?:\/\/[^\/]*/,'').replace(baseUrl,'').replace(/[&?]_suid=[^&]*/,'');if(initUri&&initUri.indexOf('#')==-1){window.location.href=baseUrl+'#'+initUri;return true;}}}}}();var ItemController=function(){var currentItem,initialized,previousItem;return{flushCurrentItem:function(){if(typeof currentItem!=='undefined')
ItemModel.flush(currentItem.uri);},flushAllItems:function(){ItemModel.flushAll();},getLoggedIn:function(){return LOGGED_IN;},getCurrentItem:function(){return currentItem;},getCurrentPath:function(){return currentItem.uri.replace(/(^\/)|(\/$)/,'').split('/');},getPreviousItem:function(){return previousItem;},getRootBundle:function(){return ItemController.getCurrentPath()[1];},getInputs:function(filledOnly){var $inputs=$('.details-view .item-view .run-mode-form').find('input.run-mode-component, textarea.run-mode-component');return filledOnly?$inputs.filter(function(){return $(this).val()!='';}):$inputs;},getCredentialInputs:function(filledOnly){var $inputs=$('.details-view .item-view .run-mode-form .meta-item.credential').find('input.run-mode-component, textarea.run-mode-component');return filledOnly?$inputs.filter(function(){return $(this).val()!='';}):$inputs;},getNonCredentialInputs:function(filledOnly){var $inputs=$('.details-view .item-view .run-mode-form .meta-item').not('.credential').find('input.run-mode-component, textarea.run-mode-component');return filledOnly?$inputs.filter(function(){return $(this).val()!='';}):$inputs;},getSensorInputNames:function(){var inputs,val;var inputNames={};if(IoTModeController.sensorInputsEnabled()){ItemController.getNonCredentialInputs(true).each(function(){val=$.trim($(this).val());var re=/<<\{(\w+)\}>>/g;var reMatchArray;var pinName;while((reMatchArray=re.exec(val))!==null){pinName=reMatchArray[1];var pin=PinController.getPinByPinId(pinName);if(pin&&pin.isSensor()){inputNames[$(this).attr('name')]=true;}}});}
return inputNames;},getSensorInputs:function(deviceType){if(!IoTModeController.sensorInputsEnabled())return null;var inputs,val;ItemController.getNonCredentialInputs(true).each(function(){val=$.trim($(this).val());if(val){inputs||(inputs={});inputs[$(this).attr('name')]=val;}});var sensorTags={};var inputNames={};var device=IoTModeController.getDevice();for(var key in inputs){var re=/<<\{(\w+)\}>>/g;var reMatchArray;var value=inputs[key];var pinName;while((reMatchArray=re.exec(value))!==null){pinName=reMatchArray[1];var pin=PinController.getPinByPinId(pinName);if(pin&&pin.isSensor()){sensorTags[pinName]=true;inputNames[key]=true;}}}
if(Object.keys(inputNames).length==0)return null;var sensorInputs={};sensorInputs.inputs=[];for(var key in inputNames){var input={};input.name=key;input.value=inputs[key];sensorInputs.inputs.push(input);}
sensorInputs.pinValues=[];var hasAnalogInputs=false;for(var pinName in sensorTags){var pin=PinController.getPinByPinId(pinName);if(pin&&pin.isSensor()){var sensorPin={};sensorPin.pinName=pinName;sensorPin.pinNumber=pin.getLabel();sensorPin.analog=pin.isAnalog();if(DeviceController.deviceHasTransducers()){var calibration=pin.getCalibration();if(calibration!=null&&!isNaN(calibration)){sensorPin.calibration=calibration;}
if(pin.getLibrary()!=null){sensorPin.type=pin.getLibrary();}}
if(pin.isAnalog()||pin.isOnewire()){if(pin.getScaleLow()!=null&&pin.getScaleHigh()!=null){sensorPin.userDefinedScale=true;if(deviceType!=null){sensorPin.scaleLow=pin.getScaleLow();sensorPin.scaleHigh=pin.getScaleHigh();var rawValues=TransducerController.getRawValues(deviceType,pin.getModel(),pin.getMedium());sensorPin.rawHigh=parseFloat(rawValues.raw_high);sensorPin.rawLow=parseFloat(rawValues.raw_low);}}else{var model=pin.getModel();if(model&&model!="Other"){model=model.replace(/ |-/g,"");unit=pin.getAnalogUnit();if(unit){sensorPin.conversion=model+"_to_"+unit;}else{sensorPin.conversion="Volts";}}else{sensorPin.conversion="Volts";}}
if(pin.isAnalog()){hasAnalogInputs=true;}}else{sensorPin.conversion="Transducer";}
sensorInputs.pinValues.push(sensorPin);}}
sensorInputs.analogInputs=hasAnalogInputs;return sensorInputs;},getInputValues:function(){var inputs,val;ItemController.getInputs().each(function(){val=$.trim($(this).val());if(val){inputs||(inputs={});inputs[$(this).attr('name')]=val;}});return inputs;},init:function(){if(!initialized){var self=this;if(typeof ItemModel==='undefined')
throw'Exception: ItemModel is not defined';$(ItemsView).bind('itemsloading',function(event){previousItem=currentItem;currentItem=false;});$(ItemModel).add(KeywordModel).bind('itemloaded',function(event,item){currentItem=item;$(self).trigger('itemloaded',[item,previousItem]);});$(FilterController).bind('itemloaded',function(event,item){Temboo.log('ItemController.init','Item loaded');var listHtml=item.model&&item.model.children&&item.model.children.length&&item.viewType=='list'?ItemsListView.buildList(item.model):undefined;ItemsView.update(item.html,listHtml,item.uri);});$(document).off('click','.details-view .item-view .meta-class:not(.snippet) .meta-class-name').on('click','.details-view .item-view .meta-class:not(.snippet) .meta-class-name',function(){var elem=$(this).siblings('.meta-class-content'),parent=$(this).parent(),callback=function(){$(parent).toggleClass(Classes.collapsed);$(ItemsView).trigger('heightchanged');};if(parent.hasClass('inputs')&&parent.hasClass('required')){return true;}
if(parent.hasClass(Classes.collapsed)){elem.slideDown(ANIMATION_MILLIS);elem.fadeIn(ANIMATION_MILLIS);}
else{elem.slideUp(ANIMATION_MILLIS);elem.fadeOut(ANIMATION_MILLIS);}
window.setTimeout(callback,ANIMATION_MILLIS);});if(CLOUD_CONTROLS_ACCESS){var clickOutsideDropdown=function(){$downloadDropdown.hide();$(document).off('click',clickOutsideDropdown);};$(document).off('click','.details-view .item-view .meta-class.snippet.main .meta-class-name').on('click','.details-view .item-view .meta-class.snippet.main .meta-class-name',function(){$downloadDropdown=$('.details-view .item-view .meta-class.snippet .download-dropdown');if(!$downloadDropdown.is(':visible')){$downloadDropdown.show();$(document).off('click',clickOutsideDropdown).on('click',clickOutsideDropdown);}});$(document).off('click','.details-view .item-view .meta-class.snippet .download-dropdown li').on('click','.details-view .item-view .meta-class.snippet .download-dropdown li',function(){if(!$(this).hasClass('selected')){$('.details-view .item-view .meta-class.snippet .download-dropdown li.selected').removeClass('selected');$(this).addClass('selected');if($(this).attr('rel')=='editable'){$('.details-view .item-view .meta-class.snippet.main').removeClass('compiled');}else if($(this).attr('rel')=='compiled'){$('.details-view .item-view .meta-class.snippet.main').addClass('compiled');Temboo.trackEvent("Library","Selected compiled code");}}});}
initialized=true;$(Temboo).trigger('initialized.ItemController');}},loadItem:function(uri,idUri,item,loadTab){$(ItemController).trigger('beforeunload',[currentItem]);var model=uri.match(/^keyword\//)?KeywordModel:ItemModel;if(!model.loadItem(uri,idUri,item)){ItemsView.loading(true,loadTab);}}}}();$(Temboo).trigger('ready.ItemController');var KeywordModel=function(){var cache={};var cacheKeyword=function(uri,html,name,pageTitle,pageId){var keyword=cache[uri]={html:html,pageTitle:pageTitle,pageId:pageId,model:{name:name,type:'keyword'},uri:uri}
return keyword;}
var loadFromCache=function(uri){var keyword=cache[uri];return(typeof keyword==='undefined')?false:keyword;}
return{loadItem:function(uri,idUri,item){Temboo.log('KeywordModel.loadItem','Loading keyword page: '+uri);var cached=loadFromCache(uri),self=this;if(cached){$(self).trigger('itemloaded',cached);}else if(typeof item==='object'){if(uri=='keyword/'){item.name='';}else{item.name=uri.split('/');item.name=item.name[item.name.length-2];}
item=cacheKeyword(uri,item.html,item.name,item.pageTitle,item.pageId);cached=true;$(self).trigger('itemloaded',item);}
else{$.getJSON(baseUrl+uri,function(response){var item=cacheKeyword(uri,response.html,response.name,response.pageTitle,response.pageId);$(self).trigger('itemloaded',item);});}
return cached!==false;}}}();var ItemModel=function(){var items={};var buildAndCacheItem=function(uri,model,response){items[uri]={html:response.html,pageTitle:response.pageTitle,pageId:response.pageId,model:model,uri:uri,isChoreo:function(){return model.type=='choreo';}}
response.credentials&&(items[uri].credentials=response.credentials);response.viewType&&(items[uri].viewType=response.viewType);response.deviceNetworkCredentials&&(items[uri].deviceNetworkCredentials=response.deviceNetworkCredentials);response.gatewayCredentials&&(items[uri].gatewayCredentials=response.gatewayCredentials);response.profiles&&(items[uri].profiles=response.profiles);return items[uri];}
return{flush:function(standardUri){delete items[standardUri];Temboo.log('ItemModel.flush','Removed item from cache: '+standardUri);},flushAll:function(){items={};Temboo.log('ItemModel.flushAll','Removed all items from cache');},loadItem:function(standardUri,idUri,item){var item,cached=false,self=this;if(typeof items[standardUri]==='object'){cached=true;item=items[standardUri];Temboo.log('ItemModel.loadItem','Loaded from cache: '+item.uri);$(self).trigger('itemloaded',item);}
else{var model=LibraryModel.get(standardUri);if(item&&item.html){item=buildAndCacheItem(standardUri,model,item);window.setTimeout(function(){$(self).trigger('itemloaded',item);},1);}
else{uri=idUri?idUri+'/':standardUri;$.getJSON(baseUrl+uri,function(response){item=buildAndCacheItem(standardUri,model,response);response.snippets&&SnippetController.setSnippets(response.snippets);$(self).trigger('itemloaded',item);});}}
return cached;},isCached:function(uri){if(items[uri]){return true;}
return false;}}}();var ItemsListView=function(){var listItems;return{buildList:function(itemModel){var item,itemUri,items=itemModel.children,listType=itemModel.type=='folder'?'Bundles':'Choreos',parentList=$('<ul />').addClass('metadata').append($('<li />').addClass('meta-class').append($('<span />').addClass('meta-class-name subtitle').html(listType)).append($('<div />').addClass('meta-class-content').append($('<ul />').addClass('meta-items'))));var list=parentList.find('.meta-items');Temboo.log('ItemView.buildChildren',"Building...");var byName=[];for(var i in items){item=LibraryModel.get(items[i]);item.itemUri=items[i];byName.push(item);}
byName.sort(function(a,b){var nameA=a.name.toLowerCase(),nameB=b.name.toLowerCase();if(nameA<nameB){return-1;}
if(nameA>nameB){return 1;}
return 0;});for(var i=0,j=byName.length;i<j;i++){item=byName[i];list.append(ItemView.buildSummary(item.itemUri,item.name,item.shortDescription,item.type));}
return parentList.html();}}}();var ItemView=function(){return{buildSummary:function(uri,name,description,type){var parentUri=uri.replace(/^\//,'').replace(/\/$/,'').split('/');parentUri=parentUri.slice(1,parentUri.length-1).join('.<wbr />');if(parentUri.length==0){return'<li class="item-summary'+(type?' '+type:'')+'"><p>'+'<a href="'+baseUrl+uri+'">'+name+'</a>'+'</p><p>'+description+'</p></li>';}
else{return'<li class="item-summary'+(type?' '+type:'')+'"><p>'+'<span class="disabled uri">'+parentUri+'.</span>'+'<a href="'+baseUrl+uri+'">'+name+'</a>'+'</p><p>'+description+'</p></li>';}}}}();var ItemsView=function(){var buttonText={error:'Generate Code',start:'Stop',stop:'Generate Code',success:'Generate Code'};return{self:this,applyCredential:function(credential){var val;for(var name in credential.inputs){val=credential.inputs[name];ItemController.getInputs().filter('[name="'+name+'"]').val(val);}
if(credential.credential){var subCreds=CredentialsModel.credentials();if(subCreds&&subCreds[credential.credential]){for(var name in subCreds[credential.credential].inputs){val=subCreds[credential.credential].inputs[name];ItemController.getInputs().filter('[name="'+name+'"]').val(val);}}}
Temboo.trackEvent("Library","Credential Inserted",CredentialsModel.template()?CredentialsModel.template().name:credential.name);$(ItemsView).trigger('credentialapplied',credential.name);},html:function(){return $('.details-view .item-view').html();},init:function(){},loading:function(isLoading,loadingTab){if(isLoading){if(loadingTab){var tab=GatewayController.getSelectedTab();$tabLink=$('a[rel="'+tab+'"]');if($('.gateway-tab',$tabLink).length==1){$tabElement=$('a[rel="'+tab+'"] .gateway-tab');$tabName=$('.tab-name',$tabElement);}else{$tabElement=$('.gateway-tab.more');$tabName=$('.selectBox-container',$tabElement);}
$tabElement.addClass('loading');$tabName.css('visibility','hidden');$('.gateway-tabs').addClass('no-click');}else{$('.details-view').fadeTo('600',.3);$('#loading-bar').addClass('loading');}
$(this).trigger('itemsloading');}else{if(loadingTab){$(self).trigger('itemsloaded');$('.gateway-tabs').removeClass('no-click');}else{$('#loading-bar').removeClass('loading');$('.details-view').fadeTo('200',1,function(){$(self).trigger('itemsloaded');});}}},update:function(itemHtml,listHtml,uri){Temboo.log('ItemsView.update','Updating...');var html=new Array(),scope='.details-view .item-view';itemHtml&&html.push(itemHtml);listHtml&&html.push(listHtml);html=html.join('<hr />');$(ItemController).trigger('unload',[ItemController.getPreviousItem()]);$(scope).html(html);if($('.fave-button').length){var currItem=ItemController.getCurrentItem();var uri=currItem.uri;$.post('/library/favestatus/',{'uri':uri},function(data){if(data==1){$('.fave-button').removeClass('not-faved');$('.fave-button').addClass('faved');}else{$('.fave-button').removeClass('faved');$('.fave-button').addClass('not-faved');}});}
if($('#library-landing-dashboard').length==0){$(scope+' a').each(function(){var fullhref=$(this).attr('href');if(fullhref){var href=fullhref.replace(/^(https?:)?\/\//,'');if(href!=fullhref){if(null==href.match(/^(?:[\w\-]+\.)?temboo\.com\b/)){$(this).addClass(Classes.externalLink).attr('target','new');}}}});}
$(scope).find('.meta-class.'+Classes.collapsed+' .meta-class-content').hide();if($('.prettyprint').size())
prettyPrint();$(scope).find('pre').copyable();$(this).trigger('itemsrendered',uri);},updateRunMode:function(){var components=$('.run-mode-component'),runModeActive=ChoreoController.runModeIsActive(),func=runModeActive?'addClass':'removeClass';components[func].call(components,Classes.runModeActive);$(this).trigger('heightchanged');},updateRunning:function(isRunning,reason,result,timestamp){var components=$('.run-mode-component'),func=isRunning?'addClass':'removeClass',inputs=ItemController.getInputs();components[func].call(components,Classes.runModeRunning);if(reason=='success'){var output,value;var rootBundle=ItemController.getRootBundle();for(var outputName in result){output=$('.details-view .meta-class.outputs pre.'+outputName);output.html(result[outputName]);if(result[outputName].length>100000){output.removeClass('prettyprint').addClass('uglyprint');}else{output.addClass('prettyprint').removeClass('uglyprint');}
var callout=output.nextAll('.output-callout');if(callout.length>0){callout.hide();var cookieName='dismissed_callout_'+rootBundle+'_'+outputName;var dismissed=$.cookie(cookieName);dismissed=dismissed?parseInt(dismissed,10):0;callout.data('dismissed',dismissed);callout.data('cookie-name',cookieName);if(dismissed<2){$('a.output-value',callout).attr('href',output.text());$('span.output-value',callout).text(output.text());$('span.output-root-bundle',callout).text(rootBundle);callout.addClass('active');}else{callout.removeClass('active');}}}
$('.details-view .meta-class.outputs .output').fadeIn(ANIMATION_MILLIS);$('.details-view .meta-class.outputs .error').fadeOut(ANIMATION_MILLIS);prettyPrint();var activeCallouts=$('.details-view .meta-class.outputs .output-callout.active');activeCallouts.each(function(){var outputBox=$(this).parent().find('pre.output');var lastOutputChild=outputBox.children().last();var childBottom=lastOutputChild.position().top+lastOutputChild.height();var newTop=(childBottom<outputBox.height())?childBottom:outputBox.height();newTop=newTop+18;$(this).css('top',newTop);var that=this;$('button.close',this).unbind('click').click(function(e){e.preventDefault();$(that).fadeOut(400);$.cookie($(that).data('cookieName'),$(that).data('dismissed')+1,{expires:180,path:'/'});});$('a',this).each(function(){var href=$(this).attr('href');if(href.indexOf('../')==0){var path=ItemController.getCurrentPath();path[path.length-1]=href.substring(3);href=baseUrl+path.join('/');$(this).attr('href',href);}});});activeCallouts.fadeIn(600);}
else if(reason=='error'){var error=$('.details-view .meta-class.outputs .error');error.find('.message').html(result);error.fadeIn(ANIMATION_MILLIS);$('.details-view .meta-class.outputs .output').fadeOut(ANIMATION_MILLIS);$(ItemsView).trigger('runError');}
else if(reason=='start'){$('.meta-class.outputs .run-status, .meta-class.outputs .error .message').html('');}
if(reason=='success'||reason=='error'){var status,now=new Date(new Date().getTime()+(userTimezoneOffset*1000)),timestamp=timestamp||$.temboo.pad(now.getUTCHours(),0,2)+':'+$.temboo.pad(now.getUTCMinutes(),0,2);if(reason=='success'){status='Successful run at '+timestamp+' ET';$(ItemsView).trigger('runSuccess',{timestamp:timestamp,result:result});}
else{status='Error at '+timestamp+' ET';}
$('.meta-class.outputs .run-status').html(status);}
$('.details-view .run-mode-trigger').html(buttonText[reason]);if(isRunning){inputs.attr('disabled','disabled');$('.details-view .meta-class.outputs pre.output').html(null);$('.details-view .meta-class.outputs .output-callout').hide();}
else{inputs.removeAttr('disabled');$(ItemsView).trigger('runStopped');}
$(this).trigger('heightchanged');}}}();var LibraryModel=function(){var items={};return{get:function(uri){return(items[uri]);},init:function(tree){this.setData(tree);$(this).trigger('libraryinitialized');},setData:function(tree){var children=new Array();if(tree.keywords!==null){tree.keywords=tree.keywords.split(',');for(var i in tree.keywords){$('.library-view .tree a[href="'+baseUrl+tree.uri+'"]').parents('li:first').addClass('keyword-'+tree.keywords[i]);}}
items[tree.uri]=tree;delete items[tree.uri].uri;for(var id in tree.children){children.push(tree.children[id].uri);this.setData(tree.children[id]);}
tree.children=children;}};}();var DocPanelController=function(){var $docPanelList=$('#doc-panel .steps ol');var positionPanel=function(){var windowWidth=$(window).width();var pageWidth=$('body').width();if(windowWidth<pageWidth){$('#doc-panel').css('right',windowWidth-pageWidth);}else{$('#doc-panel').css('right',0);}}
return{init:function(ftuxCallouts,ftuxChoreo,docPanelChoreos){var callouts=JSON.parse(ftuxCallouts);var choreos=JSON.parse(docPanelChoreos);$('#doc-panel button.slidein').click(function(event){event.preventDefault();var item=ItemController.getCurrentItem();var uri=item.uri;uri=uri.replace('Library/','');uri=uri.slice(0,-1);if($('#doc-panel').hasClass('active')){if($('li.step:visible').hasClass('selected')||$('li.step:visible').hasClass('checked')){var selectedStep='Steps Complete';$.each($('li.step:visible'),function(){if(!$(this).hasClass('checked')){selectedStep=$(this).attr('data-name');return false;}});_gaq.push(['_trackEvent',"FTUX_Tour","Doc Panel Closed",selectedStep]);}else{_gaq.push(['_trackEvent',"Docs_Panel","Doc Panel Closed",uri]);}}else{if($('li.step:visible').hasClass('selected')||$('li.step:visible').hasClass('checked')){_gaq.push(['_trackEvent',"FTUX_Tour","Doc Panel Opened"]);}else{_gaq.push(['_trackEvent',"Docs_Panel","Doc Panel Opened",uri]);}}
DocPanelView.togglePanel();});$('#doc-panel .section-bar').click(function(){var $section=$(this).closest('.section');if($section.hasClass('open')){$('.steps',$section).slideUp(200,function(){$section.removeClass('open');$(ItemsView).trigger('heightchanged');});}else{$('.steps',$section).slideDown(200,function(){$section.addClass('open');$(ItemsView).trigger('heightchanged');});}});$(window).resize(function(){positionPanel();});$(ItemController).bind('itemloaded',function(){var name;var steps;var item=ItemController.getCurrentItem();var uri=item.uri;uri=uri.replace('Library/','');uri=uri.slice(0,-1);if(ItemController.getLoggedIn()&&$.inArray(uri,Object.keys(choreos))>=0){$('#doc-panel').show();positionPanel();$('#doc-panel .section .steps .step').removeClass('checked selected');$('#doc-panel .section .steps .step').removeClass('visible');$.each(choreos[uri],function(k,v){var steps=$('#doc-panel .section .steps .step[data-name="'+v+'"]');if(v=='credentials'||v=='inputs'){$('#doc-panel .section .steps .step[data-name="'+v+'"][data-choreo="'+uri+'"]').addClass('visible');}else{$('#doc-panel .section .steps .step[data-name="'+v+'"]').addClass('visible');}});if(IoTModeController.enabled()){$('#doc-panel .step.visible.non-iot:not(.iot)').hide();name=$('#doc-panel .steps .step.visible.iot:first').attr('data-name');steps=$('#doc-panel .steps li.step.visible.iot');}else{$('#doc-panel .step.visible.iot:not(.non-iot)').hide();name=$('#doc-panel .steps .step.visible.non-iot:first').attr('data-name');steps=$('#doc-panel .steps li.step.visible.non-iot');}
var i=0;$.each(steps,function(k,v){i++;if($(this).attr('data-name')==name){return false;}});DocPanelController.setPlatform();if(uri.indexOf('OAuth')>-1){$('#doc-panel .section.run-your-code .run-section-oauth').show();$('#doc-panel .section.run-your-code .run-section.selected').hide();}else{$('#doc-panel .section.run-your-code .run-section-oauth').hide();$('#doc-panel .section.run-your-code .run-section.selected').show();}
if(uri==ftuxChoreo){$('#iot-mode-container .device').append(DocPanelView.renderCallout('device',0,callouts));$('#iot-mode-container').append(DocPanelView.renderCallout('network',1,callouts));$('.meta-class.inputs.required .input-container:eq(0)').append(DocPanelView.renderCallout('inputs',2,callouts));$('.inputs-container').append(DocPanelView.renderCallout('run',3,callouts));$('.select-container').append(DocPanelView.renderCallout('language',4,callouts));$('.export.download-link').closest('li').append(DocPanelView.renderCallout('download',5,callouts));$('.callout.ftux[data-name="'+name+'"] .step-number').text(i);if($.cookie('library_welcome')==null){$('.callout.ftux[data-name="'+name+'"]').addClass('selected');}else{$('button.restart-callouts').show();}
$(document).off('click','.callout.ftux .button.next').on('click','.callout.ftux .button.next',function(){var callout=$(this).closest($('.callout.ftux'));var name=callout.attr('data-name');var index=parseInt(callout.attr('data-index'));$('#doc-panel .steps .step[data-name="'+name+'"]').addClass('checked');$('#doc-panel .steps .step[data-name="'+name+'"] .check').remove();setTimeout(function(){$('#doc-panel .steps .step[data-name="'+name+'"]').removeClass('selected');$('#doc-panel .steps .step[data-name="'+name+'"]').prepend('<div class="check"></div>');$('#doc-panel .steps .step[data-name="'+name+'"] .check').css('background-image','url(/assets/icon-docs-panel-check.gif?'+Math.random()+')');},200);if(callout.attr('data-name')=='download'){$('.section.getting-started .steps').slideUp(200,function(){$('.section.getting-started').removeClass('open');});$('.section.run-your-code .steps').slideDown(200,function(){$('.section.run-your-code').addClass('open');});$('button.restart-callouts').show();}else{var found=false;while(!found){index++;if((IoTModeController.enabled()&&$('#doc-panel li.step.visible[data-index="'+index+'"]').hasClass('iot'))||!IoTModeController.enabled()&&$('#doc-panel li.step.visible[data-index="'+index+'"]').hasClass('non-iot')){found=true;}}
$('#doc-panel .steps .step.visible[data-index="'+index+'"]').addClass('selected');$('.callout.ftux[data-index="'+index+'"]').addClass('selected');}
var steps;if(IoTModeController.enabled()){steps=$('#doc-panel .steps li.step.visible.iot');}else{steps=$('#doc-panel .steps li.step.visible.non-iot');}
var i=1;$.each(steps,function(k,v){i++;if($(this).attr('data-name')==name){return false;}});$('.callout.ftux[data-index="'+index+'"] .step-number').text(i);callout.removeClass('selected');});$(document).off('click','.callout.ftux .icon.close').on('click','.callout.ftux .icon.close',function(){var callout=$(this).closest($('.callout.ftux'));var index=parseInt(callout.attr('data-index'));callout.removeClass('selected');$('#doc-panel .steps .step[data-index="'+index+'"]').removeClass('selected');$('button.restart-callouts').show();_gaq.push(['_trackEvent',"FTUX_Tour","Callout Closed",callout.attr('data-name')]);});$(document).off('click','#doc-panel button.restart-callouts').on('click','#doc-panel button.restart-callouts',function(){var name;if(IoTModeController.enabled()){name=$('#doc-panel .steps .step.visible.iot:first').attr('data-name');}else{name=$('#doc-panel .steps .step.visible.non-iot:first').attr('data-name');}
$('.callout.ftux[data-name="'+name+'"] .step-number').text('1');$('.callout.ftux[data-name="'+name+'"]').addClass('selected');$('.callout.ftux.selected').show();$(this).hide();if(IoTModeController.enabled()){$('#doc-panel .steps .step.visible.iot:first').addClass('selected');}else{$('#doc-panel .steps .step.visible.non-iot:first').addClass('selected');}
$('#doc-panel .steps .step').removeClass('checked');$('#doc-panel .steps .step .check').remove();});}else{$('#doc-panel .section .steps button.restart-callouts').hide();}}else{if($('#doc-panel').hasClass('active')){DocPanelView.togglePanel();setTimeout(function(){$('#doc-panel').hide();},400);}else{$('#doc-panel').hide();$('#page').removeClass('panel-open');}}});},toggleIoTMode:function(enabled){if(enabled){$('#doc-panel .step.visible.non-iot').hide();$('#doc-panel .step.iot.visible').show();if($('#doc-panel .steps .step').hasClass('selected')){$('#doc-panel .steps .step.selected').removeClass('selected');$.each($('#doc-panel .steps .step.visible.iot'),function(){if(!$(this).hasClass('checked')){$(this).addClass('selected');var name=$(this).attr('data-name');var steps=$('#doc-panel .steps li.step.visible.iot');var i=0;$.each(steps,function(k,v){i++;if($(this).attr('data-name')==name){return false;}});$('.callout.ftux[data-name="'+name+'"] .step-number').text(i);$('.callout.ftux').removeClass('selected');$('.callout.ftux[data-name="'+name+'"]').addClass('selected');return false;}});}}else{$('#doc-panel .step.visible.iot').hide();$('#doc-panel .step.visible.non-iot').show();if($('#doc-panel .steps .step').hasClass('selected')){$('#doc-panel .steps .step.selected').removeClass('selected');$.each($('#doc-panel .steps .step.visible.non-iot'),function(){if(!$(this).hasClass('checked')){$(this).addClass('selected');var name=$(this).attr('data-name');var steps=$('#doc-panel .steps li.step.visible.non-iot');var i=0;$.each(steps,function(k,v){i++;if($(this).attr('data-name')==name){return false;}});$('.callout.ftux[data-name="'+name+'"] .step-number').text(i);$('.callout.ftux').removeClass('selected');$('.callout.ftux[data-name="'+name+'"]').addClass('selected');return false;}});}}
$(ItemsView).trigger('heightchanged');},setPlatform:function(){var platform;var shortName;platform=$.cookie('library_default_language');if(platform=='Android'||platform=='iOS'||platform=='Java'||platform=='JavaScript'||platform=='PHP'||platform=='Processing'||platform=='Python'||platform=='Ruby'||platform=='Arduino'||platform=='TI'||platform=='Samsung'){shortName=platform.toLowerCase();}else if(platform=='C#'){shortName='csharp';}else if(platform=='cURL'){shortName='restapi';}else if(platform=='Node.js'){shortName='nodejs';}
$('#doc-panel .section.run-your-code .run-section.selected').removeClass('selected');$('#doc-panel .section.run-your-code .run-section[data-platform="'+shortName+'"]').addClass('selected');if($('#doc-panel .section.run-your-code').hasClass('open')){$(ItemsView).trigger('heightchanged');}}};}();var DocPanelView=function(){return{renderCallout:function(stepName,stepIndex,steps){var callout='<div class="callout shadow ftux" data-name="'+stepName+'" data-index="'+steps[stepName]['index']+'">\
						<div class="icon close"></div>\
						<div class="step-number">'+(stepIndex+1)+'</div>\
						<div class="step-title">'+steps[stepName]['title']+'</div>\
						<div class="step-text">'+steps[stepName]['text']+'</div>\
						<div class="button-container">\
							<button class="button lightgreen small next" type="button">Next</button>\
						</div>\
						<div class="arrow bottom"></div>\
					</div>';return callout;},togglePanel:function(){var widget=$('button.slidein').parent();if($('#doc-panel').hasClass('active')){$('#page.content').removeClass('panel-open');widget.removeClass('active');}else{widget.addClass('active');$('#page.content').addClass('panel-open');}
$(ItemsView).trigger('heightchanged');}}}();var MasterController=function(){$.ajaxSetup({cache:false});var currentView,colHeight=0;return{getCurrentView:function(){return currentView;},init:function(data){PAGE_LIBRARY=true;LOGGED_IN=data.loggedIn;LANGUAGE_MAP=data.language_map;if(HistoryController.checkHtml4Redirect()){return false;}
var self=this;contentMinHeight=parseInt($('.column:first').css('min-height').replace(/px/,''));var resizeColumns=function(){var colHeight,maxHeight=0;$('.column').each(function(i){colHeight=0;$(this).children().each(function(){colHeight+=$(this).outerHeight(true);});if(colHeight>maxHeight)
maxHeight=colHeight;});if($('#doc-panel').hasClass('active')){var docPanelHeight=$('#doc-panel').outerHeight(true);if(docPanelHeight>maxHeight){maxHeight=docPanelHeight;}}
maxHeight<contentMinHeight&&(maxHeight=contentMinHeight);$('.column').css('min-height',maxHeight+'px');$(Temboo).trigger('layoutchange');};ValidationController.init();oauthHelpers=data.oauthHelpers;AnalyticsController.init();CredentialsController.init();CredentialsTemplateController.init();FilterController.init();ProfilesController.init();TransducerController.init(data.transducers,data.device_type,data.device_type_transducer);DocPanelController.init(data.ftux_callouts,data.ftux_choreo,data.doc_panel_choreos);ItemsView.init();SnippetController.init(data.defaultLanguage,data.selectable_languages,data.tiCcsInstructions,data.githubInstructions);data.snippets&&SnippetController.setSnippets(data.snippets);$(TreeController).bind('treeresized',resizeColumns);$(ItemsView).bind('heightchanged',resizeColumns);$(LibraryModel).bind('libraryinitialized',TreeController.init);LibraryModel.init(data.tree);SearchController.init();ItemController.init();ChoreoController.init(data.loggedIn);IoTModeController.init();PinController.init();GatewayController.init();SearchModel.init($('.library-view form.search').attr('action'));$(ItemsView).bind('itemsrendered',function(event){ItemsView.loading(false);resizeColumns($('.details-view').outerHeight(true));});$(document).off('click','.details-view .item-view a.breadcrumb,\
						.details-view .item-view a.tmb-item-link,\
						.details-view .item-view .item-summary a,\
						.multi-bundle ul.clickfish ul a, .single-bundle a,\
						.keyword-group-view .items a').on('click','.details-view .item-view a.breadcrumb,\
						.details-view .item-view a.tmb-item-link,\
						.details-view .item-view .item-summary a,\
						.multi-bundle ul.clickfish ul a, .single-bundle a,\
						.keyword-group-view .items a',function(event){event.preventDefault();var uri=$(this).prop('href').replace(/^https?:\/\/[^\/]*/,'');TreeController.setClicked([uri]);uri=uri.replace(baseUrl,'');if(ItemModel.isCached(uri)){ItemsView.loading(true);}
ItemController.loadItem(uri);});$(document).off('click','.fave-button').on('click','.fave-button',function(){if($(this).hasClass('transition')){return;}
var currItem=ItemController.getCurrentItem();var uri=currItem.uri;var button=$(this);button.addClass('transition');if(button.hasClass('not-faved')){$.post('/library/favorite/',{'uri':uri},function(){button.removeClass('not-faved');button.addClass('faved');button.removeClass('transition');TreeController.addFavelistItem(uri);var analyticsBasics=['_trackEvent','Library','Favorite'];var analyticsSpecifics=uri.split('/');analyticsSpecifics=analyticsSpecifics.slice(1,(analyticsSpecifics.length-1))
_gaq.push(analyticsBasics.concat(analyticsSpecifics));ItemController.flushCurrentItem();});}else{$.post('/library/unfavorite/',{'uri':uri},function(){button.removeClass('faved');button.addClass('not-faved');button.removeClass('transition');TreeController.removeFavelistItem(uri);var analyticsBasics=['_trackEvent','Library','Unfavorite'];var analyticsSpecifics=uri.split('/');analyticsSpecifics=analyticsSpecifics.slice(1,(analyticsSpecifics.length-1))
_gaq.push(analyticsBasics.concat(analyticsSpecifics));ItemController.flushCurrentItem();});}});$(document).off('click','.meta-class input[type=checkbox].optional').on('click','.meta-class input[type=checkbox].optional',function(event){var metaClass='.meta-class.'+event.target.value+' .meta-item.optional',animation=$(metaClass+':first').css('display')=='none'?'slideDown':'slideUp';count=$(metaClass).size(),complete=0;$(metaClass)[animation].call($(metaClass),ANIMATION_MILLIS,function(event){++complete==count&&resizeColumns();});});var $slackCallout=$('#slack-callout');var slackCalloutHref=$('a',$slackCallout).attr('href');$(window).bind('libraryloaded',function(){$(window).unbind('libraryloaded');$slackCallout.fadeIn(200);});$('a, button',$slackCallout).click(function(e){e.preventDefault();var elem=e.target;$.post('/slack/dismiss/library',function(response){Temboo.log('MasterController.init','Dismissed Slack callout');if($(elem).is('a')){Temboo.trackEvent('Slack','Clicked Slack ad');window.location.replace(elem.href);}});$slackCallout.fadeOut(200);});$(FilterController).bind('itemloaded',function(event,item){currentView=ItemView;$(window.Temboo).trigger('layoutchange');});$(SearchModel).bind('searchresult',function(event,result){ItemsView.loading(false);});HistoryController.init();HistoryController.loadInitItem(data);LibraryLandingController.init(data);$(window).load(function(){$(ItemsView).trigger('heightchanged');});window.setTimeout(function(){$(ItemsView).trigger('heightchanged');},1000);$(window).trigger('libraryloaded');$(ItemController).bind('itemloaded',function(){if(ItemController.getLoggedIn()&&ItemController.getCurrentItem().uri=='Library/'+data.ftux_choreo+'/'){if($.cookie('library_welcome')==null){var currentItem=ItemController.getCurrentItem();$('#library-welcome-popup .sdk-buttons-container.iot').off('click','.sdk-button').on('click','.sdk-button',function(){var language=$(this).attr('data-language');if(!IoTModeController.enabled()){IoTModeController.enable();}
IoTModeView.updateSnippets(currentItem);SnippetController.setPlatformSelector(language);$('#library-welcome-popup').lightbox('close');_gaq.push(['_trackEvent',"FTUX_1","Platform Selected",language]);});$('#library-welcome-popup .sdk-buttons-container.non-iot').off('click','.sdk-button').on('click','.sdk-button',function(){var language=$(this).attr('data-language');if(IoTModeController.enabled()){IoTModeController.disable();}
SnippetController.setPlatformSelector(language);IoTModeView.updateSnippets(currentItem);$('#library-welcome-popup').lightbox('close');_gaq.push(['_trackEvent',"FTUX_1","Platform Selected",language]);});$('#library-welcome-popup').show().lightbox({buttons:{cancel:false}}).off('lightboxclose').on('lightboxclose',function(event){window.onbeforeunload=null;$('#library-welcome-popup').hide();DocPanelView.togglePanel();var name;if(IoTModeController.enabled()){$('#doc-panel .steps .step.visible.iot:first').addClass('selected');name=$('#doc-panel .steps .step.visible.iot:first').attr('data-name');}else{$('#doc-panel .steps .step.visible.non-iot:first').addClass('selected');name=$('#doc-panel .steps .step.visible.non-iot:first').attr('data-name');}
$('.callout.ftux.selected').removeClass('selected');$('.callout.ftux[data-name="'+name+'"] .step-number').text('1');$('.callout.ftux[data-name="'+name+'"]').addClass('selected');_gaq.push(['_trackEvent',"FTUX_Content_Lightbox","Lightbox Closed"]);});window.onbeforeunload=function(){_gaq.push(['_trackEvent',"FTUX_1","User leaves","Platform Choice Modal"]);}
$.cookie('library_welcome',true,{expires:180,path:'/'});}}});}}}();var MyAccountController=function(){$.ajaxSetup({cache:false});var currentView,colHeight=0;return{getCurrentView:function(){return currentView;},init:function(data){PAGE_MY_ACCOUNT=true;var self=this;contentMinHeight=parseInt($('.column:first').css('min-height').replace(/px/,''));var resizeColumns=function(){var colHeight,maxHeight=0;$('.column').each(function(i){colHeight=0;$(this).children().each(function(){colHeight+=$(this).outerHeight(true);});if(colHeight>maxHeight)
maxHeight=colHeight;});maxHeight<contentMinHeight&&(maxHeight=contentMinHeight);$('.column').css('min-height',maxHeight+'px');$(Temboo).trigger('layoutchange');};oauthHelpers=data.oauthHelpers;CredentialsTemplateController.init(data);$('.widget').each(function(){$(this).find('input, textarea').focus(function(){$(this).val('').unbind('focus');});$(this).find('form').submit(function(event){event.preventDefault();var input,field,valid,value,errClass='form-error',form=$(event.target),invalid=new Array(),widget=form.parents('.widget'),errors={'email':"That's not a valid email address",'message':"Please enter some feedback"};widget.find('.'+errClass).remove();$.each(errors,function(field){input=$(form).find('.'+field+':first');if(input){value=input.val().toLowerCase();switch(field){case'email':valid=null!=value.match(/[\w\-]+@[\w\-]+\.[a-z]{2,4}/);break;case'message':valid=value.length>0;break;}
if(!valid){invalid.push({field:field,error:errors[field]});}}});if(invalid.length){var err;for(var i in invalid){err=invalid[i];$(form).find('label[for='+err.field+']').after('<p class="'+errClass+'">'+err.error+'</p>');}}
else{var params={},url=$(event.target).attr('action');var showStatus=function(status,message){var layout,yPos,container=$('body > .content'),viewId='widget-status',view=$('<p />').attr('id',viewId).addClass('status-alert '+status).html(message);yPos=$('#footer').offset().top-container.offset().top;container.append(view.get(0));if(yPos>$(window).scrollTop()+$(window).height()){layout={position:'fixed',bottom:0,top:'auto'}}
else{layout={position:'absolute',bottom:'auto',top:yPos-view.outerHeight(true)}}
layout.display='none';layout.visibility='visible';layout.width=view.outerWidth(true)+'px';view.css(layout);$('#'+viewId).fadeIn(ANIMATION_MILLIS).delay(4000).fadeOut(ANIMATION_MILLIS,function(){$(this).remove();});}
$(form).find('input, textarea').each(function(){params[$(this).attr('name')]=$(this).val();});widget.find('button.close').click();$.post(url,params,function(response){var status=response.success?'success':'error',message=response.success||response.error||'Oops, something went wrong, please try again later';showStatus(status,message);},'json');}});});}}}();var SearchController=function(){var query,searching;function setSearching(nowSearching){var $f=$('.library-view form.search');searching=nowSearching;if(searching){$f.addClass('searching');$('#lib-search-button').removeClass('filled');$('#lib-search-button').addClass('searching');}else{$f.removeClass('searching');$('#lib-search-button').removeClass('searching');if($('#search-library').val().length>0){$('#lib-search-button').addClass('filled');}}}
function startSearchTimeout(){try{window.clearTimeout(searchTimeout);}catch(e){}
searchTimeout=window.setTimeout(submitSearch,500);}
function submitSearch(){if(!$('#search-library').val().length){clearSearchState();}else{$('.library-view form.search').submit();}}
function clearSearchState(){$('#search-library').val('');$('.tree-empty-search').hide();TreeController.externalFlushSearch();TreeController.applyFilters();$('#lib-search-button').removeClass('filled');}
return{getQuery:function(){return query;},externalSetSearching:function(nowSearching){setSearching(nowSearching);},init:function(){var self=this;$('#search-library').focus(function(){$(this).prev('label').hide();}).blur(function(){if($(this).val().length<1)
$(this).prev('label').show();else
$(this).prev('label').hide();}).blur();$('body').keypress(function(event){if(event.which==47&&!$('input').is(':focus')&&!$('textarea').is(':focus')){event.preventDefault();$('#search-library').select();}});$('.library-view form.search').submit(function(event){event.preventDefault();$('.tree-empty-search').hide();query=$(this).find('input.query').val().replace(/^\s+$/,'');if(query.length){setSearching(true);SearchModel.doQuery('json',query);Temboo.trackEvent("Library","Search",query);}else{if($('#lib-search-button').hasClass('filled')){clearSearchState();}}});$('#lib-search-button').on('click',function(event){event.preventDefault();if($(this).hasClass('searching')){}else if($(this).hasClass('filled')){clearSearchState();}});$('input#search-library').keydown(function(event){if(event.which==8||event.which==46){startSearchTimeout();}else if(event.which==27){event.preventDefault();clearSearchState();}});$('input#search-library').keypress(function(){if($('#lib-search-button').hasClass('filled')){$('#lib-search-button').removeClass('filled');}
startSearchTimeout();});$(document).off('click','.details-view .item-view a.search-all').on('click','.details-view .item-view a.search-all',function(e){e.preventDefault();FilterController.clearFilters();});},doQuery:function(query){var form=$('.library-view form.search');form.find('input.query').val(query).focus();form.submit();},clearForm:function(){searching||SearchView.clearForm();setSearching(false);}}}();var SearchModel=function(){var baseUrl,url,result,reqFuncs={'json':$.getJSON,'html':$.get};return{doQuery:function(format,query){var self=this;url=baseUrl.replace(/\/?$/,'/'+format+'/'+encodeURI(query));Temboo.log('SearchModel.doQuery',url);reqFuncs[format].call(null,url,function(data){result=data;result.response.query=query;Temboo.log('SearchModel.doQuery','Found '+data.response.numFound+' matches');$(self).trigger('searchresult',result.response);});},init:function(serverUrl){baseUrl=serverUrl;}};}();var SearchView=function(){return{clearForm:function(){$('#search-library').triggerHandler('focus');$('#search-library').val('').blur();$(this).trigger('reset');}}}();var SnippetController=function(){var language,snippets,loadTimer,initialised=false;var iotPlatforms=['Arduino','TI','Samsung','Qualcomm'];var platforms=['Arduino','TI','Samsung','Qualcomm','C#','Java','JavaScript','Node.js','PHP','Processing','Python','cURL','Ruby','iOS','Android'];return{getLanguage:function(){return language;},setLanguage:function(newLanguage){language=newLanguage;},setPlatformSelector:function(language){var item=ItemController.getCurrentItem();SnippetView.update(language,item.model.snippets);ChoreoController.runModeIsActive()&&SnippetController.loadUserSnippet();if(!(language=='Java'&&$.cookie('library_default_language')=='Android')){$.cookie('library_default_language',language,{expires:180,path:'/'});}
if($.inArray(language,platforms)==-1){language='Arduino';}
SnippetView.updatePlatformSelector(language);DocPanelController.setPlatform();if($.inArray(language,iotPlatforms)>-1){if(!IoTModeController.enabled()){IoTModeController.enable();}
IoTModeController.setBrand(language);}else if($.inArray(language,iotPlatforms)==-1&&IoTModeController.enabled()){IoTModeController.disable();}
IoTModeView.setCompilable();},init:function(defaultLanguage,selectable_languages,tiCcsInstructions,githubInstructions){if(!initialised){language=defaultLanguage;var clickOutsideDropdown=function(event){var $target=$(event.target).closest('.platform-selector-dropdown');if(!$target.first().is($('.platform-selector-dropdown'))){$('.platform-selector-dropdown').hide();$(document).off('click',clickOutsideDropdown);}};$(document).off('click','.platform-selector-label').on('click','.platform-selector-label',function(){$('.platform-selector-dropdown').css('display','inline-block');$(document).off('click',clickOutsideDropdown).on('click',clickOutsideDropdown);});$(document).off('click','.meta-class.snippet .meta-class-name').on('click','.meta-class.snippet .meta-class-name',function(){if(!IoTModeController.enabled()){var dropdown=$(this).parent().find('.select-container');dropdown.find('.selectBox-dropdown').show();func=dropdown.is(':visible')?'fadeOut':'fadeIn';dropdown[func].call(dropdown,ANIMATION_MILLIS);}});$(document).off('click','.meta-class.second-snippet .meta-class-name').on('click','.meta-class.second-snippet .meta-class-name',function(){var dropdown=$(this).parent().find('.second-select-container');dropdown.find('.selectBox-dropdown').show();func=dropdown.is(':visible')?'fadeOut':'fadeIn';dropdown[func].call(dropdown,ANIMATION_MILLIS);});$(ItemController).bind('unload',function(e,item){$('.meta-class.snippet select').filter('.selectBox').each(function(){Temboo.log('SnippetController.init','Destroying selectBox...');$(this).selectBox('destroy').hide();});$('.meta-class.second-snippet select').filter('.selectBox').each(function(){Temboo.log('SnippetController.init','Destroying second snippet selectBox...');$(this).selectBox('destroy').hide();});});$(ItemsView).bind('itemsrendered',function(){var item=ItemController.getCurrentItem();if(item.model&&item.model.type=='choreo'){if(typeof item.model.snippets==='undefined')
item.model.snippets=snippets;SnippetView.init(item.model.snippets,language,selectable_languages,tiCcsInstructions,githubInstructions);ChoreoController.runModeIsActive()&&SnippetController.loadUserSnippet();if($.cookie('library_default_language')==null){SnippetController.setPlatformSelector('Arduino');}else{SnippetController.setPlatformSelector($.cookie('library_default_language'));}
$(document).off('click','.platform-selector-dropdown .sdk-button-container').on('click','.platform-selector-dropdown .sdk-button-container',function(){language=$(this).attr('data-language');SnippetController.setPlatformSelector(language);if($(this).parent().hasClass('non-iot')){Temboo.trackEvent("Library","Sample code language selected",language);}
$('#platform-selector .platform-selector-dropdown').hide();$(document).off('click',clickOutsideDropdown);});}});$(SnippetModel).bind('snippetloaded',function(event,data){SnippetView.update(language,data);});}},setSnippets:function(itemSnippets){snippets={};var s;for(var i in itemSnippets){s=itemSnippets[i];snippets[s.name]=s.value;}},updateSecondSnippet:function(reqParams){if(reqParams){reqParams['language']=$('select.second-snippet-lang').find(":selected").text()+' Proxy';}else{var rawInputs=ItemController.getInputValues();reqParams={choreo:ItemController.getCurrentItem().uri,inputs:rawInputs?encodeURIComponent($.param(rawInputs)):rawInputs,language:$('select.second-snippet-lang').find(":selected").text()+' Proxy'}
var activeCred=CredentialsController.activeCredential();activeCred&&(reqParams.credential=activeCred);}
$.post('/choreo_proxy/snippet/',reqParams,function(response){var result;if(response.status=='success'){result=response.data.snippets;}
else{result=response.data;Temboo.log('SnippetController.updateSecondSnippet','An error occurred: '+result);}
$(SnippetModel).trigger('snippetloaded',result);$('pre.second-snippet').text(response['data']['snippets']['jsproxy']);prettyPrint();TreeController.resizeTree();},'json');},loadUserSnippet:function(sharing){var credential=CredentialsController.activeCredential();var inputs=ItemController.getInputValues();loadTimer&&window.clearTimeout(loadTimer);loadTimer=window.setTimeout(function(){SnippetModel.loadSnippets(inputs,credential,null,null,sharing);},1);}}}();var SnippetModel=function(){var cache={},item;return{getSnippets:function(){var language=SnippetController.getLanguage();if(!language||!cache[language])
return null;var header=language+' Header',s={};s[language]=cache[language];s[header]=cache[header];if(IoTModeController.BLEEnabled()){s['Arduino Classic']=cache['Arduino Classic'];}
return s;},loadSnippets:function(inputs,credentialName,language,choreo,sharing){item=ItemController.getCurrentItem();IoTModeController.pruneInputs(inputs);var rawInputs=inputs;inputs&&(inputs=encodeURIComponent($.param(inputs)));language=language?language:SnippetController.getLanguage();if(language=='IoT Default Sketch'||language=='IoT Default Header'){return false;}
var shield=IoTModeController.getShield();if(IoTModeController.enabled()&&shield=='Arduino Yún Shield'&&language!='Arduino Yún Shield Header'){language='Arduino Yún Shield';}
var self=this,choreo=choreo||item.uri,params={choreo:choreo,inputs:inputs,language:language};credentialName&&(params.credential=credentialName);if(IoTModeController.enabled()&&IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'){params.network=GatewayController.getSelectedProperty('network');}else if(IoTModeController.enabled()&&(IoTModeController.getDevice()=='ArduinoMKR1000'||IoTModeController.isArduinoClassicDevice(IoTModeController.getDevice())||IoTModeController.getDevice()=='TI'||IoTModeController.getDevice()=='ti_cc3100'||IoTModeController.getDevice()=='ti_cc3200'||IoTModeController.getDevice()=='Samsung.Artik.Ten'||IoTModeController.getDevice()=='Qualcomm')&&IoTModeController.getNetwork()&&shield!='Arduino Yún Shield'){params.network=IoTModeController.getNetwork();}
if((language=='Arduino Classic'&&!IoTModeController.BLEEnabled())||language=='Arduino Yún'||language=='Arduino MKR1000'||language=='Arduino Yún Shield'||language=='Texas Instruments LaunchPad'||language=='Texas Instruments CC3200 RTOS'||language==BoardModel.Samsung.Artik.Ten.marketingName){if(TriggerController.toJSON()){params.board=TriggerController.toJSON(true);}}
if(IoTModeController.sensorInputsEnabled()){var sensorInputs=ItemController.getSensorInputs(IoTModeController.getDeviceType());if(sensorInputs){IoTModeController.addCloudKeys(params,false);params.board.sensorInputs=sensorInputs;}}
if(IoTModeController.getGateway()&&IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'){params.gateway=IoTModeController.getGatewayJSON();}
params.sharing=sharing?true:false;if(shield=='arduinowifi101'||shield=='mkr1000'){params.ssl=true;}
var deviceShortName=IoTModeController.getDeviceShortName();var shieldShortName=IoTModeController.getShieldShortName();if(deviceShortName){if(shieldShortName){params.deviceType=deviceShortName+'+'+shieldShortName;}else{params.deviceType=deviceShortName;}}
if(params.board)params.board=JSON.stringify(params.board);$.post('/choreo_proxy/snippet/',params,function(response){if(item!=ItemController.getCurrentItem()){Temboo.log('SnippetModel.loadSnippet','Discarding snippet for old choreo: '+choreo);}
else{var result;if(response.status=='success'){result=response.data.snippets;for(var l in result){cache[l]=result[l];}}
else{result=response.data;delete cache[language];Temboo.log('SnippetModel.loadSnippet','An error occurred: '+result);}
$(SnippetModel).trigger('snippetloaded',result);if(params['language']=='JavaScript'){SnippetController.updateSecondSnippet(params);}}},'json');SnippetView.updateGithubExportButton();if(IoTModeController.BLEEnabled()&&(language=='iOS'||language=='Android')){if(language=='iOS'){SnippetModel.loadSnippets(rawInputs,credentialName,'iOS Header',null,sharing);params['headerLanguage']='iOS Header';}
SnippetModel.loadSnippets(rawInputs,credentialName,'Arduino Classic',null,sharing);SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);}else if(language=='Arduino Yún'){SnippetModel.loadSnippets(rawInputs,credentialName,'Arduino Yún Header',null,sharing);params['headerLanguage']='Arduino Yún Header';SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);}else if(language=='Arduino Yún Shield'){SnippetModel.loadSnippets(rawInputs,credentialName,'Arduino Yún Shield Header',null,sharing);params['headerLanguage']='Arduino Yún Shield Header';SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);}else if(language=='Arduino Classic'&&!IoTModeController.BLEEnabled()){SnippetModel.loadSnippets(rawInputs,credentialName,'Arduino Classic Header',null,sharing);params['headerLanguage']='Arduino Classic Header';SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);}else if(language=='Texas Instruments LaunchPad'){SnippetModel.loadSnippets(rawInputs,credentialName,'Texas Instruments LaunchPad Header',null,sharing);params['headerLanguage']='Texas Instruments LaunchPad Header';SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);SnippetView.updateTiCcsExportButton();}else if(language=='Texas Instruments CC3200 RTOS'){SnippetModel.loadSnippets(rawInputs,credentialName,'Texas Instruments CC3200 RTOS Header',null,sharing);params['headerLanguage']='Texas Instruments CC3200 RTOS Header';SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);SnippetView.updateTiCcsExportButton();}else if(language==BoardModel.Samsung.Artik.Ten.marketingName){SnippetModel.loadSnippets(rawInputs,credentialName,'Samsung ARTIK 10 Header',null,sharing);params['headerLanguage']='Samsung ARTIK 10 Header';SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);}else if(language=='Qualcomm QCA4002'){SnippetModel.loadSnippets(rawInputs,credentialName,'Qualcomm QCA4002 Header',null,sharing);params['headerLanguage']='Qualcomm QCA4002 Header';SnippetView.updateDownloadButton(params);SnippetView.updateDownloadCompiledButton(params);}else if(language=='IoT Default Sketch'){SnippetModel.loadSnippets(rawInputs,credentialName,'IoT Default Header',null,sharing);}}}}();var SnippetView=function(){var tiCcsInstructions;var githubInstructions;var getView=function(){return $('.details-view .item-view .meta-class.snippet');}
var tiShieldToBoardIdMap={ti_cc3100:'lpmsp430f5529',ti_cc3200:'lpcc3200'}
var fileExtensions={'C#':'cs','cURL':'sh','iOS':'m','Java':'java','JavaScript':'js','Node.js':'js','PHP':'php','Processing':'pde','Python':'py','Ruby':'rb','Android':'java','Arduino Classic':'ino','Arduino Yún':'ino','Texas Instruments LaunchPad':'ino','Texas Instruments CC3200 RTOS':'c','Samsung ARTIK 10':'c','Qualcomm QCA4002':'c'}
return{init:function(snippets,currentLanguage,selectable_languages,tiCcsInstructionsText,githubInstructionsText){var view=getView().filter('.iot-ble-task'),dropDownWidth,s;if(currentLanguage=='Android'){currentLanguage='Java';}
tiCcsInstructions=tiCcsInstructionsText;githubInstructions=githubInstructionsText;var proxySelector=$('<select/>',{class:'second-snippet-lang'});['Java','Node.js','PHP','Python','Ruby'].forEach(function(currItem){var entry=($('<option/>'));entry.attr('name','language');entry.text(currItem);proxySelector.append(entry);});if($.cookie('second_language_snippet')){proxySelector.val($.cookie('second_language_snippet'));}
$('.second-select-container').append(proxySelector);proxySelector.selectBox('attach');proxySelector.change(function(){$.cookie('second_language_snippet',$('select.second-snippet-lang').find(":selected").text(),{expires:180,path:'/'});SnippetController.updateSecondSnippet(null);});if(IoTModeController.enabled()&&!IoTModeController.BLEEnabled()){$('.selectBox.language.selectBox-dropdown').hide();}
if(!ItemController.getLoggedIn()){$('button.export.github').addClass('disabled');$('button.export.ccs').addClass('disabled');}
SnippetView.update(currentLanguage,snippets);},update:function(language,snippets){if(language=='Arduino Classic'){var shield=IoTModeController.getShield();if(shield=='Arduino Yún Shield'){language='Arduino Yún Shield';}}
var snippet=(typeof snippets=='string')?snippets:snippets[language];var view=getView()
if(language==SnippetController.getLanguage()||language=='Arduino Yún Shield'){if(IoTModeController.BLEEnabled()){$('pre.snippet',view.filter('.iot-ble-task')).text(snippet);}else{$('pre.snippet',view.filter('.main')).text(snippet);}}
if(language=='JavaScript'){$('li.second-snippet').show();}else{$('li.second-snippet').hide();}
if(IoTModeController.BLEEnabled()){$('li.headerfile.snippet').hide();$('li.snippet.iot-ble-task').show();if(language=='iOS'||language=='Android'){var subtitle=language;if(subtitle!='iOS')subtitle=subtitle.toUpperCase();$('.meta-class.iot-ble-task.snippet').find('.subtitle').html(subtitle+' CHOREO CLASS');}
$('.meta-class.snippet.main').find('.subtitle').html('Arduino Sketch');if(language=='iOS'){$('li.snippet.iot-ble-header').show();if(snippets['iOS Header'])
$('pre.snippet',view.filter('.iot-ble-header')).text(snippets['iOS Header']);}else{$('li.snippet.iot-ble-header').hide();}
if(snippets['Arduino Classic'])
$('pre.snippet',view.filter('.main')).text(snippets['Arduino Classic']);}else{if(IoTModeController.enabled())$('li.headerfile.snippet').show();$('li.snippet.iot-ble-task').hide();$('li.snippet.iot-ble-header').hide();$('.meta-class.snippet.main').find('.subtitle').html('Code');}
var headerfile=view.filter('.headerfile'),isPlaceholderSnippet=false;if(language=='Arduino Yún'||language=='Arduino Yún Header'){if(snippets['Arduino Yún Header']){$('pre.snippet',headerfile).text(snippets['Arduino Yún Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else if(language=='Arduino Classic'||language=='Arduino Classic Header'){if(snippets['Arduino Classic Header']){$('pre.snippet',headerfile).text(snippets['Arduino Classic Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else if(language=='Arduino Yún Shield'||language=='Arduino Yún Shield Header'){if(snippets['Arduino Yún Shield Header']){$('pre.snippet',headerfile).text(snippets['Arduino Yún Shield Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else if(language=='Texas Instruments LaunchPad'||language=='Texas Instruments LaunchPad Header'){if(snippets['Texas Instruments LaunchPad Header']){$('pre.snippet',headerfile).text(snippets['Texas Instruments LaunchPad Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else if(language=='Texas Instruments CC3200 RTOS'||language=='Texas Instruments CC3200 RTOS Header'){if(snippets['Texas Instruments CC3200 RTOS Header']){$('pre.snippet',headerfile).text(snippets['Texas Instruments CC3200 RTOS Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else if(language==BoardModel.Samsung.Artik.Ten.marketingName||language==BoardModel.Samsung.Artik.Ten.marketingName+' Header'){if(snippets[BoardModel.Samsung.Artik.Ten.marketingName+' Header']){$('pre.snippet',headerfile).text(snippets[BoardModel.Samsung.Artik.Ten.marketingName+' Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else if(language=='Qualcomm QCA4002'||language=='Qualcomm QCA4002 Header'){if(snippets['Qualcomm QCA4002 Header']){$('pre.snippet',headerfile).text(snippets['Qualcomm QCA4002 Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else if(language=='IoT Default Sketch'||language=='IoT Default Header'){isPlaceholderSnippet=true;if(snippets['IoT Default Header']){$('pre.snippet',headerfile).text(snippets['IoT Default Header']);}
headerfile.fadeIn(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}else{headerfile.fadeOut(ANIMATION_MILLIS,function(){$(ItemsView).trigger('heightchanged');});}
var $exportButtons=$('.meta-class.snippet .export-container');if(isPlaceholderSnippet){$exportButtons.addClass('disabled');}else{$exportButtons.removeClass('disabled');}
prettyPrint();},removeDownloadSavedForm:function(){var oldForm=$('form.download-compiled-form');if(oldForm.length>0){oldForm.remove();}},updateDownloadCompiledButton:function(params){SnippetView.removeDownloadSavedForm();var $popup=$('.device-registration-popup');$popup.on('cut keyup paste','input:visible',function(event){DeviceView.checkInputs();});$('.tags').off('click','.tag.add-new').on('click','.tag.add-new',function(){$(this).hide();$('.tags input#current-tag').show().focus();});var addTag=function(tagName){tagName=tagName.trim();if(tagName.length>0){var tagExists=false;$.each($('.tags .tag'),function(){if($(this).attr('rel')==tagName){tagExists=true;return false;}});if(!tagExists){$('.tags input#current-tag').after('<button type="button" class="tag new selected elided" rel="'+tagName+'">'+tagName+'</button>');}else{$('.tags .tag[rel="'+tagName+'"]').addClass('flash');setTimeout(function(){$('.tags .tag[rel="'+tagName+'"]').removeClass('flash');},600)}}
$('.tags input#current-tag').val('').hide();$('.tags .tag.add-new').show();};$('.tags input#current-tag').off('cut keyup paste').on('cut keyup paste',function(event){var userVal=$(this).val(),formattedVal=userVal;if(formattedVal.length>0){formattedVal=formattedVal.replace(/[,"]/g,'');}
$('.tags input#current-tag').val(formattedVal);});$('.tags input#current-tag').keydown(function(event){if(event.which==9||event.which==13){event.preventDefault();addTag($(this).val());}});$('.tags').off('click','.tag').on('click','.tag',function(){if(!$(this).hasClass('add-new')){$(this).toggleClass('selected');}});$('.tags input#current-tag').focusout(function(){addTag($(this).val());});$('.device-registration-form').off('click','#lat-lon-toggle').on('click','#lat-lon-toggle',function(){if($('#addressBox input#autocomplete').is(':visible')){$('input.latlon').val('').show();$('input.latlon#latitude').focus();$('#addressBox input#autocomplete').removeAttr('data-state').val('').hide();$(this).text('Use street address');}else{$('input.latlon').val('').hide();$('#addressBox input#autocomplete').val('').show();$('#addressBox input#autocomplete').focus();$(this).text('Use lat/long');}
$('.device-registration-form').find('button.save').attr('disabled','disabled');});$('input#autocomplete').off('cut keyup paste').on('cut keyup paste',function(){$(this).removeAttr('data-state');});var autocomplete=function(position){var latitude,longitude;if(position&&position.coords){latitude=position.coords.latitude;longitude=position.coords.longitude;}
$("#autocomplete").autocomplete({autoFocus:true,source:function(request,response){$.post('/device/autocomplete/'+request.term,function(myResponse){if(myResponse.status=='success'){var myData=JSON.parse(myResponse.data);var result=[];for(var i=0;i<myData.features.length;i++){result.push(myData.features[i].properties.label);}
response(result);}else{}});},select:function(event,ui){$("#autocomplete").attr('data-state','validating');var searchText='';if(event.keyCode==13){if($("#autocomplete").val().length==0){event.preventDefault();return false;}else{searchText=$("#autocomplete").val();}}else{searchText=ui.item.value;}
$.post('/device/autocomplete/'+searchText,function(myResponse){if(myResponse.status=='success'){var myData=JSON.parse(myResponse.data);$("#autocomplete").val(myData.features[0].properties.label).autocomplete('close');$('input#latitude').val(myData.features[0].geometry.coordinates[1]);$('input#longitude').val(myData.features[0].geometry.coordinates[0]);$("#autocomplete").attr('data-state','validated');DeviceView.checkInputs();}else{}});event.preventDefault();return false;}});}
autocomplete();$popup.off('beforelightboxopen').on('beforelightboxopen',function(e){$('select.device-registration-sensor-interval',$popup).val('1800000').selectBox('destroy').selectBox().on('change',function(){DeviceView.checkInputs();var interval=$(this).val();if(interval=='custom'){$('.device-registration-form input#custom-interval').show().focus();}else{$('.device-registration-form input#custom-interval').val('').hide();}}).on('open',function(){$('.device-registration-input.device-registration-select .sensor-frequency-protip').show();}).on('close',function(){$('.device-registration-input.device-registration-select .sensor-frequency-protip').hide();});$('.device-registration-input input#custom-interval').hide();$('input',$popup).val('');$('.device-id',$popup).text('');$('textarea',$popup).val('');$('.tags .tag:not(.add-new)').remove();$('.device-registration-form input#autocomplete').removeAttr('data-state');$.post('/device/listTags',{},function(result){if(result.status=='success'){$.each(result.data,function(index,tag){$('.tags').append('<button type="button" class="tag elided" rel="'+tag['name']+'">'+tag['name']+'</button>');});if($('.tags').height()>75){$('.tags').css('max-height','75px');$('.tags').after('<div class="more-tags">+ more</div>');$('.more-tags').click(function(){$('.tags').css('max-height','');$(this).remove();});}}});$('.device-registration-popup p.error').remove();if(DeviceController.deviceHasActuatorsOnly()){$('.device-registration-form .sensor-interval-container').hide();$('.device-registration-form .safeguard-container').hide();}else{$('.device-registration-form .sensor-interval-container').show();$('.device-registration-form .safeguard-container').show();}});getView().find('.download-compiled-container button.download-compiled').off('click').on('click',function(){if(!$(this).hasClass('disabled')){var device=IoTModeController.getDevice();var shield=IoTModeController.getShield();var deviceType=IoTModeController.getDeviceType();var oldForm=$('form.download-compiled-form');if(oldForm.length>0){oldForm.submit();return;}
$('.device-registration-popup').lightbox({staticSize:false,buttons:{save:{callback:function(){var inputs={};inputs['name']=$('.device-registration-form input[name=name]').val();var deviceId=$('.device-registration-form .device-id').text();inputs['device']=deviceId;inputs['description']=$('.device-registration-form textarea[name=description]').val();inputs['location']=$('.device-registration-form input#autocomplete').val();inputs['latitude']=$('.device-registration-form input#latitude').val();inputs['longitude']=$('.device-registration-form input#longitude').val();inputs['safeguard']=$('.device-registration-form input[name=safeguard-data]').is(':checked')?1:0;if(!DeviceController.deviceHasActuatorsOnly()){var sensorInterval=$('.device-registration-form select[name=sensor-interval]').val();if(sensorInterval=='custom'){sensorInterval=parseInt($('.device-registration-form input#custom-interval').val())*1000;if(sensorInterval<1){DeviceView.showErrors({'custom-interval':'Sensor interval must be at least 1 second.'});return;}else if(sensorInterval>4294967){DeviceView.showErrors({'custom-interval':'Sensor interval must not exceed 4294967 seconds.'});return;}
inputs['sensor_interval']=sensorInterval;}else{inputs['sensor_interval']=parseInt(sensorInterval);}}
var selectedTags=[];var newTags=[];$.each($('.tags .tag'),function(){if($(this).hasClass('selected')){selectedTags.push($(this).attr('rel'));}
if($(this).hasClass('new')){newTags.push($(this).attr('rel'));_gaq.push(['_trackEvent',"Cloud Controls","Tag Created",$(this).attr('rel')]);}});var deviceParams={inputs:encodeURIComponent($.param(inputs)),pins:JSON.stringify(DeviceController.getPinJSON()),selectedTags:JSON.stringify(selectedTags),newTags:JSON.stringify(newTags),deviceType:deviceType};$('.device-registration-popup p.error').remove();$.post('/device/save',deviceParams,function(result){if(result.status==='success'){var oldForm=$('form.download-compiled-form');oldForm.remove();var sketchName=ItemController.getCurrentItem().model.name;var iframeId='download-iframe-'+new Date().getTime();var $downloadForm=$('<form action="/choreo_proxy/snippetBinary/'+deviceId+'/" method="POST" class="download-compiled-form" target="'+iframeId+'">\
											        	<iframe class="download-iframe" name="'+iframeId+'" id="'+iframeId+'"></iframe>\
											        	<input type="hidden" name="'+TEMBOO_CSRF_NAME+'" value="'+TEMBOO_CSRF_HASH+'" />\
											        </form>');$downloadForm.prependTo(getView().filter('.main'));var localParams=jQuery.extend(true,{},params);if(IoTModeController.sensorInputsEnabled()){if(params.board)localParams.board=JSON.parse(params.board);IoTModeController.addCloudKeys(localParams,true);if(localParams.board.sensorInputs)localParams.board.sensorInputs=ItemController.getSensorInputs(null);var monitoring=PinController.getMonitoringStructure();localParams.board.monitoring=monitoring;localParams.board=JSON.stringify(localParams.board);}
for(var paramName in localParams){$('<input type="hidden" />').attr('name',paramName).val(localParams[paramName]).appendTo($downloadForm);}
$downloadForm.submit();$('.device-registration-popup').lightbox('close');$('<div class="status-alert success large device-saved">\
										        		<button class="icon close"></button>\
										        		</div>').append($('<div class="status-title">').text('Nice Work.')).append($('<div class="status-description">').html('Your download will start momentarily.<br/><br/>\
										        			Once you <a href="/hardware/cloud-controls" target="_blank">deploy</a> your code, you can monitor and control\
										        			applications from your <a href="/activity/devices" target="_blank">Devices</a> section.')).append($('<div class="button-container"><button class="button close large green white gotit">Got it</button></div>')).appendTo('body').fadeIn(200);$('.status-alert.success').off('click','button.close').on('click','button.close',function(){$('.status-alert.success').remove();});var clickOutsideCallout=function(event){var $target=$(event.target).closest('.status-alert.device-saved');if(!$target.first().is(event.data.container)){$('.status-alert.success').remove();$(document).off('click',clickOutsideCallout);}};$(document).off('click',clickOutsideCallout).on('click',{container:$('.status-alert.device-saved')},clickOutsideCallout);var payload={'boardType':IoTModeController.getDeviceType(),'deviceName':inputs['name'],'description':inputs['description'],'interval':inputs['sensor_interval'],'location':((inputs['location']!='')?inputs['location']:(inputs['latitude']+','+inputs['longitude'])),'safeguard':inputs['safeguard']}
_gaq.push(['_trackEvent',"Cloud Controls","Device Added",JSON.stringify(payload)]);}else if(result.status=='error'&&result.data){DeviceView.showErrors(result.data);}else{$('.device-registration-popup').lightbox('close').lightbox('error','<div class="status-alert error"><p>Something went wrong. Please try again.</p></div>');}})}}}});$('.device-registration-form input.device-registration-name').off('cut keyup paste').on('cut keyup paste',function(event){var userVal=$(this).val(),formattedVal=userVal;if(formattedVal.length>0){formattedVal=formattedVal.replace(/[^a-zA-Z0-9_\s]/g,'');formattedVal=formattedVal.replace(/\s+/g,'_');formattedVal=formattedVal.toLowerCase();}
$('.device-registration-form .device-id').text(formattedVal);});}});},updateDownloadButton:function(params){getView().find('.select-container button.download-link').off('click').on('click',function(){$('form.download-form').remove();var sketchName=ItemController.getCurrentItem().model.name;var iframeId='download-iframe-'+new Date().getTime();var $downloadForm=$('<form action="/choreo_proxy/snippetZipFile/'+sketchName+'/" method="POST" class="download-form" target="'+iframeId+'">\
				        	<iframe class="download-iframe" name="'+iframeId+'" id="'+iframeId+'"></iframe>\
				        	<input type="hidden" name="'+TEMBOO_CSRF_NAME+'" value="'+TEMBOO_CSRF_HASH+'" />\
				        </form>');$downloadForm.prependTo(getView().filter('.main'));for(var paramName in params){$('<input type="hidden" />').attr('name',paramName).val(params[paramName]).appendTo($downloadForm);}
$downloadForm.submit();});},updateGithubExportButton:function(){var repos;var language=SnippetController.getLanguage();var files={};var snippets={};var fileExtension;if(IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'&&language=='Samsung ARTIK 10'&&(IoTModeController.getProtocol()=='mqtt'||IoTModeController.getProtocol()=='coap')){fileExtension='cpp';}else{fileExtension=fileExtensions[language];}
var device;if(IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'){device=GatewayController.getSelectedProperty('device');}else{device=IoTModeController.getDevice();}
var errorMsgs={'github':"We're knocking but we're not getting a response. Please try again.",'repo':"You've already used that repo name.",'invalidName':"Names can only contain letters, numbers, hyphens, and underscores.",'blankName':"Please enter a name.",'selectRepo':"Please select a repo."}
$('.github-export-popup').attr('data-step',0);$('.spinner','.github-export-popup .step.loading').show();$('p.error','.github-export-popup').hide();$('.step.export .items .files').html('');$('.github-export-popup').off('beforelightboxopen').on('beforelightboxopen',function(e){$('.github-export-popup').attr('data-step',0);$('#tmb-lightbox button.icon.close').hide();$('p.error','.github-export-popup').hide();$('.spinner','.github-export-popup .step.loading').show();$('.spinner','.github-export-popup').hide();$('.button','.github-export-popup').css('visibility','visible');$('.github-export-popup input').val('');var choreoName=ItemController.getCurrentItem().model.name;var name;files={};snippets={};$('.step.export .items .files').html('');SnippetController.loadUserSnippet(true);$(SnippetModel).bind('snippetloaded',function(event,data){for(var language in data){snippets[language]=data[language];if(null!=language.match(/ Header$/)){if(IoTModeController.BLEEnabled()&&language=='iOS Header'){name=choreoName+'.h';}else{name='TembooAccount.h';}}else if(IoTModeController.BLEEnabled()&&language=='Arduino Classic'){name='TembooRedBearLabBLE.ino';}else if(IoTModeController.BLEEnabled()&&language=='Android'){name='TembooTask.java';}else if(language=='jsproxy'){var proxyLang=$('select.second-snippet-lang').val();name='proxy-server.'+fileExtensions[proxyLang];}else{name=choreoName+'.'+fileExtension;}
files[language]={name:name,content:btoa(snippets[language])};}
$('.step.export .items .files').html('');for(var language in files){$('.step.export .items .files').append('<div class="file">'+files[language]['name']+' *</div>');}});$.post('/github/isAuthenticated/',function(response){if(response.data===false){$.post('/github/initializeOAuth/',function(response){if(response.status=='success'){$('.github-export-popup a.launch-authorization').attr('href',response.data);$('.github-export-popup').attr('data-step',1);}else{$('.spinner','.github-export-popup').hide();$('p.error.submit','.github-export-popup').text(errorMsgs['github']).show();}
$('#tmb-lightbox button.icon.close').show();});}else{$.cookie('github_oauth',true,{secure:true,path:'/'});}});var wizardTimer=window.setInterval(function(){if($.cookie('github_oauth')){window.clearInterval(wizardTimer);$.cookie('github_oauth',null,{secure:true,path:'/'});$export=$('.github-export-popup .step.export');$.post('/github/listYourRepos/',function(response){if(response.status=='success'){repos=JSON.parse(response.data);var $repoSelector=$('select.repos');options=[];options.push('<option class="option-label-only">Your Repositories</option>');$.each(repos,function(name,data){options.push('<option value="'+name+'">'+name+'</option>');});options.push('<option class="create-repo">Create a New Repo</option>');$repoSelector.html(options.join()).val('').selectBox('destroy').selectBox();$('.step.export .items .files').append('<div class="file instructions">'+($repoSelector.val()=='Create a New Repo'?'readme.md':'instructions.txt')+'</div>');$('.repos-selectBox-dropdown-menu li').off('mouseup').on('mouseup',function(event){if($(this).hasClass('create-repo')){$('.button.export',$export).text('Create & Commit');$('.create-repo-container').show();$('.file.instructions').text('readme.md');}else{$('.button.export',$export).text('Commit');$('.create-repo-container').hide();$('.file.instructions').text('instructions.txt');}
$('p.error.repo',$export).hide();});if($('.profile-container button#save-profile').is(':visible')){$('.github-export-popup').attr('data-step',2);}else{$('.github-export-popup').attr('data-step',3);}
$('input[name="name"]',$export).focus();$('#tmb-lightbox button.icon.close').show();$('.spinner','.github-export-popup').hide();$('.button','.github-export-popup').css('visibility','visible');}else{$('.spinner','.github-export-popup').hide();$('#tmb-lightbox button.icon.close').show();$('p.error.submit','.github-export-popup').text(response.data).show();}});}},500);});$('.github-export-popup').off('click','.button.launch-authorization').on('click','.button.launch-authorization',function(){$('.button','.github-export-popup').css('visibility','hidden');$('.spinner','.github-export-popup').fadeIn(200);$('p.error','.github-export-popup').hide();});$('.github-export-popup').off('click','.button.placeholder').on('click','.button.placeholder',function(){$('.github-export-popup').attr('data-step',3);});$('.github-export-popup').off('click','.button.saveprofile').on('click','.button.saveprofile',function(){$('.github-export-popup').lightbox('close');$('html, body').animate({scrollTop:0},500);if($('.profile-container button#save-profile').is(':visible')){$('.profile-container button#save-profile').click();}
$('.profile-container .profile-buttons input#profile-name').focus();});getView().find('.select-container button.github').off('click').on('click',function(){Temboo.trackEvent("Github",'Github sharing started',ItemController.getCurrentItem().uri);$('.github-export-popup').lightbox({staticSize:false,buttons:{cancel:false,export:{async:false,callback:function(){Temboo.trackEvent("Github",'GitHub sharing completed',ItemController.getCurrentItem().uri);var $popup=$('.github-export-popup');var choreoName=ItemController.getCurrentItem().model.name;var $repoSelector=$('select.repos');var folder=$('.folder input[name=name]',$popup).val();var repo=$repoSelector.val();var owner;var repoName=$('input[name=repo-name]').val();$('.button',$popup).css('visibility','hidden');$('.spinner',$popup).fadeIn(200);$('p.error',$popup).hide();if($('a.selectBox.repos .selectBox-label').hasClass('option-label-only')){$('p.error.repo',$popup).text(errorMsgs['selectRepo']).show();$('.spinner',$popup).hide();$('.button',$popup).css('visibility','visible');return;}
if(repo=='Create a New Repo'&&null==repoName.match(/^([-a-zA-Z0-9_-])+$/g)){if(repoName==''){$('.create-repo-container p.error',$popup).text(errorMsgs['blankName']);}else{$('.create-repo-container p.error',$popup).text(errorMsgs['invalidName']);}
$('.spinner',$popup).hide();$('.button',$popup).css('visibility','visible');$('.create-repo-container p.error',$popup).show();return;}
$('option',$repoSelector).each(function(){if(repoName==this.value){$('.spinner',$popup).hide();$('.button',$popup).css('visibility','visible');$('.create-repo-container p.error',$popup).text(errorMsgs['repo']).show();return false;}});if($('.create-repo-container p.error',$popup).is(':visible')){return;}
if(null==folder.match(/^([-a-zA-Z0-9-_\/])+$/g)){if(repoName==''){$('.folder p.error',$popup).text(errorMsgs['blankName']);}else{$('.folder p.error',$popup).text(errorMsgs['invalidName']);}
$('.spinner',$popup).hide();$('.button',$popup).css('visibility','visible');$('.folder p.error',$popup).show();return;}
files['instructions']={name:(repo=='Create a New Repo'?'readme.md':'instructions.txt'),content:btoa(unescape(encodeURIComponent(githubInstructions)))};if(repo=='Create a New Repo'){$.post('/github/createRepo/'+repoName,function(response){if(response.status=='success'){var data=JSON.parse(response.data);owner=data.owner.login;var params={'path':folder,'repo':repoName,'owner':owner,'files':JSON.stringify(files)};$.post('/github/createFiles/',params,function(response){if(response.status=='success'){$('.github-export-popup').attr('data-step',4);$('.spinner','.github-export-popup').hide();$('.button','.github-export-popup').css('visibility','visible');var githubLink='https://github.com/'+owner;$('.github-export-popup .export-link-container a.export-link').attr('href',githubLink);$('.github-export-popup .export-link-container a.export-link').text(githubLink);}else{if(response.status=='error'){$('p.error.submit','.github-export-popup').text(response.data);}
$('.spinner','.github-export-popup').hide();$('.button',$popup).css('visibility','visible');$('p.error.submit','.github-export-popup').show();}});}else{$('.spinner',$popup).hide();$('.button',$popup).css('visibility','visible');$('p.error.submit',$popup).text(response.data).show();}});}else{var owner=repos[repo]['owner'];var params={'path':folder,'repo':repo,'owner':owner,'files':JSON.stringify(files)};$.post('/github/createFiles/',params,function(response){if(response.status=='success'){$('.github-export-popup').attr('data-step',4);$('.spinner','.github-export-popup').hide();$('.button','.github-export-popup').css('visibility','visible');var githubLink='https://github.com/'+owner;$('.github-export-popup .export-link-container a.export-link').attr('href',githubLink);$('.github-export-popup .export-link-container a.export-link').text(githubLink);if(response.data){$('p.error.submit','.github-export-popup').text(response.data).show();}}else{if(response.status=='error'){$('p.error.submit','.github-export-popup').text(response.data);}
$('.spinner','.github-export-popup').hide();$('.button',$popup).css('visibility','visible');$('p.error.submit','.github-export-popup').show();}});}}},close:{async:false,callback:function(){$('.github-export-popup').lightbox('close');}},copy:{async:false,callback:function(){$('.github-export-popup').lightbox('close');}}}});});$('.github-export-popup').off('lightboxclose').on('lightboxclose',function(e){SnippetController.loadUserSnippet();});},updateTiCcsExportButton:function(){var device;var shield;if(IoTModeController.gatewayEnabled()&&GatewayController.getSelectedTab()!='Gateway'){device=GatewayController.getSelectedProperty('device');shield=GatewayController.getEdgeShield();}else{device=IoTModeController.getDevice();shield=IoTModeController.getShield()}
var language=SnippetController.getLanguage();var errorMsgs={'invalidName':"Names can only contain letters, numbers, hyphens, and underscores.",'blankName':"Please enter a name."}
$('.ti-ccs-export-popup').attr('data-step',1);$('.ti-ccs-export-popup').off('beforelightboxopen').on('beforelightboxopen',function(e){$('.ti-ccs-export-popup').attr('data-step',1);$('.ti-ccs-export-popup input').val('');$('p.error','.ti-ccs-export-popup').hide();});$('.export-container button.export.ccs','.details-view .item-view .meta-class.snippet').off('click').on('click',function(){Temboo.trackEvent("TI CCS",'TI CCS sharing started',ItemController.getCurrentItem().uri);$('.ti-ccs-export-popup').lightbox({staticSize:false,buttons:{cancel:false,next:{async:false,callback:function(){$export=$('.ti-ccs-export-popup .step.export');var folderName=ItemController.getCurrentItem().uri.replace(/\//g,' ');var choreoName=ItemController.getCurrentItem().model.name;var sketchName=choreoName+'.'+fileExtensions[language];$('.folder',$export).text(folderName);$('.file.sketch',$export).text(sketchName);$('.ti-ccs-export-popup').attr('data-step',2);$('input[name="name"]',$export).focus();}},export:{async:false,callback:function(){Temboo.trackEvent("TI CCS",'TI CCS sharing completed',ItemController.getCurrentItem().uri);var $popup=$('.ti-ccs-export-popup');var choreoName=ItemController.getCurrentItem().model.name;var snippets=SnippetModel.getSnippets();var projectName=$('input',$popup).val();var boardId=tiShieldToBoardIdMap[shield];var files=new Array();var params={projectName:projectName,boardId:boardId,};if(null==projectName.match(/^([-a-zA-Z0-9_-])+$/g)){if(projectName==''){$('p.error',$popup).text(errorMsgs['blankName']);}else{$('p.error',$popup).text(errorMsgs['invalidName']);}
$('p.error',$popup).show();return;}
files.push({name:'instructions.ino',content:tiCcsInstructions});for(var language in snippets){var name=null==language.match(/ Header$/)?choreoName+'.ino':'TembooAccount.h';files.push({name:name,content:snippets[language]})}
var $form=$('<form />').attr('action','https://dev.ti.com/ide/api/ccsserver/createSketch?'+$.param(params)).attr('method','POST').attr('target','ticcscloudwindow').append($('<input />').attr('name','json').attr('value',JSON.stringify({files:files})));$form.submit();$('input',$popup).val('');$popup.attr('data-step',3);}},close:{async:false,callback:function(){$('.ti-ccs-export-popup').lightbox('close');}},copy:{async:false,callback:function(){$('.ti-ccs-export-popup').lightbox('close');}}}});});},updatePlatformSelector:function(language){var languageName=language;var downloadLanguage=LANGUAGE_MAP[language];var iconLanguage=downloadLanguage;if(downloadLanguage=='arduinoyun'||downloadLanguage=='mkr1000'){downloadLanguage='arduino';}else if(language=='Android'){language='Java';downloadLanguage='java';}
if(downloadLanguage=='rest_json'){$('.select-container .sdk-download').attr('href','/restapi').attr('target','_blank').removeClass().addClass('sdk-download '+downloadLanguage).find('.sdk-description').html('Learn more about our <strong>REST&nbsp;API</strong>');iconLanguage='restapi';languageName='REST API';}else if(downloadLanguage=='processing'){$('.select-container .sdk-download').attr('href','/sdk/'+downloadLanguage).attr('target','').removeClass().addClass('sdk-download '+downloadLanguage).find('.sdk-description').html('Get the <strong>'+language+' Library</strong>');}else if(downloadLanguage=='javascript'){$('.select-container .sdk-download').attr('href','/javascript').attr('target','_blank').removeClass().addClass('sdk-download '+downloadLanguage).find('.sdk-description').html('Learn about our <strong>JavaScript&nbsp;SDK</strong>');}else{if(language=='TI'){languageName='Texas Instruments';iconLanguage='ti'}else if(language=='Samsung'){iconLanguage='samsung';}
$('.select-container .sdk-download').attr('href','/sdk/'+downloadLanguage).attr('target','').removeClass().addClass('sdk-download '+downloadLanguage).find('.sdk-description').html('Get the <strong>'+language+' SDK</strong>');}
$('#platform-selector .platform-selector-label .sdk-label').text(languageName);$('#platform-selector .platform-selector-label .sdk-button').attr('id',iconLanguage);$('#platform-selector').css('display','inline-block');}}}();var TreeController=function(){var srClasses='searchresult-ancestor searchresult searchresult-descendant';var emptySearchMessages=[{'title':'No results found.','description':'If there\'s something you\'re looking for, <a target="_blank" href="/contact">let us know</a>.'},{'title':'Null pointer exception.','description':'Just kidding, we just didn\'t find a match. Get in touch to <a target="_blank" href="/contact">let us know</a> what\'s missing.'},{'title':'There\'s a thin line between imagination and reality.','description':'That item doesn\'t exist in the library. If you think it should, <a target="_blank" href="/contact">let us know</a>.'}];function flushSearchResults(){$('.library-view .tree li[class*="searchresult"]').removeClass(srClasses);$('.library-view .tree li:hidden').show();}
var favelist=[];return{init:function(){var self=this;$(document).off('click','.library-view a.tmb-item-link').on('click','.library-view a.tmb-item-link',function(event){event.preventDefault();var loadingTab=null;if($('.library-view .tree').hasClass('gateway-select-choreo')&&!$(this).parent().hasClass('jstree-leaf')){$(this).prev('ins.jstree-icon').click();}else{var uri=$(this).attr('href');if($('.library-view .tree').hasClass('gateway-select-choreo')){GatewayController.removeSelectedProperty('inputs');GatewayController.removeSelectedProperty('credential');GatewayController.removeOutputTrigger();GatewayController.setSelectedProperty('uri',uri);if(GatewayController.getSelectedTab()=='Gateway'){Temboo.trackEvent("M2M","Selected gateway Choreo",uri.substring(9));}else{Temboo.trackEvent("M2M","Selected edge Choreo",uri.substring(9));}
loadingTab=true;$('.library-view .tree').removeClass('gateway-select-choreo');GatewayView.fadeOut(true);}else{GatewayController.removeTabs();GatewayController.setSelectedTab('Gateway');}
if($('.widget').hasClass('active')){DocPanelView.togglePanel();}
if($('.widget').hasClass('error')){$('.widget').removeClass('error');}
uri=uri.replace(baseUrl,'');if(ItemModel.isCached(uri)){ItemsView.loading(true,loadingTab);}
ItemController.loadItem(uri,$(this).attr('rel'),null,loadingTab);}});$('.filter-type a').click(function(e){e.preventDefault();var parent=$(this).parent('li');if(parent.hasClass('filter-type-favorites')){if(parent.hasClass('active')){parent.removeClass('active');}else{parent.addClass('active');$('.faved').parent('li').addClass('filtered');}
TreeController.applyFilters();TreeController.refreshFavelist();}
else if(parent.hasClass('collapsed')){var animated=$('li:hidden',parent);animated.slideDown(function(){if(animated.filter(':animated').length==1){parent.removeClass('collapsed');TreeController.resizeTree();}});}else{var animated=$('li:not(.active)',parent);animated.slideUp(function(){if(animated.filter(':animated').length==1){parent.addClass('collapsed');TreeController.resizeTree();}});}});$('.filter-group input').click(function(){var parent=$(this).parent('li');parent.toggleClass('active');if(parent.closest('li.filter-type').hasClass('collapsed')&&!parent.hasClass('active')){parent.slideUp();}
TreeController.applyFilters();});$(SearchModel).bind('searchresult',function(event,result){var item,nodeParent,treelinks=$('.library-view .tree a.tmb-item-link');flushSearchResults();for(var i in result.docs){item=result.docs[i];nodeParent=treelinks.filter('[href="'+baseUrl+item.uri+'"]').parent();nodeParent.addClass('searchresult');nodeParent.parents('li').addClass('searchresult-ancestor');}
$('.library-view .tree').jstree('deselect_all');if($('.searchresult').length===0){$('.library-view .tree li').hide();var emptySearchMessage=emptySearchMessages[Math.floor(Math.random()*emptySearchMessages.length)];$('.tree-empty-search .empty-search-title').html(emptySearchMessage.title);$('.tree-empty-search .empty-search-description').html(emptySearchMessage.description);$('.tree-empty-search').show();}
else{$('.library-view .tree li.searchresult li.jstree-leaf:not(.searchresult)').addClass('searchresult-descendant');$('.library-view .tree li:not(.searchresult-ancestor, .searchresult, .searchresult-descendant)').hide();$('.library-view .tree li.jstree-leaf.searchresult').siblings('.searchresult-descendant').hide();}
TreeController.resizeTree();SearchController.externalSetSearching(false);});$(SearchView).bind('reset',function(event){flushSearchResults();});var list=$('.library-view .tree > ul'),items=$('a[href="/library/Library/Labs/"], a[href="/library/Library/Utilities/"]',list),labsLi=items.filter('a[href="/library/Library/Labs/"]').parent(),utilitiesLi=items.filter('a[href="/library/Library/Utilities/"]').parent();list.prepend('<li class="title"><h3 class="subtitle">Choreos</h3></li>');utilitiesLi.addClass('bundle-Utilities').appendTo(list);labsLi.addClass('bundle-Labs').appendTo(list);$(".library-view .tree").bind("loaded.jstree",function(){$(this).fadeIn(250);}).bind("after_open.jstree after_close.jstree loaded.jstree",TreeController.resizeTree).bind("after_open.jstree after_close.jstree",function(event){TreeController.setClicked();}).bind("select_node.jstree",function(e,data){$('.tmb-item-highlight').removeClass('tmb-item-highlight');$(data.rslt.obj[0]).addClass('tmb-item-highlight');}).jstree({'core':{'animation':200},'hotkeys':{'ctrl+up':false,'shift+up':false,'ctrl+down':false,'shift+down':false,'ctrl+left':false,'shift+left':false,'ctrl+right':false,'shift+right':false,'ctrl+space':false,'shift+space':false,'f2':false,'del':false},'plugins':['html_data','themes','ui'],'themes':{'theme':'default','dots':false,'icons':false,'url':'/files/stable/themes/default/style.css'}});TreeController.refreshFavelist();},getFilterInputs:function(){var collapsed=[];var checked=[];$('li.filter-type.collapsed > a').each(function(){collapsed.push($(this).attr('href'));});$('input.filter:checked').each(function(){checked.push($(this).attr('id'));});return{collapsed:collapsed,checked:checked};},setFilterInputs:function(savedFilterInputs){var filterinputs=$('input.filter');var filteritems=$('li.filter-type');var filterlinks=$('li.filter-type > a');if(savedFilterInputs&&savedFilterInputs.checked){var restoreChecked=$([]);for(var checkedId in savedFilterInputs.checked){restoreChecked=restoreChecked.add('#'+savedFilterInputs.checked[checkedId]);}
restoreChecked.not(':checked').click();filterinputs.filter(':checked').not(restoreChecked).click();}else{filterinputs.filter(':checked').click();}
if(savedFilterInputs&&savedFilterInputs.collapsed){var restoreCollapsed=$([]);for(var uri in savedFilterInputs.collapsed){restoreCollapsed=restoreCollapsed.add(filterlinks.filter('[href="'+savedFilterInputs.collapsed[uri]+'"]').parent('li'));}
filteritems.filter('.collapsed').not(restoreCollapsed).children('a').click();restoreCollapsed.not('.collapsed').children('a').click();}else{filteritems.not('.collapsed').children('a').click();}},getState:function(){var opened=[];var clicked=[];$(".library-view .tree .jstree-open > a.tmb-item-link").each(function(){opened.push($(this).attr('href'));});$(".library-view .tree a.tmb-item-link.jstree-clicked").each(function(){clicked.push($(this).attr('href'));});return{opened:opened,clicked:clicked};},setState:function(savedState){var tree=$('.library-view .tree');var treelinks=$('a.tmb-item-link',tree);if(savedState&&savedState.opened){var restoreOpened=$([]);for(var uri in savedState.opened){restoreOpened=restoreOpened.add(treelinks.filter('[href="'+savedState.opened[uri]+'"]'));}
treelinks.not(restoreOpened).parent('li').each(function(){tree.jstree('close_node',this,false,true);});restoreOpened.parent('li').each(function(){tree.jstree('open_node',this);});}else{tree.jstree('close_all');}
if(savedState&&savedState.clicked){this.setClicked(savedState.clicked);}else{treelinks.removeClass('jstree-clicked');}},setClicked:function(clicked){clicked=clicked;if(!clicked){var currentItem=ItemController.getCurrentItem();clicked=currentItem?[baseUrl+ItemController.getCurrentItem().uri]:[];}
var tree=$('.library-view .tree');var treelinks=$('a.tmb-item-link',tree);treelinks.removeClass('jstree-clicked');for(var uri in clicked){treelinks.filter('[href="'+clicked[uri]+'"]').each(function(){var p=$(this).parents('li:visible');p.removeClass('tmb-item-highlight');p.first().children('a.tmb-item-link').first().addClass('jstree-clicked');});}},resizeTree:function(){var treeHeight=$('.library-view').height()+30;$(TreeController).trigger('treeresized',treeHeight)},externalFlushSearch:function(){flushSearchResults();},applyFilters:function(){$('.tree-empty-message').hide();var activeFilters=$('.filter-group li.active');if(activeFilters.length===0&&$('.filter-type-favorites').hasClass('active')){$(".library-view .tree li").removeClass('filtered');for(var x=0;x<favelist.length;x++){var linkDestination='/library/'+favelist[x]+'/';var salientLink=$('a[href="'+linkDestination+'"]');salientLink.parents('li').addClass('filtered');salientLink.find('li').addClass('filtered');}
$(".library-view .tree li.filtered").show();$(".library-view .tree li:not(.filtered)").hide();TreeController.resizeTree();if($(".library-view .tree li.filtered").length===0){$('.tree-empty-message').show();}}else if(activeFilters.length>0){$('li.filter-type-keywords').addClass('selected');$(".library-view .tree li").removeClass('filtered');activeFilters.each(function(){var keyword=$('input',this).val();var filteredItems=$('.keyword-'+keyword).addClass('filtered');filteredItems.parents('li').addClass('filtered');filteredItems.find('li').addClass('filtered');});if($('.filter-type-favorites').hasClass('active')){$('.filtered').each(function(){var currItem=$(this);var salientLink=currItem.find('a')[0];var target=salientLink.title.replace(/\./g,'/');if(favelist.indexOf(target)<0){currItem.removeClass('filtered');}else{currItem.parents('li').addClass('filtered');}});$(".library-view .tree li.filtered").show();$(".library-view .tree li:not(.filtered)").hide();TreeController.resizeTree();if($(".library-view .tree li.filtered").length===0){$('.tree-empty-message').show();}}else{$(".library-view .tree li.filtered").show();$(".library-view .tree li:not(.filtered)").hide();TreeController.resizeTree();}}else{$('li.filter-type-keywords').removeClass('selected');$(".library-view .tree li").removeClass('filtered').show();TreeController.resizeTree();}},refreshFavelist:function(){if(LOGGED_IN){$.post('/library/favelist/',{},function(data){Temboo.log('Refreshing favorites list');favelist=data?data:[];TreeController.applyFilters();},'json');}},addFavelistItem:function(uri){uri=uri.replace(/\/$/,'');favelist.push(uri);TreeController.applyFilters();TreeController.refreshFavelist();},removeFavelistItem:function(uri){uri=uri.replace(/\/$/,'');var i=favelist.indexOf(uri);if(i!==-1){favelist.splice(i,1);TreeController.applyFilters();}
TreeController.refreshFavelist();}}}();ValidationController=function(){return{init:function(){$.validator.addMethod('type-XML',function(value,element){var isXml;if(!this.optional(element)){try{isXml=$.parseXML(value);}catch(e){isXml=false;}}
return isXml!==false;},'This is not valid XML');$.validator.setDefaults({onsubmit:false,onfocus:false,onkeyup:false,onblur:true,onclick:false});},own:function(form){var validationTimer;Temboo.log('ValidationController.init','Auditing '+form);$(form).off('keyup','**').on('keyup','input, textarea',function(event){window.clearTimeout(validationTimer);validationTimer=window.setTimeout(function(){$(form).valid();},600);});$(form).validate();}}}();var LibraryLandingController=function(){var initData;return{init:function(data){if(data){initData=data;}else{data=initData;}
IoTModeView.hideIoTModeControls();if($('#library-landing-dashboard').length>0){if($('.account-name').width()>290){$('.account-name').css('font-size',Math.floor(30/($('.account-name').width()/290)));}
$('.account-details').width(330);function makeDonutChart(element,data,size,strokeWidth,colors,dur){var w=size;var h=size;var r=h/2;var color=d3.scale.ordinal().range(colors);var other=1;for(var i=0;i<data.length;i++)other-=data[i].percent;if(element!='#most-run'){data.push({"percent":other});colors.push('none');}
var vis=d3.select(element).append("svg:svg").data([data]).attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+r+","+r+")");if(element!='#most-run'){vis.append('circle').attr('cx',0).attr('cy',0).attr('r',r-strokeWidth/2).attr('stroke-width',1).attr('stroke','#ccc').attr('fill','none');}
var pie=d3.layout.pie().sort(null).value(function(d){return d.percent;});var arcs=vis.selectAll("g.slice").data(pie).enter().append("svg:g").attr("class","slice");$(window).on('libraryloaded.donutanimation',function(){if(element=='#most-run'){arcs.append("svg:path").attr({'opacity':'0'}).transition().ease("exp").duration(dur).attrTween("d",function(b){var arc=d3.svg.arc().outerRadius(r).innerRadius(0);var i=d3.interpolate({startAngle:0,endAngle:0},b);return function(t){return arc(i(t));};});}
arcs.append("svg:path").attr("fill",function(d,i){return color(i);}).transition().ease("exp").duration(dur).attrTween("d",function(b){var arc=d3.svg.arc().outerRadius(r).innerRadius(r-strokeWidth);var i=d3.interpolate({startAngle:0,endAngle:0},b);return function(t){return arc(i(t));};});});}
function sizeUsageText(){var fontSize;var commaSize;var callText=$('.calls').text();var lastChar=callText.substr(callText.length-1);var calls=parseFloat(callText);if(lastChar=='K'||lastChar=='M'){fontSize=22;commaSize=11;}else if(calls<=9999){fontSize=34;commaSize=18;}
else if(calls<=99999){fontSize=28;commaSize=16;}else if(calls<=999999){fontSize=24;commaSize=14;}else{fontSize=22;commaSize=11;}
$('.calls').css('font-size',fontSize).html($('.calls').text());}
var usageColors=["#d8297b"];var usagePercent=parseInt($('.calls').text())/parseInt($('.max-calls').text());var usageData=[{"percent":usagePercent}];makeDonutChart('#usage-donut',usageData,120,6,usageColors,2000);sizeUsageText();$('#library-landing-dashboard .section.usage-donut svg').insertBefore('#library-landing-dashboard .section.usage-donut .text-container');if(usagePercent>.85&&$('.section.usage-modal').length>0){if(usagePercent>1){var usagePercentRounded='100%+';}else if(usagePercent>=.99&&usagePercent<1){var usagePercentRounded='99%';}else{var usagePercentRounded=Math.round(usagePercent*100)+'%';}
$('.usage-modal-percentage').html(usagePercentRounded);makeDonutChart('#usage-modal-donut',usageData,60,6,usageColors,2000);$('.usage-bar').css('display','none');$('.usage-modal').css('display','inline-block');}
$('button.usage-modal-close').click(function(event){event.preventDefault();$('.usage-modal').css('display','none');$('.usage-bar').css('display','inline-block');$.cookie('ignore-usage-modal',1);});function choreoHover(data,colors){var color=d3.scale.ordinal().range(colors);var percentText=[];var decimal=[];var total=0;var goal=100;for(var i=0;i<6;i++){if(data[i]&&data[i].choreo){var li=$('.list.most-run ul li').eq(i);li.find('.ord').css('background-color',color(i));li.find('.choreoName').text(data[i].choreo.replace(/\./g,' . '));if(i==5)li.find('.choreo').show();else li.find('.choreo').attr('href','/library/Library/'+data[i].choreo.replace(/\./g,'/'));if(data[i].percent<.01){goal=99;decimal[i]=0;percentText[i]='<span class="percent-less-than"><</span>1';}else{percentText[i]=Math.floor(data[i].percent*100);total+=percentText[i];decimal[i]=(data[i].percent*100)-percentText[i];}}}
$('#library-landing-dashboard .section.most-run .list ul li .ord').css('display','inline-block');while(total<goal){decIndex=decimal.indexOf(Math.max.apply(null,decimal));percentText[decIndex]++;decimal[decIndex]=0;total++;}
$('.list.most-run ul li .choreo').hover(function(){var i=$('.list.most-run ul li').index($(this).parent());if(data[i]&&data[i].choreo){$('#most-run .percent-number').html(percentText[i]);$('#most-run .percent').css('color',color(i)).show();}},function(){$('.percent').hide();});$('#most-run .slice').hover(function(){var i=$('#most-run .slice').index($(this));if(data[i]&&data[i].choreo){$('.percent-number').html(percentText[i]);$('.percent').css('color',color(i)).show();}
$('.list.most-run ul li').eq(i).find('.choreo').css('color',color(i));},function(){var i=$('#most-run .slice').index($(this));$('.percent').hide();$('.list.most-run ul li').eq(i).find('.choreo').css('color','');});}
var mostRunData=JSON.parse($('.most-run-data').text());var mostRunColors=["#03c","#f47925","#0c0","#d8297b","#2bb5e9","#ccc"];if(mostRunData==-1){$('.chart.nousage-mostrun').show();$('#library-landing-dashboard .section.most-run .list ul li .ord').css('display','inline-block');var mostRunData=[{"choreo":"DuckDuckGo.Query","percent":.37},{"choreo":"Twitter.Search.Tweets","percent":.20},{"choreo":"Yahoo.Weather.GetWeatherByAddress","percent":.19},{"choreo":"23andMe.Ancestry","percent":.05},{"choreo":"Google.Geocoding.GeocodeByAddress","percent":.03}];var dur=0;}else{var dur=2000;}
makeDonutChart('#most-run',mostRunData,100,10,mostRunColors,dur);choreoHover(mostRunData,mostRunColors);var successChart=d3.select('.chart.success-rate').append('svg').attr('width',106).attr('height',66);var successCount=parseInt($('.success-count').text());if(successCount==-1){$('.success-count').addClass('none');$('.success-count').text('Run a Choreo');$('a.success-link').attr('href','/library/Library/'+ftuxChoreo);$('#library-landing-dashboard .section.success-rate .success-chart .path').css('display','none');}else if(successCount==0){$('#library-landing-dashboard .section.success-rate .success-chart .path').css('display','none');$('#library-landing-dashboard .section.success-rate .success-container').addClass('error');}else{var length=document.querySelector('.path').getTotalLength();var segment=(successCount/100)*length;var dashArray=segment.toString()+','+(length-segment).toString();$('#library-landing-dashboard .section.success-rate .success-chart .path').css('stroke-dasharray',dashArray);if(successCount>=49.5){$('#library-landing-dashboard .section.success-rate .success-container').addClass('success');}else{$('#library-landing-dashboard .section.success-rate .success-container').addClass('error');}
$('#library-landing-dashboard .section.success-rate .success-container').hover(function(){$(this).addClass('hover');},function(){$(this).removeClass('hover');});}
$('.success-count').show();var profileCount=parseInt($('.profile-count').text());if(profileCount==0){$('.profile-count').addClass('none');$('.profiles-manage').hide();$('.profiles-learn-more').show();}else{$('.profile-count').addClass('profiles');$('.profiles-learn-more').hide();$('.profiles-manage').show();}
$('.section.news').width($('.news-content').width()+44);if($.cookie('news-closed')=='true'){$('button.news-toggle').removeClass('minus').addClass('plus');$('.news-content').hide();}else{$('button.news-toggle').removeClass('plus').addClass('minus');$('.news-content').show();}
$('button.news-toggle').click(function(e){if($(this).hasClass('minus')){$(this).removeClass('minus').addClass('plus');$('.news-content').hide(0,function(){$(ItemsView).trigger('heightchanged');});$.cookie('news-closed','true',{expires:180,path:'/'});}else{$(this).removeClass('plus').addClass('minus');$('.news-content').show(0,function(){$(ItemsView).trigger('heightchanged');});$.cookie('news-closed',null,{expires:180,path:'/'});}});var runsPerDaySparse=JSON.parse($('.usage-bar-data').text());var runsPerDay=[];for(var i=1;i<32;i++){var calls=runsPerDaySparse[i]?runsPerDaySparse[i]:0;runsPerDay.push({day:i,calls:calls});}
var formatChartCalls=function(calls,axis,max){if(axis){return calls}
return''+calls+(calls==1?' run':' runs');}
var makeRunsPerDayChart=function(data,valueName){var max=d3.max(data,function(d){return d[valueName];});max=Math.ceil(max*1.1);if(max==0){max=10;}else if(max<=200){max=Math.ceil(max/10)*10;}else if(max<=2000){max=Math.ceil(max/100)*100;}else if(max<=20000){max=Math.ceil(max/1000)*1000;}else{max=Math.ceil(max/10000)*10000;}
var margin={top:20,right:20,bottom:30,left:52},width=310,height=80;var x=d3.time.scale().range([0,299]);var y=d3.scale.linear().range([height,0]);var xAxis=d3.svg.axis().scale(x).tickSize(0,0,0).tickFormat(d3.format("^d")).tickPadding(7).orient("bottom").ticks(31);var yAxis=d3.svg.axis().scale(y).tickSize(0).tickFormat(function(tickValue){return formatChartCalls(tickValue,true,max);}).tickPadding(59).orient("left");var svg=d3.select("div.chart-runsperday").append("svg").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");x.domain([1,31]);y.domain([0,max]);var xG=svg.append("g").attr("class","x axis").attr("transform","translate(4,"+height+")").call(xAxis);yAxis.tickValues(y.domain());var yG=svg.append("g").attr("class","y axis").attr("transform","translate("+margin.left+",0)").call(yAxis)
var bargroup=svg.selectAll('g.bargroup').data(data).enter().append('g').attr('class',function(d){var classes=['bargroup'];(d.calls>0)&&classes.push('filled');return classes.join(' ');}).attr('data-offset',function(d){return 4-y(d[valueName]);}).attr("data-day",function(d){return d.day;});;var hoverbars=bargroup.append('rect').attr("class","hoverbar").attr("x",function(d){return x(d.day)}).attr("width",10).attr("y",0).attr("height",height);var bars=bargroup.append('rect').attr("class",function(d){return'bar '+valueName+' t'+d.day;}).data(data).attr("x",function(d){return x(d.day)+2}).attr("width",6).attr("y",height).attr("height",0);var isFeb=$('div.chart-runsperday').hasClass('february');var formatRunTicks=function(d,index,active){var classes=['tick',valueName,'t'+d.day];(active)&&classes.push('active');(d.day==1||d.day%5==0)&&!(isFeb&&d.day==30)&&classes.push('shown');return classes.join(' ');}
var ticks=svg.selectAll('g.tick').data(data).attr('class',formatRunTicks);var tipsiedBars=$('.chart-runsperday svg g.bargroup.filled').on('mouseover',function(){var day=$(this).data('day');ticks.filter('.t'+day).attr('class',function(d){return formatRunTicks(d,i,true);});(day==2||day%5==1)&&$('.chart-runsperday svg .axis.x .tick.t'+(day-1)).hide();(day%5==4)&&$('.chart-runsperday svg .axis.x .tick.t'+(day+1)).hide();}).on('mouseout',function(){ticks.attr('class',formatRunTicks);$('.chart-runsperday svg .axis.x .tick.shown').show();}).each(function(){$(this).tipsy({gravity:'s tipsy-'+valueName,html:true,offset:$(this).data('offset'),hoverlock:true,delayOut:1,opacity:1,title:function(){return formatChartCalls(this.__data__[valueName]);}});});$(window).on('scroll.tipsies',function(){tipsiedBars.each(function(){$(this).tipsy('hide');});});$(ItemController).off('unload.tipsies').on('unload.tipsies',function(){$(window).off('scroll.tipsies');$(ItemController).off('unload.tipsies');});$(window).on('libraryloaded.baranimation',function(){bars.transition().duration(2000).attr("y",function(d){return height-(height-y(d[valueName]))}).attr("height",function(d){return height-y(d[valueName])});});};makeRunsPerDayChart(runsPerDay,'calls');langDropDown=$('#library-landing-dashboard select.sdk-selector');langDropDown.append('<option class="option-label-only">Select</option>');langDropDown.append('<option name="language" value="Android">Android</option>');langDropDown.append('<option name="language" value="JavaScript">JavaScript</option>');langDropDown.append('<option name="language" value="cURL">REST API</option>');langDropDown.append('<option name="language" value="Arduino">Arduino</option>');langDropDown.append('<option name="language" value="Node.js">Node.js</option>');langDropDown.append('<option name="language" value="Ruby">Ruby</option>');langDropDown.append('<option name="language" value="C#">C#</option>');langDropDown.append('<option name="language" value="PHP">PHP</option>');langDropDown.append('<option name="language" value="Samsung">Samsung</option>');langDropDown.append('<option name="language" value="iOS">iOS</option>');langDropDown.append('<option name="language" value="Processing">Processing</option>');langDropDown.append('<option name="language" value="TI">Texas Instruments</option>');langDropDown.append('<option name="language" value="Java">Java</option>');langDropDown.append('<option name="language" value="Python">Python</option>');var defaultPlatform=data.defaultPlatform;if(defaultPlatform){langDropDown.selectBox('value',defaultPlatform);LibraryLandingController.updateLearnLanguage(langDropDown.find('option:selected').text());var link_language=LANGUAGE_MAP[langDropDown.find('option:selected').text()];langDropDown.addClass(link_language);}else{langDropDown.selectBox('value','Select');$('.learn-container').hide();$('.library-nousage-learn').show();}
langDropDown.selectBox().bind('change',function(){LibraryLandingController.updateLearnLanguage($(this).find('option:selected').text());$.cookie('library_default_language',$(this).val(),{expires:180,path:'/'});});$('a.selectBox.sdk-selector.selectBox-dropdown').prepend('<div class="sdk-icon-large"></div>');$('.sdk-selector-selectBox-dropdown-menu li a').each(function(){$(this).wrapInner('<span class="sdk-text"></span>');$(this).prepend('<span class="sdk-icon '+LANGUAGE_MAP[$(this).text()]+'"></span>');});if(/constructor/i.test(window.HTMLElement)){$('#library-landing-dashboard .section.learn .sdk-container ul li').css('height','27px');}
if($('#doc-panel').hasClass('active')){DocPanelView.togglePanel();setTimeout(function(){$('#doc-panel').hide();},400);}else{$('#doc-panel').hide();$('#page').removeClass('panel-open');}}},updateLearnLanguage:function(language){$('.library-nousage-learn').hide();var link_language=LANGUAGE_MAP[language];$('.selectBox.sdk-selector.selectBox-dropdown').removeClass().addClass('selectBox sdk-selector selectBox-dropdown '+link_language);if(language=='Arduino'){$('.learn-container').hide();$('.learn-container.arduino').show();}else{$('.learn-container').show();$('.learn-container.arduino').hide();if(language=='Texas Instruments'){$('.learn-box.bottom.ti').show();$('.learn-box.bottom.samsung').hide();$('.learn-box.bottom.restapi').hide();$('.getting-started .learn-language').text('your TI LaunchPad');$('.examples .learn-language').text('your TI LaunchPad');$('.learn-box.bottom.outputfilters').show();link_language='hardware/ti';}else if(language=='Samsung'){$('.learn-box.bottom.samsung').show();$('.learn-box.bottom.ti').hide();$('.learn-box.bottom.restapi').hide();var msg='your '+BoardModel.Samsung.Artik.Ten.marketingName;$('.getting-started .learn-language, .examples .learn-language').text(msg);$('.learn-box.bottom.outputfilters').show();link_language='hardware/samsung';}else{$('.learn-box.bottom.samsung').hide();$('.learn-box.bottom.ti').hide();$('.examples .learn-language').text('Temboo & '+language);if(language=='REST API'){$('.getting-started .learn-language').text('our REST API');$('.learn-box.bottom.outputfilters').hide();$('.learn-box.bottom.restapi').show();}else{$('.learn-box.bottom.restapi').hide();$('.learn-box.bottom.outputfilters').show();$('.getting-started .learn-language').text('the '+language+' SDK');}}
$('.learn-link.getting-started').attr('href','/'+link_language+'/getting-started');$('.learn-link.examples').attr('href','/'+link_language);$('.learn-link.output-filters').attr('href','/'+link_language+'/output-filters');if($('.learn-box.bottom:visible').length==3){$('.learn-box').removeClass('two-links').addClass('three-links');}else if($('.learn-box.bottom:visible').length==2){$('.learn-box').removeClass('three-links').addClass('two-links');}}}}}();return{init:MasterController.init,myaccount_init:MyAccountController.init,ItemController:ItemController,ItemsView:ItemsView,ItemModel:ItemModel,CredentialsModel:CredentialsModel,CredentialSelectorController:CredentialSelectorController,CredentialsTemplateController:CredentialsTemplateController,SnippetModel:SnippetModel,log:function(caller,str){if(!PRODUCTION_MODE&&typeof console!=='undefined'){var msg=arguments.length>1?caller+': '+str:caller;console.log(msg);}},showStatus:function(status,message){var layout,yPos,container=$('body > .content'),viewId='widget-status',view=$('<p />').attr('id',viewId).addClass('status-alert '+status).html(message);yPos=$('#footer').offset().top-container.offset().top;container.append(view.get(0));$('#'+viewId).fadeIn(ANIMATION_MILLIS).delay(4000).fadeOut(ANIMATION_MILLIS,function(){$(this).remove();});}}}());if(window.Temboo){window.Temboo.register('Library',Library);}
else{$(window).bind('Temboo.initialized',function(){window.Temboo.register('Library',Library);})}});if(!Object.keys){Object.keys=(function(){'use strict';var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!({toString:null}).propertyIsEnumerable('toString'),dontEnums=['toString','toLocaleString','valueOf','hasOwnProperty','isPrototypeOf','propertyIsEnumerable','constructor'],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=='object'&&(typeof obj!=='function'||obj===null)){throw new TypeError('Object.keys called on non-object');}
var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop);}}
if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i]);}}}
return result;};}());}